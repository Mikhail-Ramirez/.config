(self.webpackChunk=self.webpackChunk||[]).push([[274],{70632:(e,t,i)=>{var r=i(98544),n="chrome-extension://__MSG_@@extension_id__/",a="moz-extension://__MSG_@@extension_id__/",s="safari-web-extension://__MSG_@@extension_id__/",o=self.GR_RESOURCE_ROOT||n,l=self.GR_RESOURCE_ROOT||a,d=self.GR_RESOURCE_ROOT||s;e.exports={__css:r.toString().replace(new RegExp(n,"g"),o).replace(new RegExp(a,"g"),l).replace(new RegExp(s,"g"),d),...r.locals}},22529:(e,t,i)=>{i.r(t),i.d(t,{G2FeatureImpl:()=>At});var r=i(90023),n=i(49231),a=i(82823),s=i(80724),o=i(60841),l=i(55446),d=i(73863),c=i(60165),h=i(39620),g=i(58303),u=i(52256),m=i(25770),p=i(4603),v=i(94525),f=i(27457),w=i(68485),S=i(13458),_=i(64965),b=i(74857),y=i(34859),k=i(52979);function C(e){return{kind:"sessionText",rev:Number.MIN_SAFE_INTEGER,range:e}}var R=i(14765),x=i(65647),B=i(10859),E=i(74983),I=i(18300);function T(e,t){return e.pipe(R.O(null),x.U((()=>(0,r.zG)(t.getCurrentSelection(!0),I.Ls,g.ij,g.hX((0,r.ff)(E.SV.isCollapsed))))),B.skipBy(g.Eh(E.SV.eq)))}class F{constructor(e){this._params=e,this._subs=new a.w,this._selectionRange=m.h.create(g.YP),this.info=this._params.integrationInfo,this.highlightGeometryFilter=k.qH.everything,this.highlightGeometryInvalidator=(0,k.WF)(this._params.textFieldLayout),this.selectionRange=this._selectionRange.view(),this.sidelinePositioningStrategy={kind:"alignWithTextFieldLeftBoundary"},this.isEnabled=m.h.create(!0),this.textRangeFilter=r.W8,this._subs.add(T(_.R(this._params.textFieldElement.ownerDocument,"selectionchange").pipe(b.b(100),y.h(void 0)),this._params.selectionService).subscribe(h.wW(this._selectionRange)))}getRewriteScope(e){return C(e.vBar.textRange)}dispose(){this._subs.unsubscribe()}}var P=i(61179),M=i(65882),D=i(32082),L=i(90049),A=i(61469),G=i(53262),O=i(4853),H=i(4129),U=i(94098);const z=({textRange:e,fullText:t})=>{let i=e.start;for(;i<=e.end;){if(t.charAt(i)===U.$O||t.charAt(i)===U.Mx)return!0;i++}for(i=e.start;i>=0;){if(t.charAt(i)===U.Mx)return!1;if(t.charAt(i)===U.$O)return!0;i--}return!1};var q=i(76729);class N{constructor(e){this._params=e,this._subs=new a.w,this._logger=(0,S.h)(N.name),this._highlightCollectionFilterSource=new G.b(this._params.textObserver),this._selectionRange=m.h.create(g.YP),this.info=this._params.integrationInfo,this.highlightGeometryFilter=this._highlightCollectionFilterSource.highlightsFilterFactory(),this.highlightGeometryInvalidator=M.aj([this._params.textFieldLayout.rect.changes.pipe(R.O(this._params.textFieldLayout.rect.getCurrent())),this._params.textFieldLayout.scroll.changes.pipe(R.O(this._params.textFieldLayout.scroll.getCurrent()))]).pipe(D.D((()=>this._params.textObserver.textMapChanged))),this.selectionRange=this._selectionRange.view(),this.sidelinePositioningStrategy=(0,q.y)(this._params.textFieldElement)?{kind:"alignWithTextFieldLeftBoundary"}:{kind:"hardcodedLeftOffset",leftOffset:40},this.isEnabled=this._params.integrationInfo.integrationMode.view((e=>e===A.yj.write)),this.textRangeFilter=(0,P.ff)(z),this._subs.add(T(L.T(this._params.selectionSource.data.behavior,this._params.textObserver.contentChanges.immediate).pipe(y.h(void 0)),this._params.selectionService).subscribe(h.wW(this._selectionRange))),this._subs.add(this._selectionRange.subscribe((e=>this._logger.debug("Selection range updated.",e))))}getRewriteScope(e){if(e.vBar.text.includes(H.o2)){const t=this._params.textObserver.getCurrentTextMap().getPlainText(),i=t.slice(e.vBar.textRange.start,e.vBar.textRange.end);let r=i;for(let t=0;t<i.length;t++)if(i.charAt(t)===H.o2){const i=this._params.textObserver.getCurrentTextMap().getFragmentAtOffset(e.vBar.textRange.start+t),n=i instanceof O.I?i.getParsedFragment().fragment.text:H.o2;r=r.replace(H.o2,n)}return i!==r?(this._logger.debug('Found "smart chips" and converted them into plain text.',{originalText:i,augmentedText:r}),this._params.telemetry.infoOncePerMessage({message:"Converted Google Docs smart chips into plain text."})):(this._logger.warn('Found "smart chips" but could not convert them into plain text.',{originalText:i,augmentedText:r}),this._params.telemetry.warn({message:"Could not convert Google Docs smart chips into plain text."})),{kind:"otherText",text:t.slice(0,e.vBar.textRange.start)+r+t.slice(e.vBar.textRange.start+r.length),range:{start:e.vBar.textRange.start,end:e.vBar.textRange.start+r.length}}}return C(e.vBar.textRange)}dispose(){this._subs.unsubscribe()}}var V=i(6557),W=i(84823),j=i(8923),$=i(11456),Y=i(79992);function Q(e){return e.patternName.startsWith("Calliope/Rewrite/QualityPush")}class K{constructor(e){this._params=e,this._subs=new a.w,this._inlineAlertsFilter=m.h.create(r.W8),this.inlineAlertsFilter=this._inlineAlertsFilter.view(),this.alerts=this._params.alertProcessor.alerts.state.view((e=>Object.values(e).filter(Y.Nf).filter($.S.isTransformJsonCapiAlert))),this.calliopeAlerts=this.alerts.view((e=>e.filter(Q))),this._subs.add(this._params.alertClassification.visibleInlineAlertsFilter.pipe(x.U((e=>t=>{return e(t)&&(i=t,!this._params.featureFlags.signalingSidelines||!($.S.isCapiAlert(i)&&Q(i)));var i}))).subscribe(h.wW(this._inlineAlertsFilter)))}removeAcceptedAlert(e){this._params.alertProcessor.removeAlert(e,{_tag:j.i.alertAccepted})}ignoreAlert(e){(0,r.zG)(this._params.checkingService.get(),u.bw((t=>t.onAlertIgnored({id:e},W.e3.Vbar)))),this._params.alertProcessor.removeAlert(e,{_tag:j.i.ignore})}getCalliopeAlertsWithinTextRange(e){return function(e,t){return e.filter((e=>e.transformJSON.highlights.some((e=>e.s>=t.start&&e.e<=t.end))))}(this.calliopeAlerts.get(),e)}dispose(){this._subs.unsubscribe()}}var Z=i(4798),J=i(96176),X=i(70932);const ee=(e,t)=>`vbar-${e.kind}-${t.type.kind}`;class te{constructor(e){this._params=e,this._logger=X.Y.create("MonetizationServiceImpl"),this.vBarsQuotaInfo=m.h.combine(this._params.csPageState.view("g2Settings"),this._params.user.view("id"),this._params.user.view("premium"),((e,t,i)=>{var r;if(i||!(0,p.OB)().experimentClient.isGateEnabled(Z.K.G2VBarsMonetization))return g.YP;let n=[];const a=null===(r=null==e?void 0:e.monetization)||void 0===r?void 0:r[t];return(null==a?void 0:a.date)===(0,J.u)()&&(n=a.displayedVBarTextHashList),g.G({quota:Math.max(3-n.length,0),usedVBarsTextHashList:n})}))}markVBarUsed(e){const t=(0,r.zG)(this.vBarsQuotaInfo.get(),g.UI((({usedVBarsTextHashList:t})=>t.includes(e.textHash))),g.fS((()=>!1))),i=(0,r.zG)(this.vBarsQuotaInfo.get(),g.UI((({quota:e})=>e)),g.fS((()=>-1)));!t&&i>0&&(this._logger.debug("Updating monetization info.",{vBarTextHash:e.textHash,userId:this._params.user.get().id}),this._params.csToBgActions.markVBarUsed({vBarTextHash:e.textHash,userId:this._params.user.get().id}).catch((t=>{const i="Failed to update monetization info.",r={vBarTextHash:e.textHash,userId:this._params.user.get().id};this._logger.error(i,t,r),this._params.telemetry.error({message:i,error:t,data:r})})))}executeUphook(e,t){const i=ee(e,t);this._params.csToBgActions.openSubscriptionPage({utmCampaign:`%appName%_blurredSuggestion_${i}_pro`,utmSource:"upHook"})}}var ie=i(81259);class re{constructor(e){this._params=e,this.shouldShowOnboarding=this._params.csPageState.view("g2Settings").view((e=>"test"===(0,p.OB)().experimentClient.getTreatment(ie.p.G2VBarsOnboarding)&&!(null==e?void 0:e.onboardingShown)))}notifyOnboardingShown(){this._params.csToBgActions.setOnboardingShown().catch((e=>this._params.telemetryService.error({message:"Failed to update the onboarding shown background-page setting.",error:e})))}}var ne=i(65384);function ae(e){let t=0,i=0;const r=[];for(;i<=e.length;)"\n"!==e.charAt(i)&&""!==e.charAt(i)||(t!==i&&r.push({start:t,end:i}),t=i+1),i++;return r}class se{constructor(e){this._params=e,this._subs=new a.w,this._logger=(0,S.h)(se.name),this._paragraphs=m.h.create([]),this._paragraphById=new Map,this.paragraphs=this._paragraphs.view(),this._editingParagraphIndex=m.h.create(-1),this.editingParagraphIndex=this._editingParagraphIndex.view(),this._subs.add(this._params.textObserver.contentChanges.async.pipe(l.h((e=>!e.deltaChange.isEmpty)),b.b(1e3),R.O(null),x.U((()=>{const e=this._params.textObserver.getCurrentTextMap().getPlainText();return{paragraphTextRanges:ae(e),fullText:e}})),x.U((({paragraphTextRanges:e,fullText:t})=>{const i=e.map(((e,i)=>function(e,t,i){return{id:`g2-paragraph-${t.start}-${t.end}`,sequentialId:e,textRange:t,text:i.slice(t.start,t.end),fullTextLength:i.length}}(i,e,t)));return i.filter((e=>this._params.integration.textRangeFilter({textRange:e.textRange,fullText:t})))}))).subscribe(h.wW(this._paragraphs))),this._subs.add(this._editingParagraphIndex.pipe(l.h((e=>-1===e)),(0,o.w)((()=>this._params.textObserver.contentChanges.async.pipe(l.h((e=>!e.deltaChange.isEmpty)),d.q(1),x.U((({changes:e})=>{const[t]=e,i=ne.q.isIns(t)?t.pos:t.pos-t.text.length;return this._paragraphs.get().findIndex((({textRange:e})=>{if(!(e.end<i))return!0}))})))))).subscribe((e=>{this._editingParagraphIndex.set(e)}))),this._subs.add(this._paragraphs.subscribe((e=>{this._paragraphById.clear();for(const t of e)this._paragraphById.set(t.id,t)}))),this._subs.add(this._paragraphs.subscribe((e=>this._logger.debug("Paragraphs updated.",e))))}resetEditingParagraphIndex(){this._editingParagraphIndex.set(-1)}getParagraphById(e){return g.ij(this._paragraphById.get(e))}dispose(){this._subs.unsubscribe()}}var oe=i(72848),le=i(65043),de=i(21768),ce=i(58638),he=i(49144),ge=i(47338),ue=i(78008),me=i(21885),pe=i(17071),ve=i(68259),fe=i(12518),we=i(62057),Se=i(21409),_e=i(38508),be=i(57935),ye=i(10393),ke=i(11633);const Ce=ke.OT(ke.i0("text_actions")),Re=ke.OT(ke.dt({action:Ce,id:ke.OT(ke.pk)}));function xe(e){return Re.is(e)}var Be=i(6824),Ee=i(36661),Ie=i(17198);const Te=Ee.n(Ie.l7(Be.Schemable)({sensitiveString:Be.string}))(Ie.a9).is,Fe=Ie.Sy((e=>e.struct({kind:e.literal(we.PU.Final)}))),Pe=Ie.Sy((e=>e.intersect(Fe(e))(Ie.WV(e)))),Me=Ee.n(Ie.l7(Be.Schemable)({sensitiveString:Be.string}))(Pe).is,De=Ie.Sy((e=>e.struct({kind:e.literal(we.PU.Partial)}))),Le=Ie.Sy((e=>e.intersect(De(e))(Ie.WV(e)))),Ae=Ee.n(Ie.l7(Be.Schemable)({sensitiveString:Be.string}))(Le).is;var Ge=i(48377);function Oe(e,t){const i=(e=>{switch(e.kind){case"improve":return{kind:"default"};case"rephrase":return{kind:"rephrase"};case"shorten":return{kind:"other",actionId:{id:"VBarG2Shorter"}};case"friendly":return{kind:"other",actionId:{id:"VBarG2Friendly"}};case"formal":return{kind:"other",actionId:{id:"VBarG2Formal"}};case"customPrompt":return{kind:"userPrompt",prompt:e.prompt};default:(0,ve.L0)(e)}})(e.type);return{correlationId:e.id,kind:{...i},entrypoint:{family:"g2",name:we.K0.VbarCard,request_tag:`${e.vBar.kind}${t?"_preloading":""}`},args:{},metadata:{}}}const He=be.m9(3),Ue=be.m9(3),ze=be.m9(1),qe=be.m9(10);function Ne(e){return`rewrite-request-sent-${e}`}function Ve(e){const t=Ne(e),i=performance.getEntriesByName(t).length>0?performance.measure(`rewrite-result-received-${e}`,t).duration:void 0;return performance.clearMarks(t),i}class We{constructor(e){this._params=e,this._subs=new a.w,this._logger=(0,S.h)(We.name),this._relevantCapiMessages=this._params.checkingService.pipe(s.oA,o.w((e=>e.capiMessages)),l.h((0,pe.Kg)(xe,Me,Te))),this._rewritePartialMessages=this._params.checkingService.pipe(s.oA,o.w((e=>e.capiMessages)),l.h(Ae),ce.p(300)),this._cachedRewriteIdMap=new Map,this._cachedRewriteMap=new Map,this._ackMessageIds=new he.X(new Set),this._waitForCheckingStatusNotInProgress=async e=>{var t,i;await e.checkingStatus.pipe(b.b(300),ge.n((e=>e===Se.H.inProgress)),d.q(1),ue.V(null!==(i=null===(t=this._params.dynamicConfig.view("vBars").get())||void 0===t?void 0:t.checkingStatusInProgressTimeoutMs)&&void 0!==i?i:Ue)).toPromise()},this._waitForLatestCheckingRevision=async e=>{var t,i;await e.checkingRevisionInfo.pipe(b.b(100),d.q(1),ue.V(null!==(i=null===(t=this._params.dynamicConfig.view("vBars").get())||void 0===t?void 0:t.waitForLatestCheckingRevisionTimeoutMs)&&void 0!==i?i:ze)).toPromise()},this._waitForCAPITextRevisionSyncStrategy=(0,p.OB)().experimentClient.isGateEnabled(Z.K.G2VBarsWaitForLatestCheckingRevisionBeforeGettingRewrite)?"waitForLatestCheckingRevision":"waitForCheckingStatusNotInProgress",this._waitForCAPITextRevisionSync="waitForLatestCheckingRevision"===this._waitForCAPITextRevisionSyncStrategy?this._waitForLatestCheckingRevision:this._waitForCheckingStatusNotInProgress,this._subs.add(this._relevantCapiMessages.subscribe((e=>this._handleServerMessage(e)))),this._subs.add(this._rewritePartialMessages.subscribe((e=>this._handleServerMessage(e)))),this._subs.add(this._params.checkingService.subscribe((e=>{g.pC(e)?this._logger.debug("Checking service available."):this._logger.debug("Checking service not available.")}))),this._subs.add(this._params.checkingService.pipe(o.w(g.g_((()=>me.C),(e=>e.capiMessages)))).subscribe((e=>this._logger.debug("Received CAPI message.",e))))}_handleServerMessage(e){xe(e)?this._handleAckMessage(e):Te(e)?(this._params.telemetryService.warn({message:'Server message with result "failure" received.'}),this._handleErrorMessage(e)):Me(e)?(this._params.telemetryService.infoOncePerMessage({message:'Server message with result "success" received.'}),this._handleRewriteResultMessage(e)):Ae(e)?(this._params.telemetryService.infoOncePerMessage({message:'Server message with result "partial" received.'}),(0,p.OB)().experimentClient.isGateEnabled(Z.K.G2VBarsStreaming)&&this._handleRewriteResultMessage(e)):(0,ve.vE)(e)}_handleAckMessage(e){const t=this._ackMessageIds.getValue();t.add(e.id),this._ackMessageIds.next(t)}_handleRewriteResultMessage(e){var t;const i=this._cachedRewriteMap.get(e.correlationId);if(void 0===i)this._logger.warn("Received a successful result with unknown correlation ID.",{resultSuccessMessage:e}),this._params.telemetryService.warn({message:'Server message with result "success" and unknown correlation ID received.'});else{const n={id:i.get().id,vBar:i.get().vBar,type:i.get().type,augmentedText:i.get().augmentedText};if(e.kind===we.PU.Partial){const t={...n,kind:"loading",patternName:e.actionId.id,rewriteTextPartial:e.rewrite};i.set(t)}else{this._params.trackingService.vBarCardRewriteResultReceived({vBar:n.vBar,rewriteType:n.type,duration:Ve(e.correlationId)});const a={...n,kind:"ready",title:e.explanation,rewriteText:e.rewrite,rewriteDiff:(0,r.zG)(Ge.FS.getDiff(null!==(t=g.WG(i.get().augmentedText))&&void 0!==t?t:i.get().vBar.text,e.rewrite),fe.mapLeft((t=>this._logger.error("Failed to get diff for rewrite.",{error:t,newText:e.rewrite}))),g.Uo),source:{kind:"server"},patternName:e.actionId.id};this._logger.debug("Received a successful result; updating rewrite.",{rewriteBefore:i.get(),rewriteAfter:a}),i.set(a)}}}_handleErrorMessage(e){const t=this._cachedRewriteMap.get(e.correlationId);if(void 0===t)this._logger.warn("Received a failed result with unknown correlation ID.",{errorMessage:e}),this._params.telemetryService.warn({message:'Server message with result "failure" and unknown correlation ID received.'});else{const i={kind:"error",id:t.get().id,vBar:t.get().vBar,type:t.get().type,augmentedText:t.get().augmentedText,errorReason:e.errorType.kind,errorDetails:e.details,source:{kind:"server"}};this._logger.debug("Received a failed result; updating rewrite.",{rewriteBefore:t.get(),rewriteAfter:i}),t.set(i)}}_forceReconnect(){var e;this._ackMessageIds.next(new Set),null===(e=g.WG(this._params.checkingService.get()))||void 0===e||e.reconnect()}async _performRewriteRequest(e,t,i,n){const a=(0,oe.Z)();this._cachedRewriteIdMap.set(e,a);const s=m.h.create({kind:"loading",id:a,vBar:t,type:i,augmentedText:g.YP});return this._cachedRewriteMap.set(s.get().id,s),await(0,r.zG)(this._params.checkingService.get(),g.g_((()=>{const e="Getting rewrite failed: Checking service not initialized.";return this._logger.error(e),this._params.telemetryService.error({message:e}),s.modify((e=>({...e,kind:"error",errorReason:"checkingServiceUnavailable",source:{kind:"server"}}))),Promise.resolve(s)}),(async e=>{var r,a,o,l;try{this._logger.debug("Flushing text change buffer before sending rewrite request."),this._params.textChangeBuffer.flush(),await this._waitForCAPITextRevisionSync(e)}catch(e){const t="Getting rewrite failed: Something went wrong while waiting for CAPI text revision to sync with local text changes.";return this._logger.error(t,{error:e,waitForCAPITextRevisionSyncStrategy:this._waitForCAPITextRevisionSyncStrategy}),this._params.telemetryService.error({message:t,error:e,data:{waitForCAPITextRevisionSyncStrategy:this._waitForCAPITextRevisionSyncStrategy}}),s.modify((e=>({...e,kind:"error",errorReason:"waitForLatestCheckingRevision"===this._waitForCAPITextRevisionSyncStrategy?"waitForLatestCheckingRevisionTimeout":"checkingStatusInProgressTimeout",source:{kind:"server"}}))),s}const c=Oe(s.get(),n),h=this._params.integration.getRewriteScope(s.get());"otherText"===h.kind&&s.modify((e=>{var t,i;return{...e,augmentedText:g.G(h.text.slice(null===(t=h.range)||void 0===t?void 0:t.start,null===(i=h.range)||void 0===i?void 0:i.end))}}));try{this._logger.debug('Sending "text_actions:invokeRewrite" message to CAPI.',{data:c,scope:h}),performance.mark(Ne(c.correlationId)),this._params.trackingService.vBarCardRewriteRequestSent({vBar:t,rewriteType:i});const n=await e.sendMessage("text_actions:invokeRewrite",c,!1,{kind:"scope",scope:h})();if(fe.isLeft(n))throw n.left.message;{this._subs.add(this._ackMessageIds.pipe(ge.n((e=>!e.has(n.right))),d.q(1),ue.V(null!==(a=null===(r=this._params.dynamicConfig.get().vBars)||void 0===r?void 0:r.rewriteAckTimeoutMs)&&void 0!==a?a:He)).subscribe({error:()=>{const e="Never received ack for rewrite; forcing reconnect.",i={vBarType:t.kind,rewriteType:s.get().type.kind};this._logger.error(e,i),this._params.telemetryService.error({message:e,data:i}),this._forceReconnect()}}));const e=null!==(l=null===(o=this._params.dynamicConfig.view("vBars").get())||void 0===o?void 0:o.rewriteLoadingTimeoutMs)&&void 0!==l?l:qe;return this._subs.add(s.pipe(ge.n((e=>"loading"===e.kind)),d.q(1),ue.V(e)).subscribe({error:()=>{const e="Rewrite stuck loading; transitioning to error state.",i={vBarType:t.kind,rewriteType:s.get().type.kind};this._logger.error(e,i),this._params.telemetryService.error({message:e,data:i}),s.modify((e=>({...e,kind:"error",errorReason:"rewriteLoadingTimeout",source:{kind:"server"}})))}})),this._logger.debug("Returning un-cached rewrite.",s.get()),s}}catch(e){const t='Getting rewrite failed: Sending "text_actions:invokeRewrite" message to CAPI failed.';return this._logger.error(t,{error:e}),this._params.telemetryService.error({message:t,error:e}),s.modify((e=>({...e,kind:"error",errorReason:"rewriteRequestFailure",source:{kind:"server"}}))),s}})))}async getRewrite(e){this._logger.debug("Getting rewrite.",e);const{rewriteType:t,skipCache:i,vBar:r,isPreload:n}=e,a=(0,ye.Wu)(r.text),s=`${t.kind}-${r.textRange.start}-${r.textRange.end}-${a}`,o=this._cachedRewriteIdMap.get(s),l=void 0!==o?this._cachedRewriteMap.get(o):void 0,d="customPrompt"!==t.kind&&!i&&void 0!==l&&"error"!==l.get().kind;return d?(l.modify(je),this._logger.debug("Returning cached rewrite.",l.get()),l):(d||void 0===o||this._cachedRewriteMap.delete(o),this._performRewriteRequest(s,r,t,n))}getImproveRewriteFromCalliopeAlert(e){var t;const i=(0,oe.Z)(),n=(0,r.zG)(e.calliopeAlert.transformJSON.alternatives,g.UI((e=>e.context[0])),g.WG),a=(0,r.zG)(e.calliopeAlert.transformJSON.alternatives,g.UI((e=>e.alternatives[0])),g.WG);if(null===n||n.s<e.vBar.textRange.start||n.e>e.vBar.textRange.end||null===a){const t='Failed to retrieve "improve" rewrite from Calliope alert.';return this._logger.error(t),this._params.telemetryService.error({message:t}),{kind:"error",id:i,vBar:e.vBar,type:{kind:"improve"},augmentedText:g.YP,errorReason:"rewriteFromCalliopeAlertFailure",source:{kind:"alert",alertId:e.calliopeAlert.id}}}const s=a.ops.filter((e=>!le.JU.isOptionalContextRetain(e))),o=[{retain:n.s-e.vBar.textRange.start},...s],l=new de.i(o),d=(0,_e.l)(l,e.vBar.text);return{kind:"ready",id:i,vBar:e.vBar,type:{kind:"improve"},augmentedText:g.YP,title:null!==(t=e.calliopeAlert.extraProperties.vbar_card_title)&&void 0!==t?t:"Use our best version",rewriteText:d,rewriteDiff:(0,r.zG)(Ge.FS.getDiff(e.vBar.text,d),fe.mapLeft((e=>this._logger.error("Failed to get diff for rewrite.",{error:e,newText:d}))),g.Uo),source:{kind:"alert",alertId:e.calliopeAlert.id},patternName:e.calliopeAlert.patternName}}dispose(){this._subs.unsubscribe()}}function je(e){return"ready"===e.kind?{...e,source:{kind:"cache"}}:e}var $e=i(11036);const Ye=Ee.n(Be.Schemable)($e.Ct).is;var Qe=i(51482);const Ke=(e,t)=>[e.id,t].join("-");class Ze{constructor(e){this._params=e,this._subs=new a.w,this._subs.add(this._params.checkingService.pipe(s.oA,o.w((e=>e.capiMessages)),l.h(Ye),l.h((e=>e.result!==Qe.e.Success))).subscribe((e=>{e.result===Qe.e.ValidationFail?this._params.telemetryService.error({message:"vBar CAPI feedback validation failed.",error:e.errorMessage}):e.result===Qe.e.Error&&this._params.telemetryService.error({message:"vBar CAPI feedback processing failed.",error:e.errorMessage})})))}_getRewriteReadyShownResult(e,t){if(t)return Qe.R.Uphook;const{kind:i}=e.source;switch(i){case"server":return Qe.R.Loaded;case"cache":return Qe.R.Cached;case"alert":return Qe.R.Prepopulated;default:(0,ve.L0)(i)}}_getRewriteErrorShownResult(e){switch(e.errorReason){case"backendError":return Qe.R.FailedBackendError;case"badRequest":return Qe.R.FailedBadRequest;case"sensitivity":return Qe.R.FailedSensitivity;case"serviceLimitExceeded":return Qe.R.FailedServiceLimitExceeded;case"unsupportedLanguage":return Qe.R.FailedUnsupportedLanguage;case"updateClient":return Qe.R.FailedUpdateClient;case"rewriteRequestFailure":case"rewriteLoadingTimeout":case"rewriteFromCalliopeAlertFailure":case"checkingStatusInProgressTimeout":case"checkingServiceUnavailable":case"waitForLatestCheckingRevisionTimeout":case"other":return Qe.R.FailedOther;default:(0,ve.L0)(e.errorReason)}}_getVBarFeedbackRequestMessageData(e,t,i){const n={actionType:e,vBarType:t.kind,range:{start:t.textRange.start,end:t.textRange.end},...i};return(0,r.zG)(this._params.checkingService.get(),g.tS((e=>g.ij(e.sessionUuid))),g.g_((()=>(this._params.telemetryService.error({message:"Failed to retrieve sessionUuid while sending CAPI feedback; won't add it to vBarId."}),{...n,vBarId:t.id})),(e=>({...n,vBarId:Ke(t,e)}))))}_sendVBarFeedbackRequestMessage(e){(0,r.zG)(this._params.checkingService.get(),g.g_((()=>Promise.reject("Checking service not available.")),(async t=>{const i=await t.sendMessage("vbar_feedback:vBarFeedbackRequest",e,!1)();if(fe.isLeft(i))throw i.left;return i.right}))).catch((t=>this._params.telemetryService.error({message:"Failed to send vBar CAPI feedback.",error:t,data:e})))}vBarShown(e){const t=this._getVBarFeedbackRequestMessageData("entrypoint_show",e.vBar);this._sendVBarFeedbackRequestMessage(t)}vBarHidden(e){const t=this._getVBarFeedbackRequestMessageData("entrypoint_hide",e.vBar);this._sendVBarFeedbackRequestMessage(t)}vBarCardShown(e){const t=this._getVBarFeedbackRequestMessageData("card_show",e.vBar);this._sendVBarFeedbackRequestMessage(t)}vBarCardClosed(e){const t=this._getVBarFeedbackRequestMessageData("card_close",e.vBar);this._sendVBarFeedbackRequestMessage(t)}vBarCardRewriteStreamingStart(e){var t;const i=this._getVBarFeedbackRequestMessageData("card_rewrite_streaming_start",e.vBar,{pname:null!==(t=e.rewrite.patternName)&&void 0!==t?t:"",..."customPrompt"===e.rewrite.type.kind?{userPrompt:e.rewrite.type.prompt}:void 0,loadingTimeMs:e.duration});this._sendVBarFeedbackRequestMessage(i)}vBarCardRewriteEmptyShown(e){const t=this._getVBarFeedbackRequestMessageData("card_rewrite_show",e.vBar,{pname:e.rewrite.patternName,rewrite:e.rewrite.rewriteText,..."customPrompt"===e.rewrite.type.kind?{userPrompt:e.rewrite.type.prompt}:void 0,loadingTimeMs:e.duration,result:Qe.R.Empty});this._sendVBarFeedbackRequestMessage(t)}vBarCardRewriteReadyShown(e){const t=this._getVBarFeedbackRequestMessageData("card_rewrite_show",e.vBar,{pname:e.rewrite.patternName,rewrite:e.rewrite.rewriteText,..."customPrompt"===e.rewrite.type.kind?{userPrompt:e.rewrite.type.prompt}:void 0,loadingTimeMs:e.duration,result:this._getRewriteReadyShownResult(e.rewrite,e.isUphook)});this._sendVBarFeedbackRequestMessage(t)}vBarCardRewriteErrorShown(e){const t=this._getVBarFeedbackRequestMessageData("card_rewrite_show",e.vBar,{..."customPrompt"===e.rewrite.type.kind?{userPrompt:e.rewrite.type.prompt}:void 0,loadingTimeMs:e.duration,result:this._getRewriteErrorShownResult(e.rewrite)});this._sendVBarFeedbackRequestMessage(t)}vBarCardRewriteApplied(e){const t=this._getVBarFeedbackRequestMessageData("card_rewrite_apply",e.vBar,{pname:e.rewrite.patternName,rewrite:e.rewrite.rewriteText,..."customPrompt"===e.rewrite.type.kind?{userPrompt:e.rewrite.type.prompt}:void 0});this._sendVBarFeedbackRequestMessage(t)}vBarCardRewriteDismissed(e){const t=this._getVBarFeedbackRequestMessageData("card_rewrite_dismiss",e.vBar,{pname:e.rewrite.patternName,rewrite:e.rewrite.rewriteText,..."customPrompt"===e.rewrite.type.kind?{userPrompt:e.rewrite.type.prompt}:void 0});this._sendVBarFeedbackRequestMessage(t)}vBarCardRewriteCopied(e){const t=this._getVBarFeedbackRequestMessageData("card_rewrite_copy",e.vBar,{pname:e.rewrite.patternName,rewrite:e.rewrite.rewriteText,..."customPrompt"===e.rewrite.type.kind?{userPrompt:e.rewrite.type.prompt}:void 0});this._sendVBarFeedbackRequestMessage(t)}vBarCardShowLessClicked(e){const t=this._getVBarFeedbackRequestMessageData("card_show_less",e.vBar);this._sendVBarFeedbackRequestMessage(t)}vBarCardRewriteReverted(e){const t=this._getVBarFeedbackRequestMessageData("card_rewrite_revert",e.vBar,{pname:e.rewrite.patternName,rewrite:e.rewrite.rewriteText,..."customPrompt"===e.rewrite.type.kind?{userPrompt:e.rewrite.type.prompt}:void 0});this._sendVBarFeedbackRequestMessage(t)}dispose(){this._subs.unsubscribe()}}var Je=i(99836);class Xe{constructor(e){this._params=e,this._felog=(0,Je.Tb)(),this._commonLabels={domain:this._params.integrationInfo.domain,integrationName:this._params.integrationInfo.integrationName}}vBarsInitialized(){this._felog.sendFemetricsRate("vBarsInitialized",this._commonLabels)}vBarCardRewriteRequestSent(e){const t={...this._commonLabels,vBarType:e.vBar.kind,rewriteType:e.rewriteType.kind};this._felog.sendFemetricsRate("vBarCardRewriteRequestSent",t)}vBarCardRewriteResultReceived(e){const t={...this._commonLabels,vBarType:e.vBar.kind,rewriteType:e.rewriteType.kind};this._felog.sendFemetricsRate("vBarCardRewriteResultReceived",t),e.duration&&this._felog.sendFemetricsTimer("vBarCardRewriteResultReceived",e.duration,"histogram",t)}vBarCardRewriteReadyShown(e){const t={...this._commonLabels,vBarType:e.vBar.kind,rewriteType:e.rewrite.type.kind,rewriteSource:e.rewrite.source.kind,isUphook:e.isUphook};this._felog.sendFemetricsRate("vBarCardRewriteReadyShown",t),e.duration&&this._felog.sendFemetricsTimer("vBarCardRewriteReadyShown",e.duration,"histogram",t)}vBarCardRewriteEmptyShown(e){const t={...this._commonLabels,vBarType:e.vBar.kind,rewriteType:e.rewrite.type.kind,rewriteSource:e.rewrite.source.kind};this._felog.sendFemetricsRate("vBarCardRewriteEmptyShown",t),e.duration&&this._felog.sendFemetricsTimer("vBarCardRewriteEmptyShown",e.duration,"histogram",t)}vBarCardRewriteErrorShown(e){const t={...this._commonLabels,vBarType:e.vBar.kind,rewriteType:e.rewrite.type.kind,rewriteSource:e.rewrite.source.kind,rewriteErrorReason:e.rewrite.errorReason};this._felog.sendFemetricsRate("vBarCardRewriteErrorShown",t),e.duration&&this._felog.sendFemetricsTimer("vBarCardRewriteErrorShown",e.duration,"histogram",t)}vBarCardRewriteUphookShown(e){const t=ee(e.vBar,e.rewrite);this._felog.upgradeHooks.showUpgradeHook("blurredSuggestion",t,"pro");const i={...this._commonLabels,vBarType:e.vBar.kind,rewriteType:e.rewrite.type.kind,rewriteSource:e.rewrite.source.kind};this._felog.sendFemetricsRate("vBarCardRewriteUphookShown",i)}vBarCardRewriteUphookClicked(e){const t=ee(e.vBar,e.rewrite);this._felog.upgradeHooks.clickUpgradeHook("blurredSuggestion",t,"pro");const i={...this._commonLabels,vBarType:e.vBar.kind,rewriteType:e.rewrite.type.kind,rewriteSource:e.rewrite.source.kind};this._felog.sendFemetricsRate("vBarCardRewriteUphookClicked",i)}vBarCardRewriteStreamingStart(e){const t={...this._commonLabels,vBarType:e.vBar.kind,rewriteType:e.rewrite.type.kind};this._felog.sendFemetricsRate("vBarCardRewriteStreamingStart",t),e.duration&&this._felog.sendFemetricsTimer("vBarCardRewriteStreamingStart",e.duration,"histogram",t)}}class et{constructor(e){this._params=e}_sendTelemetryError(e,t){this._params.telemetryService.error({message:"Failed to track Gnar event.",error:t,data:{eventName:e}})}_sendNoSessionUuidTelemetryError(e){this._sendTelemetryError(e,"Failed to retrieve sessionUuid.")}_trackWithSessionUuid(e,t){return(0,r.zG)(this._params.checkingService.get(),g.tS((e=>g.ij(e.sessionUuid))),g.g_((()=>this._sendNoSessionUuidTelemetryError(e)),(i=>t(i).catch((t=>this._sendTelemetryError(e,t))))))}_isGoogleDocs(){return"googleDocs"===this._params.integrationInfo.kind}_getRewriteReadyShownStatus(e,t){if(t)return"uphook";const{kind:i}=e.source;switch(i){case"server":return"loaded";case"cache":return"cached";case"alert":return"prepopulated";default:(0,ve.L0)(i)}}_getRewriteErrorShownStatus(e){return`failed_${e.errorReason}`}vBarShown(e){this._trackWithSessionUuid("vBarEntrypointShow",(t=>this._params.gnarClient.vBarEntrypointShow(this._isGoogleDocs(),t,e.vBar.textHash,e.vBar.fullTextLength,Ke(e.vBar,t),e.vBar.text.length,e.vBar.kind)))}vBarHidden(e){this._trackWithSessionUuid("vBarEntrypointClose",(t=>this._params.gnarClient.vBarEntrypointClose(this._isGoogleDocs(),t,e.vBar.textHash,e.vBar.fullTextLength,Ke(e.vBar,t),e.vBar.text.length,e.vBar.kind)))}vBarCardShown(e){this._trackWithSessionUuid("vBarCardShow",(t=>this._params.gnarClient.vBarCardShow(this._isGoogleDocs(),e.isUphook,t,e.vBar.textHash,e.vBar.fullTextLength,Ke(e.vBar,t),e.vBar.text.length,e.vBar.kind)))}vBarCardClosed(e){this._trackWithSessionUuid("vBarCardClose",(t=>this._params.gnarClient.vBarCardClose(this._isGoogleDocs(),t,e.vBar.textHash,e.vBar.fullTextLength,Ke(e.vBar,t),e.vBar.text.length,e.vBar.kind)))}vBarCardCustomPromptSubmitted(e){this._trackWithSessionUuid("vBarCardSubmitCustomPrompt",(t=>this._params.gnarClient.vBarCardSubmitCustomPrompt(this._isGoogleDocs(),t,e.vBar.textHash,e.vBar.fullTextLength,Ke(e.vBar,t),e.vBar.text.length,e.vBar.kind)))}vBarCardRewriteSelected(e){this._trackWithSessionUuid("vBarCardPromptSubmit",(t=>this._params.gnarClient.vBarCardPromptSubmit(this._isGoogleDocs(),e.previousRewriteType.kind,e.rewriteType.kind,t,e.vBar.textHash,e.vBar.fullTextLength,Ke(e.vBar,t),e.vBar.text.length,e.vBar.kind)))}vBarCardRewriteStreamingStart(e){this._trackWithSessionUuid("vBarCardRewriteStreamingStart",(t=>this._params.gnarClient.vBarCardStreamingStart(this._isGoogleDocs(),e.rewrite.type.kind,t,e.vBar.textHash,e.vBar.fullTextLength,Ke(e.vBar,t),e.vBar.text.length,e.vBar.kind,e.duration)))}vBarCardRewriteEmptyShown(e){this._trackWithSessionUuid("vBarCardLoaded",(t=>this._params.gnarClient.vBarCardLoaded(this._isGoogleDocs(),e.rewrite.type.kind,"empty",t,e.vBar.textHash,e.vBar.fullTextLength,Ke(e.vBar,t),e.vBar.text.length,e.vBar.kind,e.duration)))}vBarCardRewriteReadyShown(e){this._trackWithSessionUuid("vBarCardLoaded",(t=>this._params.gnarClient.vBarCardLoaded(this._isGoogleDocs(),e.rewrite.type.kind,this._getRewriteReadyShownStatus(e.rewrite,e.isUphook),t,e.vBar.textHash,e.vBar.fullTextLength,Ke(e.vBar,t),e.vBar.text.length,e.vBar.kind,e.duration)))}vBarCardRewriteErrorShown(e){this._trackWithSessionUuid("vBarCardLoaded",(t=>this._params.gnarClient.vBarCardLoaded(this._isGoogleDocs(),e.rewrite.type.kind,this._getRewriteErrorShownStatus(e.rewrite),t,e.vBar.textHash,e.vBar.fullTextLength,Ke(e.vBar,t),e.vBar.text.length,e.vBar.kind,e.duration)))}vBarCardRewriteApplied(e){this._trackWithSessionUuid("vBarCardRewriteApply",(t=>this._params.gnarClient.vBarCardRewriteApply(this._isGoogleDocs(),e.rewrite.type.kind,t,e.vBar.textHash,e.vBar.fullTextLength,Ke(e.vBar,t),e.vBar.text.length,e.vBar.kind)))}vBarCardRewriteDismissed(e){this._trackWithSessionUuid("vBarCardRewriteDismissed",(t=>this._params.gnarClient.vBarCardRewriteDismiss(this._isGoogleDocs(),e.rewrite.type.kind,t,e.vBar.textHash,e.vBar.fullTextLength,Ke(e.vBar,t),e.vBar.text.length,e.vBar.kind)))}vBarCardRewriteCopied(e){this._trackWithSessionUuid("vBarCardRewriteCopy",(t=>this._params.gnarClient.vBarCardRewriteCopy(this._isGoogleDocs(),e.rewrite.type.kind,t,e.vBar.textHash,e.vBar.fullTextLength,Ke(e.vBar,t),e.vBar.text.length,e.vBar.kind)))}vBarCardRewriteReverted(e){this._trackWithSessionUuid("vBarCardRewriteRevert",(t=>this._params.gnarClient.vBarCardRewriteRevert(this._isGoogleDocs(),e.rewrite.type.kind,t,e.vBar.textHash,e.vBar.fullTextLength,Ke(e.vBar,t),e.vBar.text.length,e.vBar.kind)))}vBarCardRewriteRegenerated(e){this._trackWithSessionUuid("vBarCardRewriteRegenerate",(t=>this._params.gnarClient.vBarCardRewriteRegenerate(this._isGoogleDocs(),e.rewrite.type.kind,t,e.vBar.textHash,e.vBar.fullTextLength,Ke(e.vBar,t),e.vBar.text.length,e.vBar.kind)))}vBarCardRewriteFeedbackSubmitted(e){const t=JSON.stringify({vBarId:e.vBar.id,vBarType:e.vBar.kind,prompt:e.rewrite.type.kind,message:e.feedbackFormData.text,domain:e.feedbackFormData.domain,isGoogleDocs:this._isGoogleDocs()});this._params.gnarClient.feedbackSentButtonClick(t,"g2",e.feedbackFormData.score).catch((e=>this._sendTelemetryError("feedbackSentButtonClick",e)))}vBarCardRewriteUphookShown(e){const t=ee(e.vBar,e.rewrite);this._trackWithSessionUuid("getPremiumButtonShow",(e=>this._params.gnarClient.getPremiumButtonShow("blurredSuggestion",void 0,void 0,void 0,void 0,void 0,!1,void 0,void 0,e,"blurredSuggestion",t,"pro")))}vBarCardRewriteUphookClicked(e){const t=ee(e.vBar,e.rewrite);this._trackWithSessionUuid("getPremiumButtonClick",(e=>this._params.gnarClient.getPremiumButtonClick("blurredSuggestion",void 0,void 0,void 0,void 0,void 0,!1,void 0,void 0,e,"blurredSuggestion",t,"pro")))}vBarCardShowLessClicked(e){this._trackWithSessionUuid("vBarCardShowLess",(t=>this._params.gnarClient.vBarCardShowLess(e.domain,this._isGoogleDocs(),e.rewrite.type.kind,t,e.vBar.textHash,e.vBar.fullTextLength,Ke(e.vBar,t),e.vBar.text.length,e.vBar.kind)))}}class tt{constructor(e){this._params=e,this._gnarTrackingService=new et({gnarClient:this._params.gnarClient,checkingService:this._params.checkingService,integrationInfo:this._params.integrationInfo,telemetryService:this._params.telemetryService}),this._capiFeedbacksTrackingService=new Ze({checkingService:this._params.checkingService,telemetryService:this._params.telemetryService}),this._feMetricsTrackingService=new Xe({integrationInfo:this._params.integrationInfo})}vBarsInitialized(){this._feMetricsTrackingService.vBarsInitialized()}vBarShown(e){this._gnarTrackingService.vBarShown(e),this._capiFeedbacksTrackingService.vBarShown(e)}vBarHidden(e){this._gnarTrackingService.vBarHidden(e),this._capiFeedbacksTrackingService.vBarHidden(e)}vBarCardShown(e){this._gnarTrackingService.vBarCardShown(e),this._capiFeedbacksTrackingService.vBarCardShown(e)}vBarCardClosed(e){this._gnarTrackingService.vBarCardClosed(e),this._capiFeedbacksTrackingService.vBarCardClosed(e)}vBarCardCustomPromptSubmitted(e){this._gnarTrackingService.vBarCardCustomPromptSubmitted(e)}vBarCardRewriteSelected(e){this._gnarTrackingService.vBarCardRewriteSelected(e)}vBarCardRewriteRequestSent(e){this._feMetricsTrackingService.vBarCardRewriteRequestSent(e)}vBarCardRewriteResultReceived(e){this._feMetricsTrackingService.vBarCardRewriteResultReceived(e)}vBarCardRewriteStreamingStart(e){this._gnarTrackingService.vBarCardRewriteStreamingStart(e),this._capiFeedbacksTrackingService.vBarCardRewriteStreamingStart(e),this._feMetricsTrackingService.vBarCardRewriteStreamingStart(e)}vBarCardRewriteEmptyShown(e){this._gnarTrackingService.vBarCardRewriteEmptyShown(e),this._capiFeedbacksTrackingService.vBarCardRewriteEmptyShown(e),this._feMetricsTrackingService.vBarCardRewriteEmptyShown(e)}vBarCardRewriteReadyShown(e){this._gnarTrackingService.vBarCardRewriteReadyShown(e),this._capiFeedbacksTrackingService.vBarCardRewriteReadyShown(e),this._feMetricsTrackingService.vBarCardRewriteReadyShown(e)}vBarCardRewriteErrorShown(e){this._gnarTrackingService.vBarCardRewriteErrorShown(e),this._capiFeedbacksTrackingService.vBarCardRewriteErrorShown(e),this._feMetricsTrackingService.vBarCardRewriteErrorShown(e)}vBarCardRewriteApplied(e){this._gnarTrackingService.vBarCardRewriteApplied(e),this._capiFeedbacksTrackingService.vBarCardRewriteApplied(e)}vBarCardRewriteDismissed(e){this._gnarTrackingService.vBarCardRewriteDismissed(e),this._capiFeedbacksTrackingService.vBarCardRewriteDismissed(e)}vBarCardRewriteCopied(e){this._gnarTrackingService.vBarCardRewriteCopied(e),this._capiFeedbacksTrackingService.vBarCardRewriteCopied(e)}vBarCardRewriteReverted(e){this._gnarTrackingService.vBarCardRewriteReverted(e),this._capiFeedbacksTrackingService.vBarCardRewriteReverted(e)}vBarCardRewriteRegenerated(e){this._gnarTrackingService.vBarCardRewriteRegenerated(e)}vBarCardRewriteFeedbackSubmitted(e){this._gnarTrackingService.vBarCardRewriteFeedbackSubmitted(e)}vBarCardRewriteUphookShown(e){this._gnarTrackingService.vBarCardRewriteUphookShown(e),this._feMetricsTrackingService.vBarCardRewriteUphookShown(e)}vBarCardRewriteUphookClicked(e){this._gnarTrackingService.vBarCardRewriteUphookClicked(e),this._feMetricsTrackingService.vBarCardRewriteUphookClicked(e)}vBarCardShowLessClicked(e){this._gnarTrackingService.vBarCardShowLessClicked(e),this._capiFeedbacksTrackingService.vBarCardShowLessClicked({vBar:e.vBar})}dispose(){this._capiFeedbacksTrackingService.dispose()}}var it=i(67834);const rt=n.lazy((()=>Promise.all([i.e(2779),i.e(3637),i.e(6984),i.e(3005),i.e(274)]).then(i.bind(i,49533)).then((({FeedbackForm:e})=>({default:e}))))),nt=n.lazy((()=>Promise.all([i.e(2779),i.e(3637),i.e(6984),i.e(3005),i.e(274)]).then(i.bind(i,70)).then((({SidelineCardWrapper:e})=>({default:e}))))),at=n.lazy((()=>Promise.all([i.e(2779),i.e(3637),i.e(6984),i.e(3005),i.e(274)]).then(i.bind(i,48207)).then((({SidelineCollection:e})=>({default:e})))));class st{constructor(e){this._params=e,this._feedbackFormContext=m.h.create(g.YP),this.feedbackFormContext=this._feedbackFormContext.view()}showFeedbackForm(e,t){this._feedbackFormContext.set(g.G({rewrite:e,sidelineCard:t,domain:this._params.integrationInfo.domain}))}closeFeedbackForm(){this._feedbackFormContext.set(g.YP)}submitFeedbackForm(e,t){this._params.trackingService.vBarCardRewriteFeedbackSubmitted({vBar:t.sidelineCard.sideline,rewrite:t.rewrite,feedbackFormData:e}),this._params.telemetryService.feedback({feedbackData:{score:e.score,text:e.text,domain:e.domain,vBarType:t.sidelineCard.sideline.kind,rewriteType:t.rewrite.type.kind},message:"Feedback form submitted.",hideUserInfo:!1}),this._feedbackFormContext.set(g.YP)}}var ot=i(78488),lt=i(41092);const dt=({viewport:{rect:e}})=>e.top,ct=({viewport:{rect:e}})=>e.top+e.height,ht=e=>{if(e.length<2)return e;const t=e.sort(((e,t)=>dt(e)-dt(t))),i=[];let r=0,n=1,a=0;for(;r<e.length;){const e=t[r],s=t[n];void 0===s||dt(s)>=ct(e)?(0===a&&i.push(e),r=n,a=0):(ct(s)<=ct(e)||(r=n),a++),n++}return i};var gt=i(70874),ut=i(42702),mt=i(54115),pt=i(79123);function vt(e,t,i){var r,n;const a=pt.d3+pt.y6-((null===(r=t.padding)||void 0===r?void 0:r.left)||0)-((null===(n=t.padding)||void 0===n?void 0:n.right)||0),s=t.size.width+a;if("alignWithTextFieldLeftBoundary"===i.kind)return{top:e.top,height:e.height,left:0,width:s};if("hardcodedLeftOffset"===i.kind){const t=i.leftOffset,r=e.left-t;return{top:e.top,left:r,width:s-r,height:e.height}}(0,ve.L0)(i)}function ft(e){return{highlightId:k.y$.Id.create(`g2-paragraph-highlight-${e.textRange.start}-${e.textRange.end}`),paragraphId:e.id,paragraphSequentialId:e.sequentialId,alertId:"",highlightColor:null,highlightDisplayFormat:null,highlightLiveliness:null}}var wt=i(59833),St=i(30033),_t=i(65258);class bt{constructor(e){this._params=e,this._subs=new a.w,this._logger=(0,S.h)(bt.name),this._paragraphHighlights=m.h.create([]),this._emphasizedParagraphHighlight=m.h.create(g.YP),this.paragraphHighlights=this._paragraphHighlights.view(),this.emphasizedParagraphHighlight=this._emphasizedParagraphHighlight.view(),this._subs.add(this._params.paragraphCollectionService.paragraphs.subscribe((e=>{this._params.paragraphHighlightCollectionGeometry.removeAllHighlights();for(const t of e){const e=ft(t);this._params.paragraphHighlightCollectionGeometry.addHighlight(e.highlightId,t.textRange,e)}}))),this._subs.add(M.aj([this._params.textFieldLayout.rect.changes.pipe(R.O(this._params.textFieldLayout.rect.getCurrent())),this._params.paragraphHighlightCollectionGeometry.geometry.view((e=>Array.from(e.values()))),this._params.paragraphCollectionService.editingParagraphIndex]).pipe(x.U((([e,t,i])=>{const n=t.filter(((e,t)=>i!==t)).reduce(((t,i)=>{return(0,r.zG)((n=i.meta.highlightId.toString(),a=i.meta.paragraphId,s=i.meta.paragraphSequentialId,o=i.rects,l=e,d=this._params.integration.sidelinePositioningStrategy,(0,r.zG)(g.ij((0,mt.jr)(o)),g.UI((e=>{const t=vt(e,l,d);return{id:n,paragraphId:a,sequentialId:s,viewport:{rect:t}}})))),g.g_((()=>(this._params.telemetry.warn({message:"Creating highlight for paragraph failed."}),this._logger.warn("Failed to create paragraph highlight from highlight geometry. Skipping.",i),t)),(e=>{const i=Math.min(e.viewport.rect.left,t.minimumViewportRectLeft);return{paragraphHighlights:t.paragraphHighlights.concat(e),minimumViewportRectLeft:i}})));var n,a,s,o,l,d}),{paragraphHighlights:[],minimumViewportRectLeft:Number.MAX_SAFE_INTEGER});return n.paragraphHighlights.map((e=>({...e,viewport:{...e.viewport,rect:{...e.viewport.rect,left:n.minimumViewportRectLeft,width:e.viewport.rect.width+(e.viewport.rect.left-n.minimumViewportRectLeft)}}})))})),x.U(ht),ot.b((e=>this._logger.debug("Paragraph highlights updated.",e)))).subscribe(h.wW(this._paragraphHighlights))),this._subs.add(L.T(this._params.textFieldLayout.scroll.changes.pipe(y.h(g.YP)),this._params.mouseData.pipe(lt.U(gt.S.hz30),B.skipBy(ut.Z.eq),x.U((({client:e,offset:t})=>{return i=this._paragraphHighlights.get(),n=e,a=t,s=this._params.textFieldElement,null!==n&&null!==a&&(0,_t._N)(n,s)?(0,r.zG)(i,wt.Ew((e=>St.UL.contains(a,e.viewport.rect)))):g.YP;var i,n,a,s})))).subscribe(h.wW(this._emphasizedParagraphHighlight)))}dispose(){this._subs.unsubscribe()}}class yt{constructor(e){this._params=e,this._subs=new a.w,this._logger=(0,S.h)(yt.name),this._selectionHighlight=m.h.create(g.YP),this.selectionHighlight=this._selectionHighlight.view(),this._subs.add(this._params.integration.selectionRange.subscribe((e=>{this._logger.debug("Selection range changed, updating selection highlight geometry accordingly.",e),this._params.selectionHighlightGeometry.removeAllHighlights();const t=this._params.textObserver.getCurrentTextMap().getPlainText();(0,r.zG)(e,g.hX((e=>this._params.integration.textRangeFilter({textRange:e,fullText:t}))),u.bw((e=>{const i=k.y$.Id.create(`g2-selection-highlight-${e.start}-${e.end}`);this._params.selectionHighlightGeometry.addHighlight(i,e,{highlightId:i,text:t.slice(e.start,e.end),textRange:e,alertId:"",highlightColor:null,highlightDisplayFormat:null,highlightLiveliness:null,fullTextLength:t.length})})))}))),this._subs.add(M.aj([this._params.textFieldLayout.rect.changes.pipe(R.O(this._params.textFieldLayout.rect.getCurrent())),this._params.selectionHighlightGeometry.geometry.view((e=>Array.from(e.values())))]).pipe(x.U((([e,t])=>(0,r.zG)(g.ij(t[0]),g.tS((t=>function(e,t,i){return(0,r.zG)(e,g.DT((e=>{const t=e.meta.text.trim().split(/\s+/).filter((e=>""!==e)).length;return t>=2&&t<=1e3})),g.tS((e=>(0,r.zG)((0,mt.jr)(e.rects),g.ij,g.UI((r=>{var n,a;const s=vt(r,t,i),o=null!==(a=null===(n=t.padding)||void 0===n?void 0:n.left)&&void 0!==a?a:0,l="hardcodedLeftOffset"===i.kind?i.leftOffset:0,d=e.rects.map((e=>({...e,left:e.left+pt.d3-o-l})));return{id:e.meta.highlightId.toString(),text:e.meta.text,textRange:e.meta.textRange,viewport:{rect:s},fullTextLength:e.meta.fullTextLength,highlightRects:d}}))))))}(t,e,this._params.integration.sidelinePositioningStrategy))),g.UI((e=>{const t=this._params.paragraphHighlightCollectionViewModel.paragraphHighlights.get()[0];return t?{...e,viewport:{...e.viewport,rect:{...e.viewport.rect,left:t.viewport.rect.left,width:t.viewport.rect.width}}}:e})))))).subscribe(h.wW(this._selectionHighlight))),this._subs.add(this._params.selectionHighlightGeometry.geometry.view((e=>Array.from(e.values()))).subscribe((e=>this._logger.debug("Selection highlight geometry udpated. Resulting highlights:",e)))),this._subs.add(this._selectionHighlight.subscribe((e=>this._logger.debug("Selection highlight udpated.",e))))}dispose(){this._subs.unsubscribe()}}var kt=i(98305),Ct=i(18117),Rt=i(26130),xt=i(36072),Bt=i(85782),Et=i(12171),It=i(10595),Tt=i(20715),Ft=i(40596);function Pt(e,t){const i=(0,Ft.MY)(e.text),r=[t,"vbar",e.textRange.start,e.textRange.end,i];"selection"===t&&r.push(performance.now());return{kind:t,id:r.join("-"),text:e.text,textHash:i,textRange:e.textRange,fullTextLength:e.fullTextLength}}function Mt(e,t,i,r,n){const a=function(e,t,i,r){if(i&&t.getCalliopeAlertsWithinTextRange(e.textRange).length>0)return"signaling";if(r)return"idle";return}(e,i,r,n);if(!a)return g.YP;const s={...Pt(e,a),sequentialId:e.sequentialId,highlightViewport:t};return g.G(s)}var Dt=i(3402);class Lt{constructor(e){this._params=e,this._subs=new a.w,this._logger=(0,S.h)(Lt.name),this._htmlElementBySidelineSequentialId=new Map,this._paragraphSidelines=m.h.create([]),this._paragraphSidelineBySequentialId=new Map,this._pinnedSidelineSequentialId=m.h.create(g.YP),this._pinnedSideline=m.h.combine(this._pinnedSidelineSequentialId,this._paragraphSidelines,(e=>(0,r.zG)(e,g.tS((e=>e===Dt.ZR?this._selectionSideline.get():g.ij(this._paragraphSidelineBySequentialId.get(e))))))),this._activeSidelineSequentialId=m.h.create(g.YP),this._activeSideline=m.h.combine(this._pinnedSideline,this._activeSidelineSequentialId,this._paragraphSidelines,((e,t)=>(0,r.zG)(e,g.wp((()=>(0,r.zG)(t,g.tS((e=>e===Dt.ZR?this._selectionSideline.get():g.ij(this._paragraphSidelineBySequentialId.get(e)))))))))),this._emphasizedSidelineSequentialId=m.h.create(g.YP),this._emphasizedSidelineSequentialIdByParagraphHighlight=m.h.create(g.YP),this._isSubdued=m.h.create(!1),this._emphasizedSideline=m.h.combine(this._pinnedSideline,this._activeSideline,this._emphasizedSidelineSequentialId,this._emphasizedSidelineSequentialIdByParagraphHighlight,this._isSubdued,this._paragraphSidelines,((e,t,i,n,a)=>(0,r.zG)(e,g.wp((()=>(0,r.zG)(t,g.wp((()=>(0,r.zG)(i,g.wp((()=>n)),g.tS((e=>e===Dt.ZR?this._selectionSideline.get():a?g.YP:g.ij(this._paragraphSidelineBySequentialId.get(e))))))))))))),this._selectionSideline=m.h.create(g.YP),this._shouldHideSidelines=m.h.create(!1),this._sidelineCardActiveNotifications=new xt.xQ,this._deactivateSidelineSubs=new a.w,this._notifySidelineShownSubject=new xt.xQ,this.paragraphSidelines=this._paragraphSidelines.view(),this.pinnedSideline=this._pinnedSideline.view(),this.activeSideline=this._activeSideline.view(),this.emphasizedSideline=this._emphasizedSideline.view(),this.selectionSideline=this._selectionSideline.view(),this.shouldHideSidelines=this._shouldHideSidelines.view(),this.isSubdued=this._isSubdued.view(),this.shouldShowOnboarding=this._params.onboardingService.shouldShowOnboarding,this._subs.add(M.aj([this._params.paragraphHighlightCollectionViewModel.paragraphHighlights,this._params.alertCollectionService.calliopeAlerts]).pipe(x.U((([e])=>e.map((e=>this._params.featureFlags.signalingSidelines||this._params.featureFlags.idleSidelines?(0,r.zG)(this._params.paragraphCollectionService.getParagraphById(e.paragraphId),g.g_((()=>(this._params.telemetryService.warn({message:"Creating sideline failed."}),this._logger.warn("Failed to create paragraph sideline; skipping.",{paragraphId:e.paragraphId}),g.YP)),(t=>Mt(t,e.viewport,this._params.alertCollectionService,this._params.featureFlags.signalingSidelines,this._params.featureFlags.idleSidelines))),g.WG):null)).filter(Y.Nf)))).subscribe(h.wW(this._paragraphSidelines))),this._subs.add(this._paragraphSidelines.subscribe((e=>{this._paragraphSidelineBySequentialId.clear();for(const t of e)this._paragraphSidelineBySequentialId.set(t.sequentialId,t)}))),this._subs.add(this._params.paragraphHighlightCollectionViewModel.emphasizedParagraphHighlight.pipe(x.U(g.UI((e=>e.sequentialId)))).subscribe(h.wW(this._emphasizedSidelineSequentialIdByParagraphHighlight))),this._setupSelectionSideline(),this._subs.add(M.aj([this._params.legacyAssistantOpenState,this._params.assistantState]).pipe(x.U((([e,t])=>"open"===e||"opened"===t.kind))).subscribe(h.wW(this._shouldHideSidelines))),this._subs.add(this._shouldHideSidelines.pipe(l.h(Boolean)).subscribe((()=>{this._pinnedSidelineSequentialId.set(g.YP),this._activeSidelineSequentialId.set(g.YP)}))),this._subs.add(this._params.textObserver.contentChanges.immediate.subscribe((({changes:e})=>{e.length>0&&(this._pinnedSidelineSequentialId.set(g.YP),this._activeSidelineSequentialId.set(g.YP))}))),this._subs.add(this._notifySidelineShownSubject.pipe(Bt.v((e=>(0,Dt.iu)(e)?e.sequentialId:e.id)),Et.zg((e=>e.pipe(b.b(300))))).subscribe((e=>{this._logger.debug("Tracking vBarShown().",{vBar:e}),this._params.trackingService.vBarShown({vBar:e})}))),this._subs.add((0,_.R)(self,"scroll",{capture:!0}).pipe((0,ce.p)(300)).subscribe((()=>{this._clearReservedSidelines()}))),this._setupDebugLogs(),this._subs.add(this._params.mouseData.pipe((0,R.O)(null),(0,ot.b)((()=>{this._isSubdued.set(!1),this._params.paragraphCollectionService.resetEditingParagraphIndex()})),(0,o.w)((()=>(0,Rt.H)(be.m9(3)).pipe((0,ot.b)((()=>{this._isSubdued.set(!0)})))))).subscribe())}_setupDebugLogs(){this._subs.add(this._paragraphSidelines.subscribe((e=>this._logger.debug("Paragraph sidelines updated.",e)))),this._subs.add(this._pinnedSideline.subscribe((e=>this._logger.debug("Pinned sideline updated.",g.WG(e))))),this._subs.add(this._activeSideline.subscribe((e=>this._logger.debug("Active sideline updated.",g.WG(e))))),this._subs.add(this._emphasizedSideline.subscribe((e=>this._logger.debug("Emphasized sideline updated.",g.WG(e))))),this._subs.add(this._selectionSideline.subscribe((e=>this._logger.debug("Selection sideline updated.",g.WG(e)))))}_setupSelectionSideline(){this._params.featureFlags.selectionSidelines&&this._subs.add(M.aj([this._params.selectionHighlightViewModel.selectionHighlight,this._activeSideline]).pipe(l.h((([e,t])=>(0,r.zG)(Ct.Yt(g.Kw)({selectionSideline:this._selectionSideline.get(),activeSideline:t}),g.g_(r.W8,(({selectionSideline:e,activeSideline:t})=>e.id!==t.id))))),x.U((([e])=>(0,r.zG)(e,g.UI((e=>function(e){return{...Pt(e,"selection"),sequentialId:Dt.ZR,highlightViewport:e.viewport,highlightRects:e.highlightRects}}(e))))))).subscribe(h.wW(this._selectionSideline)))}_doesSequentialIdMatchRelevantSidelineSequentialId(e,t){return(0,r.zG)(t,g.g_(r.jv,(t=>t===e)))}_getSidelineBySequentialId(e){return e===Dt.ZR?this._selectionSideline.get():g.ij(this._paragraphSidelineBySequentialId.get(e))}_deactivateSideline(e,t=!1){this._logger.debug("Deactivating sideline.",{sidelineSequentialId:e,immediate:t}),this._emphasizedSidelineSequentialId.set(g.YP),this._doesSequentialIdMatchRelevantSidelineSequentialId(e,this._activeSidelineSequentialId.get())?(this._deactivateSidelineSubs.unsubscribe(),this._deactivateSidelineSubs=this._sidelineCardActiveNotifications.pipe(l.h((t=>t===e)),d.q(1),y.h(!1),It.L(t?0:be.E0,Tt.of(!0))).subscribe((t=>{t?(this._logger.debug("Did not receive notification that corresponding sideline card is active, proceeding to deactivate sideline.",{sidelineSequentialId:e}),this._activeSidelineSequentialId.set(g.YP)):this._logger.debug("Received a notification that corresponding sideline card is active, won't deactivate sideline.",{sidelineSequentialId:e})}))):(this._params.telemetryService.warn({message:"Deactivation of an inactive sideline attempted."}),this._logger.warn("Tried to deactivate sideline that is not active, this is a no-op.",{sidelineSequentialId:e}))}_unpinSideline(e){this._logger.debug("Unpinning sideline.",{sidelineSequentialId:e}),this._doesSequentialIdMatchRelevantSidelineSequentialId(e,this._pinnedSidelineSequentialId.get())?(this._pinnedSidelineSequentialId.set(g.YP),this._activeSidelineSequentialId.set(g.YP)):(this._params.telemetryService.warn({message:"Unpinning of an unpinned sideline attempted."}),this._logger.warn("Tried to unpin sideline that is not pinned, this is a no-op.",{sidelineSequentialId:e}))}_pinSideline(e){this._logger.debug("Pinning sideline.",{sidelineSequentialId:e}),this._pinnedSidelineSequentialId.set(g.G(e))}_clearReservedSidelines(){this._logger.debug("Clearing any pinned, active, or emphasized sidelines."),this._pinnedSidelineSequentialId.set(g.YP),this._activeSidelineSequentialId.set(g.YP),this._emphasizedSidelineSequentialId.set(g.YP)}activateSideline(e,t){this._logger.debug("Activating sideline.",{sideline:e,shouldOpenVBarCard:t}),t?(this._activeSidelineSequentialId.set(g.G(e.sequentialId)),this._deactivateSidelineSubs.unsubscribe()):this._emphasizedSidelineSequentialId.set(g.G(e.sequentialId))}deactivateSideline(e){this._deactivateSideline(e.sequentialId)}pinSideline(e){this._pinSideline(e.sequentialId)}unpinSideline(e){this._unpinSideline(e.sequentialId)}getSideline(e){return this._getSidelineBySequentialId(e)}getSidelineCalliopeAlerts(e){return(0,r.zG)(this._getSidelineBySequentialId(e),g.hX(Dt.jz),g.g_((()=>[]),(e=>this._params.alertCollectionService.getCalliopeAlertsWithinTextRange(e.textRange))))}getSidelineHtmlElement(e){return g.ij(this._htmlElementBySidelineSequentialId.get(e))}notifySidelineMounted(e){this._params.telemetryService.infoOncePerMessage({message:"Rendering sideline succeeded."})}notifySidelineShown(e){this._logger.debug("vBar shown (became visible)",{vBar:e}),this._notifySidelineShownSubject.next(e)}notifySidelineHidden(e){this._logger.debug("Sideline hidden (became invisible)",{sideline:e}),this._params.trackingService.vBarHidden({vBar:e})}notifySidelineRefChanged(e,t){this._htmlElementBySidelineSequentialId.set(e.sequentialId,t)}notifySidelineCardActive(e,t){this._sidelineCardActiveNotifications.next(e),t&&this._pinSideline(e)}notifySidelineCardInactive(e,t){g.pC(this._pinnedSideline.get())?this._unpinSideline(e):g.pC(this._activeSideline.get())&&this._deactivateSideline(e,t)}dispose(){this._deactivateSidelineSubs.unsubscribe(),this._subs.unsubscribe()}}class At{constructor(e){this._params=e,this._subs=new a.w,this._logger=(0,S.h)(At.name),this._servicesAndViewModels=m.h.create(g.YP),this._integration="googleDocs"===this._params.integrationInfo.kind?new N({integrationInfo:this._params.integrationInfo,textFieldLayout:this._params.textFieldLayout,textFieldElement:this._params.textFieldElement,textObserver:this._params.textObserver,selectionSource:this._params.selectionSource,selectionService:this._params.selectionService,telemetry:this._params.telemetryService}):new F({integrationInfo:this._params.integrationInfo,textFieldLayout:this._params.textFieldLayout,textFieldElement:this._params.textFieldElement,selectionService:this._params.selectionService,telemetry:this._params.telemetryService,textObserver:this._params.textObserver,geometryProvider:this._params.geometryProvider}),this._replacementService=this._params.replacementServiceInjector.create(w.P.g2),this._trackingService=new tt({checkingService:this._params.checkingService,gnarClient:this._params.gnarClient,integrationInfo:this._integration.info,telemetryService:this._params.telemetryService}),this._inlineAlertsFilter=m.h.create(r.W8),this.integration=this._integration,this.inlineAlertsFilter=this._inlineAlertsFilter.view(),this.suppressGgoInlineEntryPoints=this._params.featureFlags.selectionSidelines,this._logger.debug("Initializing vBars.",{kind:this._integration.info.kind,domain:this._integration.info.domain,integrationName:this._integration.info.integrationName,..."googleDocs"===this._integration.info.kind?{integrationMode:this._integration.info.integrationMode.get()}:void 0}),this._trackingService.vBarsInitialized();const t=this._params.checkingService.pipe(s.oA,o.w((e=>e.readyState)),l.h((e=>e===v.kQ.firstTextCheckCompleted)),d.q(1));this._subs.add(t.pipe(o.w((()=>this._integration.isEnabled.pipe(c.x())))).subscribe((e=>{e?(this._logger.debug("G2 integration enabled, initializing services and VMs."),this._init()):(this._logger.debug("G2 integration disabled, disposing services and VMs."),this._disposeServicesAndViewModels())}))),this._subs.add(this._servicesAndViewModels.pipe(o.w(g.g_((()=>this._params.alertClassification.visibleInlineAlertsFilter),(e=>e.alertCollectionService.inlineAlertsFilter)))).subscribe(h.wW(this._inlineAlertsFilter)))}_init(){const e=new We({checkingService:this._params.checkingService,textChangeBuffer:this._params.textChangeBuffer,telemetryService:this._params.telemetryService,integration:this._integration,dynamicConfig:this._params.dynamicConfig,trackingService:this._trackingService}),t=new re({csPageState:this._params.csPageState,csToBgActions:this._params.csToBgActions,telemetryService:this._params.telemetryService}),i=new se({textObserver:this._params.textObserver,integration:this._integration}),r=new K({alertProcessor:this._params.alertProcessor,alertClassification:this._params.alertClassification,checkingService:this._params.checkingService,featureFlags:this._params.featureFlags}),n=new te({user:this._params.user,csPageState:this._params.csPageState,csToBgActions:this._params.csToBgActions,telemetry:this._params.telemetryService}),a=new f.C(this._params.geometryProvider,this._params.geometryLayout,(()=>this._params.textObserver.getCurrentTextMap()),this._integration.highlightGeometryFilter,this._integration.highlightGeometryInvalidator,!0,void 0,void 0,void 0,void 0,(0,S.h)("ParagraphHighlightCollectionGeometry")),s=new bt({paragraphCollectionService:i,paragraphHighlightCollectionGeometry:a,textFieldLayout:this._params.textFieldLayout,mouseData:this._params.mouseData,textFieldElement:this._params.textFieldElement,integration:this._integration,telemetry:this._params.telemetryService}),o=new f.C(this._params.geometryProvider,this._params.geometryLayout,(()=>this._params.textObserver.getCurrentTextMap()),this._integration.highlightGeometryFilter,this._integration.highlightGeometryInvalidator,!0,void 0,void 0,void 0,void 0,(0,S.h)("SelectionHighlightGeometry")),l=new yt({selectionHighlightGeometry:o,textFieldLayout:this._params.textFieldLayout,textObserver:this._params.textObserver,integration:this._integration,paragraphHighlightCollectionViewModel:s}),d=new Lt({paragraphCollectionService:i,alertCollectionService:r,paragraphHighlightCollectionViewModel:s,textObserver:this._params.textObserver,mouseData:this._params.mouseData,textFieldLayout:this._params.textFieldLayout,selectionHighlightViewModel:l,legacyAssistantOpenState:this._params.legacyAssistantOpenState,assistantState:this._params.assistantState,telemetryService:this._params.telemetryService,featureFlags:this._params.featureFlags,trackingService:this._trackingService,onboardingService:t,availabilityService:this._params.availabilityService,integrationInfo:this._integration.info,user:this._params.user}),c=new st({trackingService:this._trackingService,telemetryService:this._params.telemetryService,integrationInfo:this._integration.info}),h=new kt.t({rewriteService:e,sidelineCollectionViewModel:d,feedbackFormViewModel:c,performReplacement:(e,t)=>this._replacementService.performReplacement(e,t),telemetryService:this._params.telemetryService,integrationInfo:this._integration.info,trackingService:this._trackingService,alertCollectionService:r,monetizationService:n,onboardingService:t,availabilityService:this._params.availabilityService});this._servicesAndViewModels.set(g.G({rewriteService:e,paragraphCollectionService:i,alertCollectionService:r,monetizationService:n,onboardingService:t,paragraphHighlightCollectionGeometry:a,paragraphHighlightCollectionViewModel:s,selectionHighlightGeometry:o,selectionHighlightViewModel:l,sidelineCollectionViewModel:d,feedbackFormViewModel:c,sidelineCardViewModel:h}))}_disposeServicesAndViewModels(){this._trackingService.dispose(),(0,r.zG)(this._servicesAndViewModels.get(),u.bw((e=>{e.rewriteService.dispose(),e.paragraphCollectionService.dispose(),e.alertCollectionService.dispose(),e.paragraphHighlightCollectionGeometry.dispose(),e.paragraphHighlightCollectionViewModel.dispose(),e.selectionHighlightGeometry.dispose(),e.selectionHighlightViewModel.dispose(),e.sidelineCollectionViewModel.dispose(),e.sidelineCardViewModel.dispose()}))),this._servicesAndViewModels.set(g.YP)}get vBarsUI(){const e="googleDocs"===this._params.integrationInfo.kind;return this._servicesAndViewModels.view(g.UI((({sidelineCollectionViewModel:t,monetizationService:i})=>n.createElement(n.Suspense,{fallback:n.createElement(n.Fragment,null)},n.createElement(at,{paragraphSidelines:t.paragraphSidelines,pinnedSideline:t.pinnedSideline,activeSideline:t.activeSideline,emphasizedSideline:t.emphasizedSideline,shouldHideSidelines:t.shouldHideSidelines,selectionSideline:t.selectionSideline,shouldShowOnboarding:t.shouldShowOnboarding,shouldShowSelectionHighlight:!e,vBarsQuotaInfo:i.vBarsQuotaInfo,shouldSubdueVBars:t.isSubdued,onPinSideline:e=>t.pinSideline(e),onActivateSideline:(e,i)=>t.activateSideline(e,i),onDeactivateSideline:e=>t.deactivateSideline(e),onMountSideline:e=>t.notifySidelineMounted(e),onShowSideline:e=>t.notifySidelineShown(e),onHideSideline:e=>t.notifySidelineHidden(e),onSidelineRefChange:(e,i)=>t.notifySidelineRefChanged(e,i)})))))}get vBarCardUI(){return this._servicesAndViewModels.view(g.UI((({sidelineCardViewModel:e,monetizationService:t,onboardingService:i})=>n.createElement(n.Fragment,null,n.createElement(n.Suspense,{fallback:n.createElement(n.Fragment,null)},n.createElement(it.I,{isGateEnabledFn:(0,p.OB)().experimentClient.isGateEnabled},n.createElement(nt,{sidelineCard:e.sidelineCard,shouldShowOnboarding:i.shouldShowOnboarding,vBarsQuotaInfo:t.vBarsQuotaInfo,getSidelineCardState:t=>e.getSidelineCardState(t),onActivateSidelineCard:(t,i)=>e.activateSidelineCard(t,i),onDeactivateSidelineCard:(t,i)=>e.deactivateSidelineCard(t,i),onChangeSelectedRewriteType:(t,i)=>e.notifySelectedRewriteTypeChanged(t,i),onMountRewriteLoading:(t,i)=>e.notifyRewriteLoadingShown(t,i),onMountRewriteEmpty:(t,i)=>e.notifyRewriteEmptyShown(t,i),onMountRewriteReady:(t,i,r)=>e.notifyRewriteReadyShown(t,i,r),onMountRewriteError:(t,i)=>e.notifyRewriteErrorShown(t,i),onApplyRewrite:(t,i)=>e.applyRewrite(t,i),onCopyRewrite:(t,i)=>e.copyRewrite(t,i),onRevertRewrite:(t,i)=>e.notifyRewriteReverted(t,i),onDismissRewrite:(t,i)=>e.dismissRewrite(t,i),onRegenerateRewrite:(t,i)=>e.regenerateRewrite(t,i),onChangeCustomPrompt:(t,i)=>e.notifyCustomPromptChanged(t,i),onSubmitCustomPrompt:(t,i)=>e.submitCustomPrompt(t,i),onClickMoreTab:t=>e.notifyMoreTabClicked(t),onShow:(t,i)=>e.notifySidelineCardShown(t,i),onClose:t=>e.notifySidelineCardClosed(t),onClickFeedbackButton:(t,i)=>e.notifyFeedbackButtonClicked(t,i),onShowUphookButton:(t,i)=>e.notifyUphookButtonShown(t,i),onClickUphookButton:(t,i)=>e.notifyUphookButtonClicked(t,i),onOnboardingDismiss:()=>e.dismissOnboarding(),onStreamingStart:(t,i)=>e.notifyRewriteStreamingStart(t,i),onDeactivateSidelineType:(t,i,r)=>e.deactivateSidelineType(t,i,r),integrationInfo:this._integration.info}))),n.createElement("div",{id:V.wE,style:{position:"fixed",pointerEvents:"none"}})))))}get vBarsFeedbackFormUI(){return this._servicesAndViewModels.view(g.UI((({feedbackFormViewModel:e})=>n.createElement(n.Suspense,{fallback:n.createElement(n.Fragment,null)},n.createElement(rt,{feedbackFormContext:e.feedbackFormContext,onSubmit:(t,i)=>e.submitFeedbackForm(t,i),onClose:()=>e.closeFeedbackForm()})))))}dispose(){this._disposeServicesAndViewModels(),this._integration.dispose(),this._subs.unsubscribe()}}},76729:(e,t,i)=>{i.d(t,{y:()=>n});var r=i(91901);function n(e){var t,i;const n=e.querySelector(r.yw);if(n)return n;for(const r of null!==(i=null===(t=e.parentElement)||void 0===t?void 0:t.children)&&void 0!==i?i:[])if(r.classList.contains("kix-scrollareadocumentplugin"))return r;return null}},6557:(e,t,i)=>{i.d(t,{Ao:()=>o,CW:()=>s,Hq:()=>d,Vt:()=>l,YH:()=>r,ZD:()=>a,Zw:()=>n,wE:()=>c});const r={zIndex:i(50899).op,position:"absolute",top:0,left:0,width:"100%",pointerEvents:"all"},n="vBarsFeedbackForm",a="grammarly-extension-vBars-feedback-form",s="vBars",o="grammarly-extension-vBars",l="vBarCard",d="grammarly-extension-vBar-cad",c="vBarCardPositionReference"},82829:(e,t,i)=>{i.r(t),i.d(t,{injectUI:()=>T});var r=i(49231),n=i(65647),a=i(58303),s=i(43818),o=i(4603),l=i(33874),d=i(4798),c=i(6557),h=i(68259);function g(e){const t=e.ownerDocument.documentElement,i=t.querySelector("#kix-appview");return i||t}var u=i(76729);function m(e){switch(e.integrationInfo.kind){case"googleDocs":return a.G(function(e){const t=(0,u.y)(e);return{positionResetStyle:{zIndex:100},spaceNeededFromTheLeft:12,injectionPlace:g(e),getFieldSize:(i,r,n)=>{if(!t||n!==e)return i;const a=null==t?void 0:t.getBoundingClientRect(),s=r.width-a.width;return{width:i.width-s,height:i.height}},getFieldOffset:(i,r,n)=>{if(!t||n!==e)return i;const{left:a}=t.getBoundingClientRect(),s=a-r.left;return{top:i.top,left:i.left+s}}}}(e.textFieldElement));case"gmail":return a.G({positionResetStyle:{visibility:"visible",zIndex:1e3}});case"googleChat":return a.G({positionResetStyle:{zIndex:10}});case"twitter":return a.G({positionResetStyle:{zIndex:1}});case"googleDocsComments":case"contentEditable":case"textarea":case"iframe":return a.YP;default:(0,h.vE)(e.integrationInfo)}}var p=i(206),v=i(79123),f=i(72779),w=i(37734),S=i(65258);var _=i(52467);const b=()=>{const e=new Map;return(t,i)=>function(e,t,i){const r=e.get(t)||[],[n,a,s,o]=r;return!!((0,_.hj)(n)&&(0,_.hj)(a)&&i!==n&&i===a&&n===s&&a===o&&Math.abs(a-n)<=25)||(e.set(t,[i,n,a,s]),!1)}(e,t,i)},y=e=>{var t,i,r,n,s,l;const c=(0,f.o)(e.textFieldElement),h=null!==(t=(0,S.a2)(c.paddingLeft))&&void 0!==t?t:0,g=null!==(i=(0,S.a2)(c.paddingRight))&&void 0!==i?i:0,u=null!==(n=null===(r=a.WG(e.uiInjectionOptions))||void 0===r?void 0:r.injectionPlace)&&void 0!==n?n:function(e,t,i){const r=e.getBoundingClientRect(),n=r.left+t-v.d3,a=r.right-i+v.y6;return(0,f.E6)(e,(e=>{if(!(0,f.XQ)(e))return!1;const t=e.getBoundingClientRect(),i=e.clientWidth+t.left;return t.left<=n&&i>=a}))}(e.textFieldElement,h,g),m=null!==(l=null===(s=a.WG(e.uiInjectionOptions))||void 0===s?void 0:s.spaceNeededFromTheLeft)&&void 0!==l?l:v.d3-h,p=v.y6-g;let _=!(0,o.OB)().experimentClient.isGateEnabled(d.K.G2VBarsDoNotExtendWidth);const y=m+p,k=b(),C=u.clientWidth>=self.innerWidth?void 0:(t,i)=>{var r,n,s;const o={height:i.height,width:i.width+(_?y:0)};return _&&k(t,o.width)&&(_=!1,o.width=i.width,e.telemetryService.error({message:"Potential scroll bar issue detected.",data:{url:self.location.href,domain:self.location.hostname},hideUserInfo:!0})),null!==(s=null===(n=null===(r=a.WG(e.uiInjectionOptions))||void 0===r?void 0:r.getFieldSize)||void 0===n?void 0:n.call(r,o,i,t))&&void 0!==s?s:o},R=(0,w.fL)(e.textFieldElement,e.integrationInfo.isInsideIFrame,c,u,{getFieldOffset:(t,i,r)=>{var n,s,o;return null!==(o=null===(s=null===(n=a.WG(e.uiInjectionOptions))||void 0===n?void 0:n.getFieldOffset)||void 0===s?void 0:s.call(n,i,r,t))&&void 0!==o?o:i},getPaddingRectSize:C,getScrollableFieldSize:C});return{layout:R,injectionPlace:u,spaceNeededFromTheLeft:m}};var k=i(34967),C=i(5669),R=i(53829),x=i(74514),B=i(77365),E=i(47204);const I=({children:e})=>r.createElement(B.o,{style:(0,o.OB)().experimentClient.isGateEnabled(d.K.VBarsInjectionContainerDisplayContents)?{display:"contents"}:void 0},r.createElement(R.w,null,r.createElement(E.p,null,r.createElement(x.L,{chunkName:"g2"},e)))),T=e=>{const{integrationInfo:t,textFieldElement:i,vBarsUI:h,vBarCardUI:g,vBarsFeedbackFormUI:u,eventPropagationHandler:v,telemetryService:f}=e,w=m({integrationInfo:t,textFieldElement:i}),{injectionPlace:S,render:_}=(e=>{var t;const{injectionPlace:i,layout:o,spaceNeededFromTheLeft:l}=y({integrationInfo:e.integrationInfo,textFieldElement:e.textFieldElement,uiInjectionOptions:e.uiInjectionOptions,telemetryService:e.telemetryService}),d={position:"absolute",top:0,left:-l,pointerEvents:"none",...null===(t=a.WG(e.uiInjectionOptions))||void 0===t?void 0:t.positionResetStyle};return{injectionPlace:i,render:()=>r.createElement(s.F.Fragment,null,e.vBarsUI.pipe(n.U(a.g_((()=>null),(e=>r.createElement("div",{style:d},r.createElement(p.V,{layout:o},r.createElement(s.F.div,{style:o.textField.scrollSize.behavior.pipe((0,n.U)((e=>({width:0,height:e.height,pointerEvents:"all"}))))},e))))))))}})({integrationInfo:t,textFieldElement:i,vBarsUI:h,uiInjectionOptions:w,telemetryService:f}),b=((e,t,i)=>C.V.get({monitorAs:c.CW}).inject(l.EM.fromDocument(document,c.Ao),e,(e=>k.G7.showWhenLoaded(r.createElement(I,null,t()))(e)),{eventPropagationHandler:i}))((e=>{(0,o.OB)().experimentClient.isGateEnabled(d.K.VBarsInjectionContainerDisplayContents)&&(e.style.display="contents"),S.appendChild(e)}),_,v),R=((e,t,i)=>C.V.get({monitorAs:c.Vt}).inject(l.EM.fromDocument(document,c.Hq),e,(e=>k.G7.showWhenLoaded(r.createElement(I,null,t()))(e)),{eventPropagationHandler:i}))(l.zs.appendChild(i.ownerDocument.documentElement),(()=>r.createElement(s.F.Fragment,null,g.pipe(n.U(a.g_((()=>null),(e=>r.createElement("div",{style:c.YH},e))))))),v),x=((e,t,i)=>C.V.get({monitorAs:c.Zw}).inject(l.EM.fromDocument(document,c.ZD),l.zs.appendChild(e),k.G7.showWhenLoaded(r.createElement(I,null,r.createElement(s.F.Fragment,null,t.pipe(n.U(a.g_((()=>null),(e=>r.createElement("div",{style:c.YH},e)))))))),{eventPropagationHandler:i}))(i.ownerDocument.documentElement,u,v);return{dispose(){b.dispose(),R.dispose(),x.dispose()}}}},2422:(e,t,i)=>{function r(e,t){return 0===e.quota&&!e.usedVBarsTextHashList.includes(t)}i.d(t,{Q:()=>r})},77181:(e,t,i)=>{var r,n,a;i.d(t,{J8:()=>l,L5:()=>o,es:()=>s}),function(e){e.is=function(e){return"improve"===e.kind}}(r||(r={})),function(e){e.is=function(e){return"rephrase"===e.kind}}(n||(n={})),function(e){e.is=function(e){return"customPrompt"===e.kind}}(a||(a={}));const s=r.is,o=n.is,l=a.is},67834:(e,t,i)=>{i.d(t,{I:()=>a,M:()=>s});var r=i(49231);const n=r.createContext({isGateEnabled:()=>!1});function a({isGateEnabledFn:e,children:t}){return r.createElement(n.Provider,{value:{isGateEnabled:e}},t)}function s(e){const{isGateEnabled:t}=r.useContext(n);return t(e)}},79123:(e,t,i)=>{i.d(t,{BP:()=>n,d3:()=>a,y6:()=>r});const r=4,n=15,a=r+n+5},49533:(e,t,i)=>{i.r(t),i.d(t,{FeedbackForm:()=>c});var r=i(90023),n=i(49231),a=i(58303),s=i(43818),o=i(54104),l=i(80882);const d=({domain:e,onSubmit:t,onClose:i})=>{const[r,a]=n.useState(!0);return n.createElement(o.u_,{"data-testid":"grammarly-g2-feedback-form-modal",width:"small",title:"How do you like Grammarly?",isOpen:r,onClose:()=>{a(!1),i()}},n.createElement(o.u_.Body,null,n.createElement(l.b,{withScore:!0,hideTitle:!0,hideTextBoxTitle:!0,hideLogo:!0,hideDomainHelpText:!0,domainSharedByDefault:!0,domain:e,showPostSubmitScreen:!1,submitButtonKind:"primary",onSubmit:e=>{a(!1),t(e)}})))},c=({feedbackFormContext:e,onSubmit:t,onClose:i})=>n.createElement(s.F.Fragment,null,e.view((0,r.ls)(a.UI((e=>n.createElement(d,{domain:e.domain,onSubmit:i=>t(i,e),onClose:()=>i()}))),a.WG)))},70:(e,t,i)=>{i.r(t),i.d(t,{SidelineCardWrapper:()=>ot});var r=i(90023),n=i(49231),a=i(65882),s=i(65647),o=i(14765),l=i(96030),d=i(58303),c=i(43818),h=i(25770);const g=({as:e="div",className:t,show:i,transitionDurationMs:r=250,display:a="inline-block",children:s})=>{const[o,l]=n.useState(!1),[d,c]=n.useState(!1);n.useEffect((()=>{let e;l(!0),i||(e=self.setTimeout((()=>l(!1)),r)),c(!i);const t=self.setTimeout((()=>c(i)),0);return()=>[e,t].forEach(clearTimeout)}),[i]);const h={display:a,opacity:d?1:0,transition:`opacity ${r}ms`},g=e;return o&&s?n.createElement(g,{className:t,style:h,"data-testid":"grammarly-g2-fade-wrapper"},s):null};var u=i(2422),m=i(16587),p=i(68567),v=i(27914),f=i(33969),w=i(6356),S=i(22610);const _=({children:e,quota:t,showUphook:i})=>void 0===t?e:n.createElement("div",{className:S.monetizationWrapper},n.createElement(m.k,{gap:1,align:"center",justify:"start",className:S.monetizationTitle},n.createElement(p.J,{icon:v.O,variant:"premium",accessibilityLabel:"",className:S.premiumIcon}),n.createElement(f.x,{as:"strong",variant:"text-xsmall",className:S.monetizationProText,"aria-label":"Pro suggestion","data-testid":"grammarly-g2-sideline-card-monetization-wrapper-pro-text"},"Pro"),n.createElement(p.J,{icon:w.M,accessibilityLabel:"",size:"small",variant:"inherit",className:S.monetizationDividerDot}),n.createElement(m.k,{align:"center",gap:1,"data-testid":"grammarly-g2-sideline-card-monetization-wrapper-title"},!i&&n.createElement(f.x,{as:"strong",variant:"text-xsmall"},t),n.createElement(f.x,{as:"p",variant:"text-xsmall"},i?"You’re out of free paragraph rewrites for today":"free paragraph rewrites left today"))),e);var b=i(80936),y=i(50166),k=i(8775);const C=()=>n.createElement("svg",{width:"215",height:"210",viewBox:"0 0 215 210",fill:"none",xmlns:"http://www.w3.org/2000/svg"},n.createElement("path",{id:"Vector",d:"M215 105C215 47.0093 166.872 7.9646e-06 107.5 1.05598e-05C48.1284 1.3155e-05 -7.12455e-06 47.0093 -4.5897e-06 105C-2.05484e-06 162.991 48.1284 210 107.5 210L215 210L215 105Z",fill:"#D5FF00"}));var R=i(47252);const x=({onDismiss:e=(()=>{}),onComplete:t=(()=>{})})=>n.createElement(m.k,{className:R.onboardingBanner,padding:1,justify:"space-between","data-testid":"grammarly-g2-sideline-onboarding"},n.createElement(m.k,{direction:"column",padding:6,align:"start"},n.createElement(b.c,{style:{height:22,width:"auto"},"aria-label":"Grammarly logo","aria-hidden":!1}),n.createElement(m.k,{align:"start",width:27,style:{marginTop:"34px",backgroundColor:y.NeutralGray100},borderRadius:1,padding:1,paddingTop:0,paddingBottom:0},n.createElement(f.x,{as:"span",weight:"bold",style:{fontSize:"12px",color:y.White,lineHeight:"18px"}},"New")),n.createElement(f.x,{as:"p",variant:"heading-large",style:{fontSize:"24px"},marginTop:2},"Perfect your paragraphs with a click"),n.createElement(m.k,{gap:4,marginTop:6},n.createElement(k.z,{text:"Show me",onClick:t}),n.createElement(k.z,{variant:"tertiary",text:"Later",onClick:e}))),n.createElement(m.k,{align:"end",flex:"0 0 auto",borderRadius:3,style:{overflow:"hidden"}},n.createElement(C,null)));var B=i(7399),E=i(68259),I=i(84837),T=i(98305),F=i(57116),P=i(99627),M=i(7750);const D=({className:e,...t})=>n.createElement(k.z,{...(0,P.Sh)(M.sidelineCardButton,e),variant:"tertiary",size:"small",...t});var L=i(96710),A=i(326),G=i(3190),O=i(41820);function H({errorDetails:e,errorReason:t}){switch(t){case"sensitivity":return["Can't help with this text","Grammarly assistance is unavailable because the text may contain sensitive content. Try with different text."];case"unsupportedLanguage":return["Can't help with this text","Grammarly only works with English language text."];case"serviceLimitExceeded":return["See more suggestions tomorrow","You've reached your suggestion limit for the day. It resets tomorrow."];case"backendError":return["Something went wrong","Please wait a moment, then try again."]}return e?["Assistance unavailable",e]:["Couldn't generate ideas","Please wait a moment, then try again."]}const U=({errorDetails:e,errorReason:t,onMount:i})=>(B.P.useEffectOnDidMount((()=>i())),n.createElement(m.k,{direction:"column",align:"center",gap:.5,padding:8,"data-testid":"grammarly-g2-sideline-card-rewrite-error"},n.createElement(p.J,{icon:O.F,size:"large",variant:"warning",accessibilityLabel:"","data-testid":"grammarly-g2-sideline-card-rewrite-error-icon"}),n.createElement(f.x,{as:"p",variant:"text-medium",color:"base-default",align:"center","data-testid":"grammarly-g2-sideline-card-rewrite-error-title"},(0,G.li)(H({errorDetails:e,errorReason:t}))),n.createElement(f.x,{as:"p",variant:"text-small",color:"base-subdued",align:"center","data-testid":"grammarly-g2-sideline-card-rewrite-error-subtitle"},(0,G.Yg)(H({errorDetails:e,errorReason:t})))));var z=i(84737),q=i(20715),N=i(47019),V=i(33785),W=i(99460),j=i(69057);function $(e){const t=n.useRef({value:e,prev:null}),i=t.current.value;return e!==i&&(t.current={value:e,prev:i}),t.current.prev}function Y(e){const[t,i]=n.useState(!1),[r,a]=n.useState(!1),s=()=>{requestAnimationFrame((()=>{const t=e.current;t&&(i(t.scrollTop>0),a(Math.ceil(t.scrollTop+t.clientHeight)<t.scrollHeight))}))};return n.useEffect((()=>{if(!e.current)return;const t=new ResizeObserver((t=>{requestAnimationFrame((()=>{for(const i of t)if(i.target===e.current&&i.contentRect){const t=e.current;a(Math.ceil(t.scrollTop+t.clientHeight)<t.scrollHeight)}}))}));return t.observe(e.current),()=>t.disconnect()})),n.useEffect((()=>{const t=e.current;if(t)return t.addEventListener("scroll",s),()=>{t.removeEventListener("scroll",s)}}),[e]),{showTopScrollLimit:t,showBottomScrollLimit:r}}const Q=({maxHeight:e,streamedText:t,onMount:i,onStreamingStart:r})=>{const a=n.useRef(null),o=$(t);n.useEffect((()=>{!o&&t&&r()}),[o,t]),B.P.useEffectOnDidMount((()=>i()));const{showBottomScrollLimit:l,showTopScrollLimit:d}=Y(a);return n.useEffect((()=>{a.current&&(a.current.scrollTop=a.current.scrollHeight)}),[t]),n.createElement(m.k,{"data-testid":"grammarly-g2-sideline-card-rewrite-loading-skeleton",style:{maxHeight:e}},n.createElement(N.g,{accessibilityLabel:"Loading rewrite",label:"Loading rewrite",width:"100%"},n.createElement(m.k,{gap:4,height:"100%"},n.createElement(N.g.Rectangle,{width:3,height:"100%"}),n.createElement(m.k,{direction:"column",width:"100%",height:"100%",gap:3},n.createElement("div",{"data-testid":"grammarly-g2-sideline-card-rewrite-loading-skeleton-content",ref:a,...(0,P.Sh)(l&&j.scrollBottomLimit,d&&j.scrollTopLimit),style:{overflow:"auto"}},n.createElement(m.k,{style:{flex:"0 0 auto",marginBottom:"5px"}},n.createElement(N.g.Heading,{variant:"heading-small",width:"50%"})),t?n.createElement(W.z,{animationDurationMs:500},q.of(t).pipe(s.U((()=>n.createElement(K,{text:t}))))):n.createElement(m.k,{direction:"column",width:"100%",align:"start"},n.createElement(N.g.Text,{variant:"text-small",width:"100%"}),n.createElement(N.g.Text,{variant:"text-small",width:"100%"}),n.createElement(N.g.Text,{variant:"text-small",width:"100%"}))),n.createElement(m.k,{justify:"space-between",style:{flex:"0 0 auto"}},n.createElement(m.k,null,n.createElement(N.g.Button,{size:"small",width:60})),t?n.createElement(V.a,{accessibilityLabel:"Loading rewrite content"},n.createElement(V.a.Branded,{size:"small"})):null)))))},K=({text:e=""})=>{const[t,i]=n.useState((()=>[e])),r=$(e)||"";return n.useEffect((()=>{if(0===r.length)return;const t=e.slice(r.length);i((e=>[...e,t]))}),[e,r]),n.createElement("div",null,t.map(((e,t)=>n.createElement("span",{key:`${e}-${t}`,className:j.fadeInAnimation},n.createElement(f.x,{as:"span",variant:"text-small"},e)))))};var Z=i(29987),J=i(16309),X=i(89356),ee=i(48377),te=i(4603),ie=i(4798),re=i(68970),ne=i(85215),ae=i(55804);const se=({className:e})=>n.createElement(p.J,{...(0,P.Sh)(ae.sidelineCardGrammarlyLogo,e),size:"small",icon:ne.p,accessibilityLabel:"Grammarly logo","data-testid":"grammarly-g2-sideline-card-grammarly-logo"});var oe=i(81590),le=i(84654),de=i(67834),ce=i(72779),he=i(23071),ge=i.n(he);const ue=({children:e,diffs:t,onHidePopover:i,onMount:r,onRevert:a,onShowPopover:s})=>{const o=n.useRef(null),l=n.useRef(null);if(n.useEffect((()=>{r&&o.current&&l.current&&r({diffs:t,referenceElement:o.current,diffSpanElement:l.current})}),[]),!a)return n.createElement("span",null,e);const d=()=>{o.current&&l.current&&s({diffs:t,referenceElement:o.current,diffSpanElement:l.current})};return n.createElement("span",{ref:o,"data-testid":"grammarly-g2-revertible-rewrite-diff",role:"button",className:he.revertibleRewriteDiffButton,tabIndex:0,onBlur:i,onClick:()=>a(t),onFocus:d,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),e.stopPropagation(),a(t))},onMouseOver:d},n.createElement("span",{ref:l},e))};var me=i(47639);const pe=e=>{const{x:t,y:i,width:r,height:n}=e;return[{x:t,y:i},{x:t+r,y:i},{x:t+r,y:i+n},{x:t,y:i+n}]},ve=({largeArcFlag:e=0,radius:t=2,isClockwise:i=!0,end:r})=>`a ${t},${t} 0 ${e} ${i?1:0} ${r.dx},${r.dy} `,fe=(e=!0)=>ve({end:{dx:2,dy:2},isClockwise:e}),we=(e=!0)=>ve({end:{dx:-2,dy:2},isClockwise:e}),Se=(e=!0)=>ve({end:{dx:-2,dy:-2},isClockwise:e}),_e=(e=!0)=>ve({end:{dx:2,dy:-2},isClockwise:e}),be=({className:e,rects:t,referenceRect:i,...r})=>{const a=(e=>{const t=[];let i={x:0,y:0},r="";const[n,a,s]=pe(e[0]),o=n;r+=`M ${n.x+2} ${n.y} `,r+=`H ${a.x-2} `,r+=fe(),i=s,e.forEach((e=>{const[n,a,s,o]=pe(e),l=a.x>i.x;a.x!==i.x&&(r+=l?fe(!1):we(),r+=`H ${a.x+(l?-2:2)} `,r+=l?fe():we(!1)),r+=`V ${s.y-2} `,t.push(n,o),i=s}));const l=t[t.length-1];for(r+=we(),r+=`H ${l.x+2} `,r+=Se(),i=l;t.length>0;){const e=t.pop(),n=t.pop(),a=e.x>i.x;e.x!==i.x&&(r+=a?_e():Se(!1),r+=`H ${e.x+(a?-2:2)} `,r+=a?_e(!1):Se()),r+=`V ${n.y+2} `,i=n}return r+=`V ${o.y} Z`,r})(t.map((e=>({x:e.x-i.x-2,y:e.y-i.y-2,width:e.width+4,height:e.height+4})))),s={width:i.width,height:i.height};return n.createElement("svg",{...(0,P.Sh)(me.svg,e),style:s,"data-testid":"grammarly-g2-revertible-rewrite-outline",...r},n.createElement("path",{className:me.path,d:a,stroke:y.NeutralGray100,strokeWidth:"2px"}))};var ye=i(96846);const ke=e=>{const{children:t,renderer:i}=e,r=t.split("\n");return n.createElement(n.Fragment,null,r.map(((e,t)=>t>0?0===e.length?n.createElement("br",{key:`${t}_br`}):[n.createElement("br",{key:`${t}_br`}),n.createElement(n.Fragment,{key:t},i(e))]:0===e.length?[]:n.createElement(n.Fragment,{key:t},i(e)))).flat())},Ce={color:le.I.Text.Brand.Default,background:"rgba(177, 240, 232, 0.6)",fontWeight:"bold"},Re={color:"#696969",backgroundColor:"rgba(156, 156, 156, 0.2)",textDecoration:"line-through"},xe={color:le.I.Text.Base.Default},Be=({diff:e,displayDeletes:t,blur:i,isOnboardingEnabled:a=!1,onRevert:s=r.Q1})=>{const[o,l]=n.useState(!1),[d,c]=n.useState(a),[h,u]=n.useState(null),[m,p]=n.useState(null),[v,w]=n.useState(null),[S,_]=n.useState([]),[b,y]=n.useState(null),{styles:k,attributes:C}=(0,oe.D)(v,b,{placement:"top-start",modifiers:[{name:"offset",options:{offset:[-3,2]}}]}),R=n.useRef(null);n.useEffect((()=>(d&&(R.current=self.setTimeout((()=>{c(!1),l(!1)}),2500)),()=>{R.current&&self.clearTimeout(R.current)})),[d]),n.useEffect((()=>{m&&w({getBoundingClientRect:()=>m.getClientRects()[0],contextElement:m.ownerDocument.body})}),[m]);const x=(0,de.M)(ie.K.G2VBarsRevertRewrite),B=({diffs:e,referenceElement:t,diffSpanElement:i})=>{l(!0),u((0,ce.bp)(t)),p(i),_(e)},E=()=>{c(!1),R.current&&self.clearTimeout(R.current)},I=({diffs:e,referenceElement:t,diffSpanElement:i})=>{c(!0),B({diffs:e,referenceElement:t,diffSpanElement:i})},T=()=>l(!1),F=()=>{l(!0),E()},M=({diffs:e,referenceElement:t,diffSpanElement:i})=>{E(),B({diffs:e,referenceElement:t,diffSpanElement:i})},D=()=>{s(S),l(!1),p(null),_([])},L=(0,ee.jy)(e);let A=!1;return n.createElement("p",{...(0,P.Sh)(ye.sidelineCardRewriteDiff,i&&ye.sidelineCardRewriteDiffBlurred),"data-testid":"grammarly-g2-sideline-card-rewrite-diff"},L.map((({groupID:e,diffs:i,showDeletions:r})=>{const a=i.some((([e])=>e===ee.FS.Operation.DELETE||e===ee.FS.Operation.INSERT)),s=x&&a&&t,o=s&&!A&&d;return A=A||s,n.createElement(ue,{key:e,diffs:i,onHidePopover:T,onMount:o?I:void 0,onRevert:s?D:void 0,onShowPopover:M},i.map(((e,a)=>{const[s,o]=e;switch(s){case ee.FS.Operation.DELETE:return t&&r?n.createElement(f.x,{as:"span",variant:"text-small",key:a,style:Re},o):null;case ee.FS.Operation.INSERT:{const e=i.length,t=" "===o&&e>1?xe:Ce;return n.createElement(ke,{key:a,renderer:e=>n.createElement(f.x,{as:"span",variant:"text-small",style:t},e)},o)}case ee.FS.Operation.RETAIN:return n.createElement(ke,{key:a,renderer:e=>n.createElement(f.x,{as:"span",variant:"text-small",style:xe},e)},o)}})))})),h&&m&&n.createElement(g,{className:ye.sidelineCardRewriteDiffPopoverWrapper,as:"span",show:o,transitionDurationMs:400,display:"block"},n.createElement("button",{className:ye.sidelineCardRewriteDiffRevertButton,type:"button",onMouseOver:F,onMouseLeave:T,onFocus:F,onBlur:T,onClick:D},n.createElement(f.x,{as:"span","data-testid":"grammarly-g2-revertible-rewrite-diff-undo",ref:y,className:ge().revertibleRewriteDiffLabel,style:k.popper,...C.popper},"Undo change"),n.createElement(be,{...(0,P.Sh)(d&&ge().revertibleRewriteDiffOutlineOnboarding),rects:Array.from(m.getClientRects()),referenceRect:h.getBoundingClientRect()}))))};var Ee=i(5562),Ie=i(3705),Te=i(88105),Fe=i(33041),Pe=i(64598);const Me=({domain:e,onCopy:t,onDismiss:i,onShowLess:r})=>n.createElement("div",{className:Pe.moreButton,"data-testid":"grammarly-g2-sideline-card-menu"},n.createElement(Ee.v,{activator:"more-horizontal"},n.createElement(Ee.v.Item,{key:"copy",icon:Ie.c,onClick:async()=>{await(null==t?void 0:t())}},"Copy"),i&&n.createElement(Ee.v.Item,{key:"dismiss",icon:Te.o,onClick:()=>{null==i||i()}},"Dismiss"),r&&n.createElement(n.Fragment,null,n.createElement(Ee.v.Separator,{role:"separator"}),n.createElement(Ee.v.Item,{key:"showLess",icon:Fe.l,onClick:()=>{null==r||r()},"data-testid":"grammarly-g2-sideline-card-menu-show-less"},"Show less on ",e))));var De=i(91100);function Le(e,t){return"signaling"===e&&"improve"===t.kind?De.sidelineCardRewriteReadyContentTitleAttention:De.sidelineCardRewriteReadyContentTitleDefault}const Ae=e=>{const t=n.useRef(null),[i,a]=n.useState(e.diffProps);B.P.useEffectOnDidMount(e.onMount);const{showBottomScrollLimit:s,showTopScrollLimit:o}=Y(t),l=t=>{const n=[];e.onRevert(),(0,r.zG)(i,d.UI((({diff:e,displayDeletes:i})=>{e.forEach((e=>{const[i,r]=e;t.find((([e,t])=>e===i&&t===r))?i===ee.FS.Operation.DELETE?n.push([ee.FS.Operation.RETAIN,r]):i===ee.FS.Operation.RETAIN&&n.push([i,r]):n.push([i,r])})),a(0===n.length?d.YP:d.G({diff:n,displayDeletes:i}))})))};return n.createElement(m.k,{gap:4,align:"stretch",style:{maxHeight:e.maxHeight},"data-testid":"grammarly-g2-sideline-card-rewrite-ready"},n.createElement("div",{...(0,P.Sh)(De.sidelineCardRewriteReadySignalBar,(c=e.sidelineType,h=e.rewriteType,"signaling"===c&&"improve"===h.kind?De.sidelineCardRewriteReadySignalBarAttention:De.sidelineCardRewriteReadySignalBarDefault)),"data-testid":"grammarly-g2-sideline-card-rewrite-ready-signal"}),n.createElement(m.k,{flex:"1",direction:"column",justify:"space-between","data-testid":"grammarly-g2-sideline-card-rewrite-ready-container",gap:3},n.createElement("div",{...(0,P.Sh)(De.sidelineCardRewriteReadyContent,o&&De.sidelineCardRewriteReadyContentWithTopScrollLimit,s&&De.sidelineCardRewriteReadyContentWithBottomScrollLimit),"data-testid":"grammarly-g2-sideline-card-rewrite-ready-content",ref:t},n.createElement(f.x,{...(0,P.Sh)(De.sidelineCardRewriteReadyContentTitle,Le(e.sidelineType,e.rewriteType)),as:"strong",variant:"text-small"},e.title),(0,r.zG)(i,d.UI((t=>n.createElement(Be,{key:"diff",diff:t.diff,displayDeletes:t.displayDeletes,blur:!!e.onClickUphookButton,onRevert:l}))),d.fS((()=>n.createElement(f.x,{as:"p",variant:"text-small"},e.newText))))),e.onShowUphookButton&&e.onClickUphookButton?n.createElement(Ge,{onShowUphookButton:e.onShowUphookButton,onClickUphookButton:e.onClickUphookButton}):n.createElement(Oe,{...e,onApply:()=>{const{diff:t}=d.fS((()=>({diff:[],displayDeletes:!1})))(i),r=(0,ee.Ns)(e.originalText,t);e.onApply(r)}})));var c,h},Ge=e=>n.createElement(m.k,{direction:"column",gap:2},n.createElement(m.k,{align:"end",justify:"start",height:"2rem"},n.createElement(f.x,{as:"strong"},"Upgrade for unlimited paragraph rewrites.")),n.createElement(m.k,{align:"end",justify:"space-between"},n.createElement(m.k,{align:"end",gap:2},n.createElement(Z.i,{ref:t=>{null!==t&&e.onShowUphookButton()},"data-testid":"grammarly-g2-sideline-card-rewrite-ready-uphook-button",variant:"premium",href:(0,re.Um)().planComparison,onClick:t=>{t.preventDefault(),e.onClickUphookButton()},text:"Get Pro",size:"small"})),n.createElement(m.k,{align:"end",justify:"end"},n.createElement(se,null)))),Oe=e=>{const[t,i]=n.useState(!1),r=n.useRef(),{sidelineType:a}=e,s="improve"===e.rewriteType.kind,o="signaling"===a,l=o&&!s,d=o&&s;n.useEffect((()=>()=>clearTimeout(r.current)),[]);const c=(0,te.OB)().experimentClient.isGateEnabled(ie.K.G2VBarsDeactivation);return n.createElement(m.k,{align:"end",justify:"space-between",height:"1.5rem","data-testid":"grammarly-g2-sideline-card-rewrite-ready-content-toolbar"},n.createElement(m.k,{align:"end",justify:"start",gap:2,"data-testid":"grammarly-g2-sideline-card-rewrite-ready-content-toolbar-left"},n.createElement(D,{text:"Accept",onClick:e.onApply,"data-testid":"grammarly-g2-sideline-card-rewrite-ready-content-apply-btn"}),d&&n.createElement(k.z,{"data-testid":"grammarly-g2-sideline-card-rewrite-ready-content-dismiss-btn",variant:"tertiary",text:"Dismiss",size:"small",onClick:e.onDismiss})),n.createElement(m.k,{align:"center",justify:"end",gap:2,"data-testid":"grammarly-g2-sideline-card-rewrite-ready-content-toolbar-right"},t&&n.createElement(m.k,{className:De.sidelineCardRewriteCopyButtonCopyConfirmation,bgColor:"background-base-default"},n.createElement(f.x,{as:"p",variant:"text-xsmall",color:"base-subdued"},"Copied")),n.createElement(k.z,{"data-testid":"grammarly-g2-sideline-feedback-btn",variant:"tertiary",text:"Feedback",size:"small",onClick:()=>e.onClickFeedbackButton()}),n.createElement(Me,{onCopy:async()=>{await e.onCopy(),i(!0),clearTimeout(r.current),r.current=setTimeout((()=>{i(!1)}),4e3)},onDismiss:l?e.onDismiss:void 0,onShowLess:"selection"!==a&&c?()=>e.onShowLess(a):void 0,domain:e.domain}),e.onRegenerate&&n.createElement(m.k,{className:De.sidelineCardRewriteCopyButton},n.createElement(J.h,{"data-testid":"grammarly-g2-sideline-card-regenerate-btn",variant:"tertiary",accessibilityLabel:"Regenerate",icon:X.a,size:"small",onClick:e.onRegenerate})),n.createElement(se,null)))};var He=i(62987),Ue=i(19337);const ze=({title:e,text:t,onMount:i})=>(B.P.useEffectOnDidMount((()=>i())),n.createElement(m.k,{direction:"column",height:"100%",justify:"center","data-testid":"grammarly-g2-sideline-card-rewrite-success",className:Ue.sidelineCardRewriteSuccess},n.createElement(m.k,{"data-testid":"grammarly-g2-sideline-card-rewrite-success-main",align:"center",gap:4},n.createElement(p.J,{size:"small",accessibilityLabel:"",icon:He.j}),n.createElement(m.k,{direction:"column","data-testid":"grammarly-g2-sideline-card-rewrite-success-main-content"},n.createElement(f.x,{className:Ue.sidelineCardRewriteSuccessMainContentTitle,as:"strong",color:"brand-default",variant:"text-small"},e),n.createElement(f.x,{as:"p",variant:"text-small",color:"base-subdued"},t))),n.createElement(se,{className:Ue.sidelineCardRewriteSuccessGrammarlyLogo}))),qe=e=>n.createElement(m.k,{accessibilityLabel:Ne(e.kind),padding:3,direction:"column","aria-live":"error"===e.kind?"assertive":"polite","aria-busy":"loading"===e.kind,"data-testid":"grammarly-g2-sideline-card-rewrite",className:z.sidelineCardRewrite},(()=>{switch(e.kind){case"loading":return n.createElement(Q,{maxHeight:e.maxHeight,streamedText:e.newText,onMount:e.onMount,onStreamingStart:e.onStreamingStart});case"ready":return n.createElement(Ae,{maxHeight:e.maxHeight,title:e.title,originalText:e.originalText,newText:e.newText,diffProps:e.diffProps,sidelineType:e.sidelineType,rewriteType:e.rewriteType,onApply:e.onApply,onCopy:e.onCopy,onRevert:e.onRevert,onDismiss:e.onDismiss,onMount:e.onMount,onRegenerate:e.onRegenerate,onClickFeedbackButton:e.onClickFeedbackButton,onShowUphookButton:e.onShowUphookButton,onClickUphookButton:e.onClickUphookButton,onShowLess:e.onShowLess,domain:e.domain});case"success":return n.createElement(ze,{title:e.title,text:e.text,onMount:e.onMount});case"error":return n.createElement(U,{errorDetails:e.errorDetails,errorReason:e.errorReason,onMount:e.onMount});default:(0,E.L0)(e)}})());function Ne(e){switch(e){case"loading":return"Loading suggested rewrite";case"ready":case"success":return"Suggested rewrite";case"error":return"An error occurred";default:(0,E.L0)(e)}}const Ve="⮐",We="←";var je=i(62481);const $e=({maxContentHeight:e,customPromptRewriteInfo:t,suggestedCustomPrompts:i,recentCustomPrompts:r,onGoBack:a,onChange:s,onSubmit:o})=>{const[l,d]=n.useState(""),c=n.useCallback((()=>{const e=l.trim();e.length>0&&o(e)}),[l]),h=n.useCallback((e=>{0===l.length&&"Backspace"===e.key&&(e.preventDefault(),e.stopPropagation(),a())}),[l]);return n.createElement(m.k,{className:je.sidelineCardCustomPrompt,direction:"column","data-testid":"grammarly-g2-sideline-card-custom-prompt"},n.createElement(m.k,{className:je.sidelineCardCustomPromptInput,align:"center",gap:{column:3},padding:2},n.createElement(D,{onClick:a,accessibilityLabel:"Go back",text:We,"data-testid":"grammarly-g2-sideline-card-custom-prompt-back-button"}),n.createElement("form",{className:je.sidelineCardCustomPromptInputForm,onSubmit:e=>{e.preventDefault(),c()}},n.createElement("input",{autoFocus:!0,type:"text",className:je.sidelineCardCustomPromptInputField,"aria-label":"Enter your prompt",placeholder:"Enter your prompt",onChange:e=>{d(e.target.value),s(e.target.value.trim())},onKeyDown:h,"data-testid":"grammarly-g2-sideline-card-custom-prompt-input-field"}),n.createElement("input",{type:"submit",style:{display:"none"},"data-testid":"grammarly-g2-sideline-card-custom-prompt-input-form-submit"})),l.trim().length>0&&n.createElement(D,{onClick:()=>c(),text:"Submit",shortcut:Ve})),t?n.createElement(qe,{...t,maxHeight:e}):n.createElement(m.k,{className:je.sidelineCardCustomPromptSuggestedResults,direction:"column",gap:{row:2},padding:2},n.createElement(f.x,{as:"p",color:"base-subdued",variant:"text-xsmall",className:je.sidelineCardCustomPromptSuggestedResultsSubtitle},"Tell us how to change this text.",i.length>0?" Try ideas below:":""),i.map((e=>n.createElement(D,{key:e,className:je.sidelineCardCustomPromptSuggestedResultsOption,iconStart:L.p,text:e,accessibilityLabel:`Submit suggested prompt: ${e}`}))),r.length>0&&n.createElement(f.x,{as:"p",color:"base-subdued",variant:"text-xsmall",className:je.sidelineCardCustomPromptSuggestedResultsSubtitle},"Recent"),r.map((e=>n.createElement(D,{key:e,className:je.sidelineCardCustomPromptSuggestedResultsOption,iconStart:A.w,text:e,accessibilityLabel:`Submit recent prompt: ${e}`})))))};const Ye=({shortenRewriteInfo:e,friendlyRewriteInfo:t,formalRewriteInfo:i,improveTabRef:r,onClickCustomPromptEntryPoint:a})=>n.createElement(I.m.TabList,{accessibilityLabel:"Type of rewrite",bottomBorder:"none"},n.createElement(I.m.Tab,{id:"improve",label:"Improve",ref:r}),n.createElement(I.m.Tab,{id:"rephrase",label:"Rephrase"}),!e&&!t&&!i&&n.createElement(I.m.Tab,{id:"more",label:"More"}),e&&n.createElement(I.m.Tab,{id:"shorten",label:"Shorten"}),t&&n.createElement(I.m.Tab,{id:"friendly",label:"Friendly"}),i&&n.createElement(I.m.Tab,{id:"formal",label:"Formal"}),n.createElement(D,{className:F.sidelineCardCustomPromptEntryPoint,onClick:a,"data-testid":"grammarly-g2-sideline-card-custom-prompt-entry-point",text:"Enter your own...",accessibilityLabel:"Enter your own prompt"})),Qe=({maxContentHeight:e,improveRewriteInfo:t,rephraseRewriteInfo:i,shortenRewriteInfo:r,friendlyRewriteInfo:a,formalRewriteInfo:s})=>n.createElement(n.Fragment,null,n.createElement(I.m.Panel,{id:"improve"},n.createElement(qe,{...t,maxHeight:e})),n.createElement(I.m.Panel,{id:"rephrase"},n.createElement(qe,{...i,maxHeight:e})),r&&n.createElement(I.m.Panel,{id:"shorten"},n.createElement(qe,{...r,maxHeight:e})),a&&n.createElement(I.m.Panel,{id:"friendly"},n.createElement(qe,{...a,maxHeight:e})),s&&n.createElement(I.m.Panel,{id:"formal"},n.createElement(qe,{...s,maxHeight:e})));const Ke=n.forwardRef((function({maxHeight:e=200,tabListPosition:t,sidelineCard:i,improveRewriteInfo:r,rephraseRewriteInfo:a,shortenRewriteInfo:s,friendlyRewriteInfo:o,formalRewriteInfo:l,suggestedCustomPrompts:d,recentCustomPrompts:c,customPromptRewriteInfo:h,onChangeCustomPrompt:g,onSubmitCustomPrompt:u,onChangeSelectedRewriteType:m,onClickMoreTab:p,onShow:v,onClose:f},w){const[S,_]=n.useState(T.D.selectedRewriteType),[b,y]=n.useState({kind:"improve"}),k=n.useRef(T.D.selectedRewriteType),C=n.useRef(null),R=n.useRef(null);n.useEffect((()=>{k.current.kind!==b.kind&&(k.current=b,m(b))}),[b]),n.useEffect((()=>{v(i),null!==R.current&&f(R.current),R.current=i}),[i.sideline.id]),B.P.useEffectOnWillUnmount((()=>f(i)));const x=n.createElement(Ye,{shortenRewriteInfo:s,friendlyRewriteInfo:o,formalRewriteInfo:l,improveTabRef:C,onClickCustomPromptEntryPoint:()=>{_(b),y({kind:"customPrompt",prompt:""})}}),P=e-40-24,M=n.createElement(Qe,{maxContentHeight:P,improveRewriteInfo:r,rephraseRewriteInfo:a,shortenRewriteInfo:s,friendlyRewriteInfo:o,formalRewriteInfo:l});return n.createElement("div",{ref:w,className:F.sidelineCard,"data-testid":"grammarly-g2-sideline-card"},"customPrompt"===b.kind?n.createElement($e,{maxContentHeight:P,suggestedCustomPrompts:null!=d?d:[],recentCustomPrompts:null!=c?c:[],customPromptRewriteInfo:h,onGoBack:()=>y(S),onChange:g,onSubmit:u}):n.createElement(I.m,{defaultSelectedTab:b.kind,onChange:e=>{var t;"more"===e?(p(),null===(t=C.current)||void 0===t||t.click()):y(function(e){switch(e){case"improve":return{kind:"improve"};case"rephrase":return{kind:"rephrase"};case"shorten":return{kind:"shorten"};case"friendly":return{kind:"friendly"};case"formal":return{kind:"formal"};default:(0,E.L0)(e)}}(e))}},"top"===t?x:M,n.createElement("div",{className:F.sidelineCardHorizontalDivider}),"bottom"===t?x:M))}));var Ze=i(44665),Je=i(66540),Xe=i(24059),et=i(54089),tt=i(79123),it=i(86255);const rt={name:"eventListeners",enabled:!1},nt=({referenceElement:e,onMouseEnter:t,onMouseLeave:i,onFocus:r,onClickAway:a,onEscPress:s,contentHeightIsFixed:o,contentWrapperHeight:l=0,children:d})=>{const[c,h]=n.useState(null),[g,u]=n.useState(void 0),m=n.useMemo((()=>({...Ze.Z,options:{offset:({placement:e})=>["right-end"===e?0:tt.BP+4,tt.y6]}})),[]),p=n.useMemo((()=>({...Je.Z,enabled:Boolean(o),options:{fallbackPlacements:["top-start","right-end"]}})),[o]),v=n.useMemo((()=>({name:"maxHeight",enabled:!o,phase:"main",requiresIfExists:["offset"],fn({name:e,state:t,options:i}){if(t.modifiersData[e]._skip)return;const r=(0,Xe.Z)({...t,placement:"top-start"},i),n=(0,Xe.Z)({...t,placement:"bottom-start"},i),{height:a}=t.rects.popper,s=a-r.top-tt.y6-l,o=a-n.bottom-tt.y6-l,d=200+l;s<d&&o<d?(t.modifiersData[e]._skip=!0,t.placement="right-end",t.reset=!0,u(t.rects.reference.height+s)):o>=s?(t.modifiersData[e]._skip=!0,t.placement="bottom-start",t.reset=!0,u(o)):(t.modifiersData[e]._skip=!0,t.placement="top-start",t.reset=!0,u(s))},data:{_skip:!1}})),[o,l]),{styles:f,attributes:w,state:S}=(0,oe.D)(e,c,{placement:"bottom-start",modifiers:[m,p,v,rt]});return n.useEffect((()=>{const e="keydown",t=e=>{"Escape"===e.key&&(e.stopImmediatePropagation(),s(e))};return document.addEventListener(e,t,true),()=>{document.removeEventListener(e,t,true)}}),[s]),n.createElement(et.d,{onClickAway:a},n.createElement("div",{"data-testid":"grammarly-g2-sideline-card-popper",role:"dialog","aria-label":"Suggested rewrite dialog",tabIndex:0,ref:h,style:f.popper,className:it.sidelineCardPopper,onMouseEnter:t,onMouseLeave:i,onFocus:r,...w.popper},d({placement:null==S?void 0:S.placement,maxHeight:g})))};var at=i(17071),st=i(77181);const ot=({sidelineCard:e,shouldShowOnboarding:t,vBarsQuotaInfo:i,getSidelineCardState:m,onActivateSidelineCard:p,onDeactivateSidelineCard:v,onChangeSelectedRewriteType:f,onMountRewriteLoading:w,onMountRewriteEmpty:S,onMountRewriteReady:b,onMountRewriteError:y,onApplyRewrite:k,onCopyRewrite:C,onRevertRewrite:R,onDismissRewrite:B,onDeactivateSidelineType:I,onRegenerateRewrite:T,onChangeCustomPrompt:F,onSubmitCustomPrompt:P,onClickMoreTab:M,onClickFeedbackButton:D,onShow:L,onClose:A,onShowUphookButton:G,onClickUphookButton:O,onOnboardingDismiss:H,onStreamingStart:U,integrationInfo:z})=>{const q=(e,t,i)=>function(e){const{rewrite:t,sidelineType:i,onMountRewriteLoading:n,onMountRewriteEmpty:a,onMountRewriteReady:s,onMountRewriteError:o,onApplyRewrite:l,onCopyRewrite:c,onRevertRewrite:h,onDismissRewrite:g,onRegenerateRewrite:u,onClickFeedbackButton:m,onStreamingStart:p,onShowUphookButton:v,onClickUphookButton:f,onDeactivateSidelineType:w,domain:S}=e;if("loading"===t.kind||"idle"===t.kind){const e="loading"===t.kind;return{kind:"loading",newText:e?t.rewriteTextPartial:void 0,onMount:()=>n(t),onStreamingStart:e?()=>p(t):at.Q1}}return"ready"===t.kind?t.vBar.text===t.rewriteText?{kind:"success",title:"This text is well-written",text:"To see a different version, select a rewrite option.",onMount:()=>a(t)}:{kind:"ready",title:t.title,originalText:t.vBar.text,newText:t.rewriteText,diffProps:(0,r.zG)(t.rewriteDiff,d.UI((e=>({diff:e,displayDeletes:"improve"===t.type.kind})))),sidelineType:i,rewriteType:t.type,onMount:()=>s(t),onApply:e=>l({...t,rewriteText:e}),onCopy:()=>c(t),onRevert:()=>h(t),onDismiss:()=>g(t),onShowLess:e=>w(e,t),domain:S,onRegenerate:(0,st.es)(t.type)?void 0:()=>u(t),onClickFeedbackButton:()=>m(t),onShowUphookButton:v,onClickUphookButton:f}:"error"===t.kind?{kind:"error",errorDetails:t.errorDetails,errorReason:t.errorReason,onMount:()=>o(t)}:void(0,E.L0)(t)}({rewrite:e,sidelineType:t.sideline.kind,onMountRewriteLoading:e=>w(e,t),onMountRewriteEmpty:e=>S(e,t),onMountRewriteReady:e=>b(e,t,i),onMountRewriteError:e=>y(e,t),onApplyRewrite:e=>k(e,t),onCopyRewrite:e=>C(e,t),onRevertRewrite:e=>R(e,t),onDismissRewrite:e=>B(e,t),onRegenerateRewrite:e=>T(e,t),onClickFeedbackButton:e=>D(e,t),onStreamingStart:e=>U(e,t),onShowUphookButton:i?()=>G(e,t):void 0,onClickUphookButton:i?()=>O(e,t):void 0,onDeactivateSidelineType:(e,i)=>I(e,i,t),domain:z.domain});return n.createElement(c.F.Fragment,null,a.aj([e.pipe(s.U(d.WG),o.O(null),l.G()),t]).pipe(s.U((([[e,t],a])=>{const s=null!=t?t:e,o=s?m(s):null;return n.createElement(g,{show:null!==t,transitionDurationMs:150},s&&o&&n.createElement(nt,{referenceElement:s.referenceElement,contentHeightIsFixed:a,contentWrapperHeight:d.pC(i.get())?36:void 0,onMouseEnter:()=>p(s,!1),onMouseLeave:()=>v(s,!1),onFocus:()=>p(s,!0),onClickAway:()=>v(s,!0),onEscPress:()=>v(s,!0)},(({placement:e,maxHeight:t})=>a?n.createElement(x,{onComplete:H,onDismiss:H}):n.createElement(c.F.Fragment,null,h.h.combine(o,i,((i,a)=>{const{improveRewriteInfo:o,rephraseRewriteInfo:l,shortenRewriteInfo:c,friendlyRewriteInfo:h,formalRewriteInfo:g,customPromptRewriteInfo:m}=i,{quota:p,showUphook:v}=(0,r.zG)(a,d.UI((e=>({quota:e.quota,showUphook:(0,u.Q)(e,s.sideline.textHash)}))),d.pF((()=>({showUphook:!1,quota:void 0}))));return n.createElement(_,{quota:p,showUphook:v},n.createElement(Ke,{maxHeight:t,tabListPosition:"top-start"===e?"bottom":"top",sidelineCard:s,improveRewriteInfo:q(o,s,v),rephraseRewriteInfo:q(l,s,v),shortenRewriteInfo:(0,r.zG)(c,d.UI((e=>q(e,s,v))),d.pF(r.r5)),friendlyRewriteInfo:(0,r.zG)(h,d.UI((e=>q(e,s,v))),d.pF(r.r5)),formalRewriteInfo:(0,r.zG)(g,d.UI((e=>q(e,s,v))),d.pF(r.r5)),customPromptRewriteInfo:(0,r.zG)(m,d.UI((e=>q(e,s,v))),d.pF(r.r5)),onChangeCustomPrompt:e=>F(e,s),onSubmitCustomPrompt:e=>P(e,s),onChangeSelectedRewriteType:e=>f(e,s),onClickMoreTab:()=>M(s),onShow:e=>{L(e,v)},onClose:e=>{A(e)}}))}))))))}))))}},48207:(e,t,i)=>{i.r(t),i.d(t,{SidelineCollection:()=>C});var r=i(90023),n=i(49231),a=i(58303),s=i(25770),o=i(43818),l=i(2422),d=i(7399),c=i(99627),h=i(46011),g=i(3402),u=i(68259),m=i(68567),p=i(96708),v=i(97211),f=i(79123);function w(e,t,i,r){return(0,c.Sh)(v.sideline,e?v.sidelineEmphasized:v.sidelineIdle,"selection"===t?v.sidelineWithSelectionSignal:void 0,i?v.sidelineWithSignalBar:void 0,r?function(e){let t;switch(e){case"signaling":t=v.pulsingSignalingSideline;break;case"idle":t=v.pulsingIdleSideline;break;case"selection":t=v.pulsingSelectionSideline;break;default:(0,u.L0)(e)}return(0,c.Sh)(v.pulsingSideline,t).className}(t):void 0).className}function S(e,t,i,r,n,a){return(0,c.Sh)(v.sidelineSignalBar,function(e,t,i){if(t)return v.sidelineSignalBarLoading;switch(e){case"signaling":return i?v.sidelineSignalBarAttentionUphook:v.sidelineSignalBarAttention;case"selection":case"idle":return;default:(0,u.L0)(e)}}(t,r,n),e?v.sidelineSignalBarEmphasized:void 0,i?void 0:v.sidelineSignalBarHidden,a?v.sidelineSignalBarSubdued:void 0).className}function _(e,t){return(0,c.Sh)(v.sidelineArrow,e?v.sidelineArrowVisible:void 0,t?v.sidelineArrowBottom:void 0).className}const b=n.forwardRef((function({emphasized:e,heightInPixels:t,sidelineType:i,sidelineId:r,isLoading:a,isUphook:s,onClick:o,isSubdued:l,shouldPulse:c,onMouseOver:h,onMouseOut:g,onFocus:u,onBlur:v,onMount:b,onShow:y,onHide:k},C){const R=n.useRef(!1),x=n.useRef(r),B=("signaling"===i||a&&e)&&!(e&&!(t>=24)),E=B||e;return d.P.useEffectOnDidMount((()=>b())),d.P.useEffectOnWillUnmount((()=>{R.current&&k()})),((e,t,i,r)=>{n.useEffect((()=>{e.current!==t&&(e.current=t,t?i():r())}),[t,i,r])})(R,E,y,k),n.useEffect((()=>{x.current!==r&&E&&y()}),[E,r]),n.createElement("button",{"data-testid":"grammarly-g2-sideline",className:w(e,i,B,c),style:{height:t,width:f.BP},disabled:!e,onClick:e?o:void 0,onFocus:e?u:void 0,onBlur:e?v:void 0,onMouseOver:h,onMouseOut:g,"aria-label":"See rewrite suggestions",ref:C},n.createElement("div",{className:S(e,i,B,a,s,l),role:"status","aria-label":"Rewrite suggestions available"}),n.createElement(m.J,{className:_(e,B),icon:p.b,accessibilityLabel:"",size:"small",variant:"selection"===i?"inverse":"default"}))}));var y=i(26396);const k=({sideline:e,isEmphasized:t,isActive:i,viewport:r,onPin:a,onActivate:s,onDeactivate:o,onMount:l,onShow:u,onHide:m,onRefChange:p,isUphook:v,showSelectionHighlight:w=!1,isSubdued:S,shouldPulse:_})=>{const k={top:r.rect.top-f.y6,left:r.rect.left,width:r.rect.width,height:r.rect.height+2*f.y6},C={top:r.rect.top,left:k.left+f.y6},R=r.rect.height,x=(0,g.iu)(e),B=i&&!x,E=w&&x&&e.highlightRects,I=n.useRef();return d.P.useEffectOnWillUnmount((()=>self.clearTimeout(I.current))),n.createElement(n.Fragment,null,n.createElement("span",{"data-testid":`grammarly-g2-sideline-paragraph-highlighter-${e.id}`,...(0,c.Sh)(y.sidelineParagraphHighlighter,B?y.sidelineParagraphHighlighterActive:void 0),style:k}),E&&n.createElement("div",{"data-testid":`grammarly-g2-sideline-selection-highlight-${e.id}`,className:y.sidelineSelectionHighlight},n.createElement(h.y$,{id:e.id,rects:e.highlightRects,displayFormat:h.jk.background,color:h.hE.Preset.create(h.al.gray),liveliness:null,disappearOnHoverDelay:null})),n.createElement("span",{"data-testid":`grammarly-g2-sideline-positioner-${e.id}`,className:y.sidelinePositioner,style:C},n.createElement(b,{isUphook:v,isSubdued:S,shouldPulse:_,emphasized:i||t,heightInPixels:R,sidelineType:e.kind,sidelineId:e.id,isLoading:!1,onClick:()=>a(e),onFocus:()=>a(e),onMouseOver:()=>{s(e,!1),I.current=self.setTimeout((()=>s(e,!0)),250)},onMouseOut:()=>{o(e),self.clearTimeout(I.current)},onMount:()=>l(e),onShow:()=>u(e),onHide:()=>m(e),ref:t=>{t&&p(e,t)}})))},C=({paragraphSidelines:e,pinnedSideline:t,activeSideline:i,emphasizedSideline:d,selectionSideline:c,shouldHideSidelines:h,shouldShowOnboarding:g,shouldShowSelectionHighlight:u,vBarsQuotaInfo:m,shouldSubdueVBars:p,onPinSideline:v,onActivateSideline:f,onDeactivateSideline:w,onMountSideline:S,onShowSideline:_,onHideSideline:b,onSidelineRefChange:y})=>{const C={onPin:v,onActivate:f,onDeactivate:w,onMount:S,onShow:_,onHide:b,onRefChange:y},R=s.h.combine(e,t,i,d,c,h,g,((e,t,i,n,s,o,l)=>o?[]:(0,r.zG)(t,a.UI((e=>[{...C,sideline:e,isEmphasized:!0,isActive:!0,viewport:e.highlightViewport,showSelectionHighlight:u,shouldPulse:l}])),a.wp((()=>(0,r.zG)(s,a.UI((e=>[{...C,sideline:e,isEmphasized:!0,isActive:(0,r.zG)(i,a.g_(r.jv,(t=>t.sequentialId===e.sequentialId))),viewport:e.highlightViewport,showSelectionHighlight:!1,shouldPulse:l}]))))),a.pF((()=>{let t=e;if(l){const i=e.find((e=>"signaling"===e.kind));t=i?[i]:e}return t.map(((e,t)=>({...C,sideline:e,isEmphasized:(0,r.zG)(n,a.g_(r.jv,(t=>t.sequentialId===e.sequentialId))),isActive:(0,r.zG)(i,a.g_(r.jv,(t=>t.sequentialId===e.sequentialId))),viewport:e.highlightViewport,showSelectionHighlight:!1,shouldPulse:l&&0===t})))})))));return n.createElement(o.F.Fragment,null,R.view((e=>e.map((e=>n.createElement(o.F.Fragment,{key:e.sideline.id},s.h.combine(m,p,((t,i)=>{const s=(0,r.zG)(t,a.UI((t=>(0,l.Q)(t,e.sideline.textHash))),a.pF((()=>!1)));return n.createElement(k,{...e,isUphook:s,isSubdued:i})}))))))))}},98305:(e,t,i)=>{i.d(t,{t:()=>H,D:()=>O});var r=i(9115),n=i(82823),a=i(36072),s=i(39620),o=i(60841),l=i(65647),d=i(58303),c=i(68259),h=i(25770),g=i(4603),u=i(41847),m=i(4798),p=i(94996),v=i(13458),f=i(77181),w=i(20715),S=i(90049),_=i(64965),b=i(55446),y=i(73863),k=i(34859),C=i(74857),R=i(80724),x=i(57935);var B=i(90023),E=i(25989);var I=i(65882),T=i(72779),F=i(6557);function P(e){var t,i;const r=(0,T.wr)(e,(e=>"hidden"===e.style.overflow));if(!r)return e;const n=e.getBoundingClientRect();let a=Math.max(0,n.top),s=Math.min(self.innerHeight,n.top+n.height),o=r;for(;o&&"hidden"===o.style.overflow;){const{height:e,top:t}=o.getBoundingClientRect();a=Math.max(t,a),s=Math.min(t+e,s),o=o.parentElement}if(n.top>s||n.bottom<a)return e;if(n.top>=a&&n.bottom<=s)return e;const l=null===(i=null===(t=document.getElementsByTagName(F.Hq)[0])||void 0===t?void 0:t.shadowRoot)||void 0===i?void 0:i.getElementById(F.wE);return l?(l.style.top=`${a}px`,l.style.left=`${n.left}px`,l.style.width=`${n.width}px`,l.style.height=s-a+"px",l):e}var M=i(85782),D=i(12171);function L(e,t=300){return e.pipe(M.v((({rewrite:e,vBarCard:t})=>`${e.id}-${t.sideline.id}`)),D.zg((e=>e.pipe(C.b(t)))))}function A(e,t,i){return`${e}-${t.type.kind}-${i.sideline.id}`}function G(e,t){return A("rewrite-loading",e,t)}const O={selectedRewriteType:{kind:"improve"},improveRewriteInfo:{type:{kind:"improve"},kind:"idle"},rephraseRewriteInfo:{type:{kind:"rephrase"},kind:"idle"},shortenRewriteInfo:d.YP,friendlyRewriteInfo:d.YP,formalRewriteInfo:d.YP,customPromptRewriteInfo:d.YP,rewriteApplied:!1,rewriteCopied:!1};class H{constructor(e){var t,i;this._params=e,this._subs=new n.w,this._logger=(0,v.h)(H.name),this._sidelineCardStateMap=new Map,this._sidelineCard=h.h.create(d.YP),this._performanceMarkNames=new Set,this._notifyRewriteReadyShownSubject=new a.xQ,this._notifyRewriteEmptyShownSubject=new a.xQ,this._notifyRewriteErrorShownSubject=new a.xQ,this._rewriteSubjectMap=new Map,this._rewriteSubscriptionMap=new Map,this.sidelineCard=this._sidelineCard.view(),this._subs.add((t=this._params.sidelineCollectionViewModel,I.aj([t.activeSideline,t.pinnedSideline]).pipe(C.b(0),l.U((([e,t])=>(0,B.zG)(t,d.UI((e=>({sideline:e,isPinned:!0}))),d.wp((()=>(0,B.zG)(e,d.UI((e=>({sideline:e,isPinned:!1}))))))))),l.U(d.tS((({sideline:e,isPinned:i})=>(0,B.zG)(t.getSidelineHtmlElement(e.sequentialId),d.UI((t=>({sideline:e,isSidelinePinned:i,referenceElement:P(t)}))))))))).subscribe(s.wW(this._sidelineCard))),this._subs.add(L(this._notifyRewriteReadyShownSubject).subscribe((({rewrite:e,vBarCard:t,isUphook:i})=>{this._logger.debug("Tracking vBarCardRewriteReadyShown().",{rewrite:e,sidelineId:t.sideline.id}),this._params.trackingService.vBarCardRewriteReadyShown({vBar:t.sideline,rewrite:e,duration:this._getDurationSinceMostRecentRewriteLoadingPerformanceMark(e,t),isUphook:Boolean(i)})}))),this._subs.add(L(this._notifyRewriteEmptyShownSubject).subscribe((({rewrite:e,vBarCard:t})=>{this._logger.debug("Tracking vBarCardRewriteEmptyShown().",{rewrite:e,sidelineId:t.sideline.id}),this._params.trackingService.vBarCardRewriteEmptyShown({vBar:t.sideline,rewrite:e,duration:this._getDurationSinceMostRecentRewriteLoadingPerformanceMark(e,t)})}))),this._subs.add(L(this._notifyRewriteErrorShownSubject).subscribe((({rewrite:e,vBarCard:t})=>{this._logger.debug("Tracking vBarCardRewriteErrorShown().",{rewrite:e,sidelineId:t.sideline.id}),this._params.trackingService.vBarCardRewriteErrorShown({vBar:t.sideline,rewrite:e,duration:this._getDurationSinceMostRecentRewriteLoadingPerformanceMark(e,t)})}))),(0,g.OB)().experimentClient.isGateEnabled(m.K.G2VBarsSelectionPreload)&&this._subs.add((i=this._params.sidelineCollectionViewModel.selectionSideline,i.pipe(o.w(d.g_((()=>w.of(d.YP)),(e=>S.T(_.R(document,"mouseup"),_.R(document,"mousemove").pipe(b.h((e=>0===e.buttons)))).pipe(y.q(1),k.h(d.G(e)))))),C.b(x.m9(.2)),R.oA)).subscribe((e=>{this._logger.debug('Preloading "improve" rewrite for selection sideline.',{sidelineId:e.id}),this._params.rewriteService.getRewrite({rewriteType:{kind:"improve"},vBar:e,isPreload:!0})})))}_getSidelineCardState(e){var t;return null!==(t=this._sidelineCardStateMap.get(e.sideline.id))&&void 0!==t?t:this._initSidelineCardState(e)}_initSidelineCardState(e){this._logger.debug("Initializing sideline card state.",{sidelineId:e.sideline.id});const t=h.h.create(O);return this._sidelineCardStateMap.set(e.sideline.id,t),t}_setRewriteInfo(e,t){this._logger.debug("Setting rewrite info.",{sidelineId:t.sideline.id,rewrite:e});const i=this._getSidelineCardState(t);switch(e.type.kind){case"improve":i.lens("improveRewriteInfo").set(e);break;case"rephrase":i.lens("rephraseRewriteInfo").set(e);break;case"shorten":i.lens("shortenRewriteInfo").set(d.G(e));break;case"friendly":i.lens("friendlyRewriteInfo").set(d.G(e));break;case"formal":i.lens("formalRewriteInfo").set(d.G(e));break;case"customPrompt":i.lens("customPromptRewriteInfo").set(d.G(e));break;default:(0,c.L0)(e.type)}}_showAllRewriteTypes(e){const t=this._getSidelineCardState(e);d.Wi(t.get().shortenRewriteInfo)&&this._setRewriteInfo({type:{kind:"shorten"},kind:"idle"},e),d.Wi(t.get().friendlyRewriteInfo)&&this._setRewriteInfo({type:{kind:"friendly"},kind:"idle"},e),d.Wi(t.get().formalRewriteInfo)&&this._setRewriteInfo({type:{kind:"formal"},kind:"idle"},e)}_performanceMark(e){performance.mark(e),this._performanceMarkNames.add(e)}_clearPerformanceMark(e){performance.clearMarks(e),this._performanceMarkNames.delete(e)}_measureDuration(e,t,i){const r=performance.getEntriesByName(t).length>0?performance.measure(e,t,i).duration:void 0;return this._clearPerformanceMark(t),r}_getDurationSinceMostRecentRewriteLoadingPerformanceMark(e,t){const i=G(e,t),r=A("rewrite-shown",e,t);return this._measureDuration(r,i)}getSidelineCardState(e){return this._getSidelineCardState(e)}activateSidelineCard(e,t){this._params.sidelineCollectionViewModel.notifySidelineCardActive(e.sideline.sequentialId,t)}deactivateSidelineCard(e,t){(!e.isSidelinePinned||e.isSidelinePinned&&t)&&this._params.sidelineCollectionViewModel.notifySidelineCardInactive(e.sideline.sequentialId,t)}applyRewrite(e,t){this._logger.debug("Apply rewrite.",{rewrite:e,sidelineCard:t}),this._params.trackingService.vBarCardRewriteApplied({vBar:t.sideline,rewrite:e}),this._params.performReplacement({pos:e.vBar.textRange,value:e.rewriteText,oldValue:e.vBar.text},{sidelineType:t.sideline.kind}).then((t=>{const i=(Array.isArray(t)?t:[t]).filter(u.j.isFail);if(i.length>0){let e="Replacement(s) failed.";const t=i.map((e=>e.reason)).filter(Boolean);throw t.length>0&&(e+=` Reason(s): ${t.join(", ")}.`),new Error(e)}"alert"===e.source.kind&&this._params.alertCollectionService.removeAcceptedAlert(e.source.alertId),this._params.telemetryService.info({message:"Applying rewrite succeeded."})})).catch((e=>this._params.telemetryService.error({message:"Applying rewrite failed.",error:e}))),this._getSidelineCardState(t).lens("rewriteApplied").set(!0),this._params.sidelineCollectionViewModel.notifySidelineCardInactive(t.sideline.sequentialId,!0)}async copyRewrite(e,t){this._logger.debug("Copy rewrite.",{rewrite:e,sidelineCard:t}),this._params.trackingService.vBarCardRewriteCopied({vBar:t.sideline,rewrite:e});try{await(0,p.vQ)(e.rewriteText),this._params.telemetryService.info({message:"Copying rewrite succeeded."})}catch(e){this._params.telemetryService.error({message:"Copying rewrite failed.",error:e}),this._logger.error("Failed to copy rewrite.",e)}this._getSidelineCardState(t).lens("rewriteCopied").set(!0)}dismissRewrite(e,t){this._logger.debug("Dismiss rewrite.",{rewrite:e,sidelineCard:t}),this._params.trackingService.vBarCardRewriteDismissed({vBar:t.sideline,rewrite:e});let i="alert"===e.source.kind?e.source.alertId:void 0;if(!i){const e=this.getSidelineCardState(t).lens("improveRewriteInfo").get();"ready"===e.kind&&"alert"===e.source.kind&&(i=e.source.alertId)}i?this._params.alertCollectionService.ignoreAlert(i):this._params.telemetryService.warn({message:"Unable to find alertId associated with rewrite"}),this._params.sidelineCollectionViewModel.notifySidelineCardInactive(t.sideline.sequentialId,!0)}deactivateSidelineType(e,t,i){this._logger.debug("Show less.",{rewrite:t,sidelineCard:i,vBarType:i.sideline.kind}),this._params.trackingService.vBarCardShowLessClicked({vBar:i.sideline,rewrite:t,domain:this._params.integrationInfo.domain}),this._params.availabilityService.deactivate(e)}regenerateRewrite(e,t){var i;this._logger.debug("Regenerate rewrite.",{sidelineId:t.sideline.id,rewrite:e}),this._params.trackingService.vBarCardRewriteRegenerated({vBar:t.sideline,rewrite:e}),null===(i=this._rewriteSubjectMap.get(t.sideline.id))||void 0===i||i.next({rewriteType:e.type,sidelineCard:t,useCache:!1,isRegenerate:!0})}submitCustomPrompt(e,t){var i;this._logger.debug("Submitting custom prompt.",{sidelineId:t.sideline.id,prompt:e}),this._params.trackingService.vBarCardCustomPromptSubmitted({vBar:t.sideline}),null===(i=this._rewriteSubjectMap.get(t.sideline.id))||void 0===i||i.next({rewriteType:{kind:"customPrompt",prompt:e},sidelineCard:t,useCache:!1,isRegenerate:!1})}dismissOnboarding(){this._params.onboardingService.notifyOnboardingShown()}notifySelectedRewriteTypeChanged(e,t){var i;this._logger.debug("Selected rewrite type changed.",{sidelineId:t.sideline.id,rewriteType:e}),(0,f.L5)(e)&&this._showAllRewriteTypes(t);const n=this._getSidelineCardState(t).lens("selectedRewriteType");this._params.trackingService.vBarCardRewriteSelected({vBar:t.sideline,rewriteType:e,previousRewriteType:n.get()}),n.set(e),(0,r.ff)(f.J8)(e)&&(null===(i=this._rewriteSubjectMap.get(t.sideline.id))||void 0===i||i.next({rewriteType:e,sidelineCard:t,useCache:!0,isRegenerate:!1}))}notifyCustomPromptChanged(e,t){this._getSidelineCardState(t).lens("customPromptRewriteInfo").set(d.YP)}notifyRewriteLoadingShown(e,t){this._logger.debug("notifyRewriteLoadingShown()",{rewrite:e,sidelineId:t.sideline.id});const i=G(e,t);this._clearPerformanceMark(i),this._performanceMark(i)}notifyRewriteEmptyShown(e,t){this._notifyRewriteEmptyShownSubject.next({rewrite:e,vBarCard:t})}notifyRewriteReadyShown(e,t,i){this._params.telemetryService.infoOncePerMessage({message:"Rendering sideline card rewrite succeeded."}),this._notifyRewriteReadyShownSubject.next({rewrite:e,vBarCard:t,isUphook:i})}notifyRewriteErrorShown(e,t){this._notifyRewriteErrorShownSubject.next({rewrite:e,vBarCard:t})}notifyRewriteStreamingStart(e,t){this._logger.debug("notifyRewriteStreamingStart()",{rewrite:e,sidelineId:t.sideline.id});const i=G(e,t),r=A("rewrite-streaming-start",e,t),n=this._measureDuration(r,i);this._params.trackingService.vBarCardRewriteStreamingStart({vBar:t.sideline,duration:n,rewrite:e})}notifyRewriteReverted(e,t){this._logger.debug("notifyRewriteReverted()",{rewrite:e,sidelineId:t.sideline.id}),this._params.trackingService.vBarCardRewriteReverted({vBar:t.sideline,rewrite:e})}notifySidelineCardShown(e,t){var i,r;this._logger.debug("notifySidelineCardShown()",{vBarId:e.sideline.id,isUphook:t}),this._params.trackingService.vBarCardShown({vBar:e.sideline,isUphook:t}),this._params.telemetryService.infoOncePerMessage({message:"Rendering sideline card succeeded."}),null===(i=this._rewriteSubscriptionMap.get(e.sideline.id))||void 0===i||i.unsubscribe();const n=null!==(r=this._rewriteSubjectMap.get(e.sideline.id))&&void 0!==r?r:new a.xQ;this._rewriteSubjectMap.set(e.sideline.id,n);const s=n.pipe(o.w((({rewriteType:e,sidelineCard:t,useCache:i,isRegenerate:r})=>function(e,t,i,r,n=!0){const a=i.getSidelineCalliopeAlerts(e.sideline.sequentialId);return"improve"===t.kind&&a.length>0?w.of(r.getImproveRewriteFromCalliopeAlert({vBar:e.sideline,calliopeAlert:a[0]})):E.D(r.getRewrite({rewriteType:t,vBar:e.sideline,isPreload:!1,skipCache:!n})).pipe(y.q(1),o.w(B.yR))}(t,e,this._params.sidelineCollectionViewModel,this._params.rewriteService,i).pipe(l.U((e=>({rewrite:e,isRegenerate:r}))))))).subscribe((({rewrite:t,isRegenerate:i})=>{this._logger.debug("Rewrite observable emitted.",{sidelineId:e.sideline.id,rewrite:t,isRegenerate:i}),"ready"===t.kind&&this._params.telemetryService.info({message:i?"Regenerating rewrite succeeded.":"Retrieving rewrite succeeded."}),this._setRewriteInfo(t,e)}));this._rewriteSubscriptionMap.set(e.sideline.id,s),this._subs.add(s),n.next({rewriteType:{kind:"improve"},sidelineCard:e,useCache:!0,isRegenerate:!1}),this._params.monetizationService.markVBarUsed(e.sideline)}notifySidelineCardClosed(e){var t;const i=this._getSidelineCardState(e),r=i.lens("rewriteApplied").get();this._logger.debug("notifySidelineCardClosed()",{sidelineId:e.sideline.id,isRewriteApplied:r}),r||this._params.trackingService.vBarCardClosed({vBar:e.sideline}),null===(t=this._rewriteSubscriptionMap.get(e.sideline.id))||void 0===t||t.unsubscribe(),i.set(O)}notifyMoreTabClicked(e){this._showAllRewriteTypes(e)}notifyFeedbackButtonClicked(e,t){this._params.feedbackFormViewModel.showFeedbackForm(e,t)}notifyUphookButtonClicked(e,t){this._params.monetizationService.executeUphook(t.sideline,e),this._params.trackingService.vBarCardRewriteUphookClicked({vBar:t.sideline,rewrite:e})}notifyUphookButtonShown(e,t){this._params.trackingService.vBarCardRewriteUphookShown({vBar:t.sideline,rewrite:e})}dispose(){this._subs.unsubscribe()}}},48377:(e,t,i)=>{i.d(t,{FS:()=>_,Ns:()=>S,jy:()=>p});var r=i(60213),n=i(12518),a=i(53186),s=i(3190),o=i(90023),l=i(79992);const d=/\s/;function c(e,t){const i=e.split(d),[r,...n]=i;t(r);let a=r.length;for(const i of n){t(e[a]),a+=i.length+1,t(i)}}function h(e,t){const i=new r.diff_match_patch,[n,a,s]=function(e,t){const i=[],r=new Map,n=e=>t=>{if(""===t)return;const n=r.get(t)||String.fromCharCode(r.size);r.has(t)||(i.push(t),r.set(t,n)),e.push(n)},a=[];c(e,n(a));const s=[];return c(t,n(s)),[a.join(""),s.join(""),i]}(e,t),o=i.diff_main(n,a,!1);return i.diff_charsToLines_(o,s),i.diff_cleanupSemantic(o),o}const g=/([.!?] )/;function u(e){const t=e.split(g),i=[];for(let e=0;e<t.length;e++){const r=t[e],n=t[e+1];let a=r;g.test(r)||(g.test(n)?(a+=n[0],i.push(a),i.push(" ")):i.push(a))}return i}function m(e){const t=[];for(const i of e){const[e,r]=i;if(e===_.Operation.INSERT&&g.test(r)){const i=u(r);for(const r of i)t.push([e,r])}else t.push(i)}return t}const p=e=>{const t=function(e){let t=0,i=0;for(const r of e){const[e,n]=r;e===_.Operation.DELETE&&(t+=n.length),e!==_.Operation.DELETE&&e!==_.Operation.RETAIN||(i+=n.length)}return t/i}(e),i=[],r=e=>({groupID:e,diffs:[],showDeletions:t<.4});let n,a=-1,l=r(a);for(const t of e){switch((0,s.li)(t)){case _.Operation.INSERT:!n||(0,s.li)(n)!==_.Operation.DELETE&&(0,s.li)(n)!==_.Operation.INSERT?(a+=1,i.push(l),l=r(a),l.diffs.push(t)):l.diffs.push(t);break;case _.Operation.DELETE:case _.Operation.RETAIN:a+=1,l.diffs.length>0&&i.push(l),l=r(a),l.diffs.push(t)}n=t}return l.diffs.length>0&&i.push(l),(0,o.zG)(i,v,f,w)};function v(e){return e.map((e=>{const t=e.diffs.every((([e])=>e===_.Operation.DELETE));return{...e,showDeletions:t||e.showDeletions}}))}function f(e){return e.map((e=>{const{diffs:t,showDeletions:i}=e;if(2!==t.length||!i)return e;const[r,n]=t,[a,s]=r,[o,l]=n,d=a===_.Operation.DELETE&&o===_.Operation.INSERT&&s.toLocaleUpperCase()===l;return{...e,showDeletions:!d&&i}}))}function w(e){return e.map((e=>{const{diffs:t,showDeletions:i}=e;if(2!==t.length||!i)return e;const[r,n]=t,[a,s]=r,[o,l]=n,d=a===_.Operation.DELETE&&o===_.Operation.INSERT&&s.length===l.length;return{...e,showDeletions:!d&&i}}))}const S=(e,t)=>{const i=new r.diff_match_patch,n=i.patch_make(t),[a]=i.patch_apply(n,e);return a};var _;!function(e){let t;e.getDiff=(t,i)=>(0,o.zG)(n.tryCatch((()=>{if(t===i)return""===t?[]:[[e.Operation.RETAIN,t]];return m(h(t,i))}),n.toError),n.chain((0,o.ls)(a.nI,n.fromOption((()=>new Error("Diff is empty")))))),function(e){e[e.DELETE=-1]="DELETE",e[e.RETAIN=0]="RETAIN",e[e.INSERT=1]="INSERT"}(t=e.Operation||(e.Operation={})),e.matchOperation=function({onInsert:e,onDelete:i,onRetain:r}){return n=>{const a=(0,s.li)(n);switch(a){case t.INSERT:return e((0,s.Yg)(n));case t.DELETE:return i((0,s.Yg)(n));case t.RETAIN:return r((0,s.Yg)(n));default:(0,l.vE)(a)}}}}(_||(_={}))},3402:(e,t,i)=>{function r(e){return"selection"===e.kind}function n(e){return"signaling"===e.kind}i.d(t,{ZR:()=>a,iu:()=>r,jz:()=>n});const a=-1},61469:(e,t,i)=>{if(i.d(t,{PF:()=>u,TY:()=>d,_V:()=>g,eg:()=>h,f:()=>m,yG:()=>l,yj:()=>c}),3075==i.j)var r=i(65647);if(3075==i.j)var n=i(60165);if(3075==i.j)var a=i(68259);if(3075==i.j)var s=i(70874);if(3075==i.j)var o=i(58454);var l,d,c;function h(e){return(0,o.uz)(e)?l.view:(0,o.lW)(e)?l.history:(0,o.e$)(e)?l.noEditAccess:l.edit}function g(e){return s.S.hz4.pipe((0,r.U)((()=>h(e))),(0,n.x)(((e,t)=>e===t)))}function u(e,t){return e?d.ownDoc:t?d.noEditAccessDoc:d.sharedDoc}function m(e,t,i,r){if(e!==l.edit)return c.read;switch(t){case d.ownDoc:return c.write;case d.noEditAccessDoc:return c.read;case d.sharedDoc:return function(e,t,i){const r=!t&&!i;if(e!==l.edit||r)return c.read;return c.write}(e,i,r);default:return(0,a.L0)(t)}}!function(e){e.view="view",e.noEditAccess="noEditAccess",e.history="history",e.edit="edit"}(l||(l={})),function(e){e[e.ownDoc=0]="ownDoc",e[e.sharedDoc=1]="sharedDoc",e[e.noEditAccessDoc=2]="noEditAccessDoc"}(d||(d={})),function(e){e.read="read",e.write="write"}(c||(c={}))},58454:(e,t,i)=>{if(i.d(t,{LJ:()=>v,Nd:()=>o,Ov:()=>p,TW:()=>_,Ur:()=>l,Xs:()=>b,e$:()=>w,eg:()=>S,fN:()=>h,k6:()=>u,kh:()=>c,lW:()=>f,lz:()=>g,qg:()=>s,uj:()=>a,uz:()=>m}),3075==i.j)var r=i(73104);var n=i(91901);function a(e){const t=(0,r.Cq)(e.querySelector(n.XG),"text buffer iframe");return(0,r.Cq)(t.nodeType===Node.ELEMENT_NODE&&"IFRAME"===t.tagName?t.contentDocument:void 0,"text buffer iframe document")}function s(e){const t=o(e);return{width:t?t.offsetWidth-t.clientWidth:0,height:t?t.offsetHeight-t.clientHeight:0}}function o(e){return e.querySelector(n.Wp)}function l(e,t,i){return t?function(e,t){if(t&&d(t))return t;const i=e.querySelectorAll(n.Qy);for(const e of i)if(d(e))return e;return null}(e,i):e.querySelector(n.Qy)}const d=e=>e.checkVisibility?e.checkVisibility():e.parentElement&&"none"!==e.parentElement.style.display;function c(e){return e.querySelectorAll(n.gH)}function h(e){return e.querySelector(n.gH)}function g(e){return Boolean(e.querySelector(n.gH))}function u(e){let t=e.querySelector(n.os);return t||(t=document.querySelector(n.gH)),t?t.getBoundingClientRect():null}const m=e=>!!e.querySelector(n.Lq);function p(e){return e.querySelector(n.$x)}function v(e){return null==e?void 0:e.querySelector(n.y1)}function f(e){const t=e.querySelector(n.f);return!!t&&t.offsetHeight>0}function w(e){return!!e.querySelector(`${n.jW}, ${n.F8}`)}function S(){const e=document.querySelector(n.d0),t=(null==e?void 0:e.classList.contains(n.uj))?"edit":void 0,i=(null==e?void 0:e.classList.contains(n._m))?"suggesting":void 0;return t||i||"other"}function _(e){return e.querySelector(n.QR)}function b(e){return e.querySelector(n.ij)}},91901:(e,t,i)=>{i.d(t,{$x:()=>s,F8:()=>p,Go:()=>n,Kt:()=>b,Lq:()=>d,QR:()=>B,Qy:()=>f,Vk:()=>y,Wp:()=>r,XG:()=>a,_m:()=>g,d0:()=>c,f:()=>l,gH:()=>v,gL:()=>k,ij:()=>x,j5:()=>_,jW:()=>m,l$:()=>u,lO:()=>R,os:()=>S,rx:()=>C,uj:()=>h,y1:()=>o,yw:()=>w});const r=".kix-appview-editor",n=".docos-input",a=".docs-texteventtarget-iframe",s=".kix-cursor",o=".kix-cursor-caret",l="#docs-revisions-sidebar",d='#docs-toolbar-mode-switcher[aria-label="Viewing mode"]',c="#docs-toolbar-mode-switcher",h="edit-mode",g="suggest-mode",u="titlebar-mode-indicator-container",m="#titlebar-mode-indicator-container .titlebar-request-access-button",p="#titlebar-mode-indicator-container .kix-titlebar-request-access-button",v="canvas.kix-canvas-tile-content:not(.docs-ui-unprintable *)",f=".kix-rotatingtilemanager:not(.docs-ui-unprintable *)",w=".kix-page-paginated",S=".kix-page-paginated.canvas-first-page",_=".docs-horizontal-ruler",b=".docs-vertical-ruler",y="#fontSizeSelect input",k=".docs-ruler-background",C=".docs-ruler-background-inner",R=".docs-ruler-indent-first-line",x=".modal-dialog.docs-dialog .fatal-error-message",B='#docs-titlebar-share-client-button div[role="button"]'},94098:(e,t,i)=>{i.d(t,{$O:()=>r,Mx:()=>n,RO:()=>a,vW:()=>s});const r=String.fromCharCode(16),n=String.fromCharCode(17),a=String.fromCharCode(18),s=String.fromCharCode(28)},53262:(e,t,i)=>{i.d(t,{b:()=>o});var r=i(82823),n=i(25770),a=i(34854),s=i(52979);class o{constructor(e){this._textObserver=e,this._mapChangedAtom=n.h.create([0,[]]),this._sub=new r.w,this.highlightsFilterFactory=()=>n.h.combine((0,a.u)(),this._mapChangedAtom,((e,t)=>{const i=this._textObserver.getCurrentTextMap();return{filter:t=>e.filter(t)&&(null!==i.getFragmentAtOffset(t.start)||null!==i.getFragmentAtOffset(t.end)||null!==i.getFragmentAtOffset(t.end-1)),type:s.qH.ChangeType.preserve}})),this._sub.add(this._textObserver.textMapChanged.subscribe((e=>{this._mapChangedAtom.modify((([t,i])=>[t+1,e]))})))}dispose(){this._sub.unsubscribe()}}},9356:(e,t,i)=>{function r(e){return e}function n(e){return e}i.d(t,{Gk:()=>n,Ly:()=>r,Xo:()=>a,bn:()=>g,pl:()=>l});class a{constructor(e){const t=function(e){const{fullText:t,nonTextEntities:i,textSelectionRanges:r,deleteSuggestionRanges:n}=e,a=new Set;let l=t;for(const e of i.inline_image.startsAt)l=l.slice(0,e)+o+l.slice(e+1);for(const e of i.horizontal_rule.startsAt)a.add(e),l=l.slice(0,e)+" "+l.slice(e+1);""===t[0]&&a.add(0);t.replace(s,((e,t)=>(a.add(t),"")));for(const e of function*(e){const t=String.fromCodePoint(60419),i=String.fromCodePoint(60418);for(const r of h(e,t,i))yield r}(t))a.add(e);for(const e of function*(e){for(const t of h(e,d,c))e[t]!==d&&(yield t)}(t))a.add(e);const g=null==r?void 0:r.map((e=>({start:e.start,end:e.end+1})));if(n)for(const{start:e,end:t}of n)for(let i=e;i<t;i++)a.add(i);const u=l.indexOf("",1),m=u>0?l.slice(0,u):l,p=m.length-1;"\n"===m[p]&&a.add(p);return{checkableText:m.split("").filter(((e,t)=>!a.has(t))).join(""),cleanedFullText:l,removedIndices:a,cleanedTextSelectionRanges:g}}(e);this._text=t.checkableText,this._fullText=e.fullText,this._linkInfoList=e.linkInfoList,this._cleanedFullText=t.cleanedFullText,this._ignoredIndices=t.removedIndices,this._textSelectionRanges=t.cleanedTextSelectionRanges}get checkableText(){return this._text}get fullText(){return this._fullText}get cleanedFullText(){return this._cleanedFullText}get linkInfoList(){return this._linkInfoList}get textSelectionRanges(){return this._textSelectionRanges}indexIsIgnored(e){return!!this._ignoredIndices.has(e)}getFullTextIndex(e){let t=-1,i=-1;for(;i<e;)t++,this._ignoredIndices.has(t)||i++;return t}getCheckableTextIndex(e){let t=0,i=0;for(;t<e;)this._ignoredIndices.has(t)||i++,t++;return i}}const s=new RegExp(`${String.fromCodePoint(61439)}|${String.fromCodePoint(61438)}`,"g"),o=String.fromCharCode(160),l=26,d=String.fromCodePoint(l),c=String.fromCodePoint(30);function*h(e,t,i){let r=0;for(;;){const n=e.indexOf(t,r);if(n<r)return;const a=e.indexOf(i,n);for(let e=n;e<=a;e++)yield e;r=a+1}}function g(e){return!!(null==e?void 0:e.includes(d))&&!(null==e?void 0:e.includes(`${d}${c}`))}},20118:(e,t,i)=>{i.d(t,{U3:()=>r,dk:()=>a,x:()=>n});const r=["rgba(17,85,204,1)","#1155cc"],n=1,a=-1},96642:(e,t,i)=>{i.d(t,{M:()=>r});class r{constructor(e,t){this._page=e,this._parsedFragment=t,this.startOffset=t.textRange.start,this.endOffset=t.textRange.end}getPage(){return this._page}}},4853:(e,t,i)=>{i.d(t,{I:()=>s});var r=i(20118),n=i(51739),a=i(96642);class s extends a.M{constructor(e,t,i){super(e,t),this._page=e,this._renderGeometry=i}getFragmentInnerRect(e,t){return this._renderGeometry.getTextFragmentDimensions(this._parsedFragment.fragment,e,t)}getLeftBorder(){return this.getFragmentInnerRect(0,0)}getRightBorder(){return this.getFragmentInnerRect(this.endOffset-this.startOffset,this.endOffset-this.startOffset)}getStyle(){const{style:e="none",color:t="none",underlineColor:i="none",strikeThroughColor:a="none",text:s}=this._parsedFragment.fragment,o=r.U3.includes(t)&&r.U3.includes(i),l=(0,n.cX)(s);return{style:e,isLink:o,isSmartChips:this._parsedFragment.fragment.special,canBeFootnote:l,color:t,underlineColor:i,strikeThroughColor:a}}getParsedFragment(){return this._parsedFragment}}},51739:(e,t,i)=>{i.d(t,{cX:()=>v,ds:()=>l,kn:()=>d,lO:()=>m,nn:()=>p,qH:()=>o,tZ:()=>f});var r=i(4129);const n=/[ \n\r\t\v]/,a=/[^\S\f\n]/,s=[..." \r\t\v\f"];function o(e){return 1===e.length&&n.test(e)}function l(e){return 1===e.length&&a.test(e)}function d(e){return s.includes(e)}const c=/^(\d{1,4}\.)*\d{1,4}$/,h=/^([a-zA-Z])\1{0,3}$/,g=/^m{0,4}(cm|cd|d?c{0,3})(xc|xl|l?x{0,3})(ix|iv|v?i{0,3})$/,u=/^M{0,4}(CM|CD|D?C{0,3})(XC|XL|L?X{0,3})(IX|IV|V?I{0,3})$/;function m(e){if(0===e.length)return!1;if(1===e.length)return!0;let t;if(e.startsWith("(")&&e.endsWith(")"))t=e.substring(1,e.length-1);else{if(!e.endsWith(".")&&!e.endsWith(")"))return!1;t=e.substring(0,e.length-1)}return t.endsWith(".")&&(t=t.substring(0,t.length-1)),c.test(t)||h.test(t)||g.test(t)||u.test(t)}function p(e){return r.v1.test(e)}function v(e){return r.ZS.test(e)}function f(e){return r.Dn.includes(e)}},4129:(e,t,i)=>{if(i.d(t,{Dn:()=>s,Ox:()=>c,ZS:()=>d,o2:()=>a,q4:()=>h,ui:()=>o,v1:()=>l}),3075==i.j)var r=i(94098);var n=i(9356);const a=String.fromCodePoint(59657),s=[59653,59654,59657,60417,60416,59656,n.pl].map((e=>String.fromCodePoint(e))).join(""),o=String.fromCodePoint(59649),l=/^\d+$/,d=/^\d+$/;function c(e){return e.toUpperCase()===e&&e.toLowerCase()!==e}function h(e){return e.includes(r.$O)}},99460:(e,t,i)=>{i.d(t,{z:()=>u});var r=i(90023),n=i(49231),a=i(7399),s=i(65647),o=i(65882),l=i(34859),d=i(90049),c=i(83780),h=i(58303),g=i(43818);const u=({children:e,animationDurationMs:t,...i})=>{const{onMount:u,rect:m}=a.P.useRectWatcher(),p=m.pipe(s.U((0,r.ls)(h.UI((e=>e.height)),h.fS((()=>0))))),v=o.aj([e,m]).pipe(l.h("hidden")),f=d.T(v,v.pipe(c.g(t),l.h("visible")));return n.createElement(g.F.div,{...i,style:{height:p,overflow:f,transitionProperty:"height",transitionDuration:`${t}ms`}},n.createElement(g.F.div,{mount:u},e))}},44637:(e,t,i)=>{i.d(t,{J:()=>c});var r=i(90023),n=i(49231),a=i(7399),s=i(80724),o=i(78488),l=i(99627),d=i(14482);const c=({onChange:e,labelId:t,className:i,checkboxClassName:c,labelClassName:h,checked:g,children:u,disabled:m,useDS:p,dataGrammarlyPart:v="ui-kit-checkbox",tabIndex:f=0,onMount:w=r.Q1})=>{const[S,_]=n.useState(null!=g&&g);n.useEffect((()=>{_(Boolean(g))}),[g]);const b=t=>{t.preventDefault(),t.stopPropagation(),_(!S),null==e||e(!S)},{ref:y,onMount:k}=a.P.useElWatcher();return n.useEffect((()=>{const e=y.pipe(s.oA,o.b(w)).subscribe();return()=>e.unsubscribe()}),[]),n.createElement("div",{"data-grammarly-part":v,...(0,l.Sh)(d.checkboxContainer,i)},n.createElement("div",{...(0,l.Sh)(d.checkbox,c,S?d.checkboxChecked:null,p?d.checkboxDS:null),role:"checkbox","aria-checked":S,tabIndex:f,"aria-labelledby":t,onKeyDown:e=>{" "===e.key&&b(e)},onClick:m?r.Q1:b,ref:k},S?n.createElement("div",{className:d.checkboxCheckmark}):null),n.createElement("label",{id:t,onClick:b,className:h},u))}},96130:(e,t,i)=>{i.d(t,{E:()=>s});var r=i(49231),n=i(99627),a=i(17345);const s=({options:e,onChange:t=(()=>null),ariaLabel:i,className:s})=>{const o=[],[l,d]=r.useState(null);r.useEffect((()=>{var i;null!==l&&(null===(i=o[l])||void 0===i||i.focus()),t(null!==l?e[l].value:null)}),[l]);const c=null!==l?e[l]:null;return r.createElement("div",{"data-grammarly-part":"ui-kit-radio-group",className:s},r.createElement("div",{className:a.radioGroup,role:"radiogroup","aria-label":i,onKeyDown:t=>{if(" "!==t.key||c){if("ArrowRight"===t.key||"ArrowDown"===t.key){t.preventDefault(),t.stopPropagation();d(((l||0)+1)%e.length)}else if("ArrowLeft"===t.key||"ArrowUp"===t.key){t.preventDefault(),t.stopPropagation();const i=(l||0)-1;d(i<0?e.length-1:i)}}else t.preventDefault(),t.stopPropagation(),d(0)}},e.map(((e,t)=>{const i=(null==c?void 0:c.value)===e.value,s=0===t;return r.createElement("div",{key:e.value,...(0,n.Sh)(a.radioGroupOption,i?a.radioGroupOptionSelected:null),role:"radio",tabIndex:i||s&&!c?0:-1,"aria-checked":i,onClick:e=>{e.preventDefault(),e.stopPropagation(),d(t)},ref:e=>o.push(e)},e.render())}))))}},21136:(e,t,i)=>{i.d(t,{z:()=>g});var r=i(49231),n=i(64151);const a=({children:e,style:t,dataGrammarlyPart:i="ui-kit-iframe",...a})=>{const[s,o]=r.useState(null),l=r.useCallback((e=>{var t,i;let r=null;"contentDocument"in e.target&&(r=null!==(i=null===(t=e.target.contentDocument)||void 0===t?void 0:t.body)&&void 0!==i?i:null),o(r),r&&(r.style.margin="0",r.style.height="100vh",r.style.overflowY="hidden")}),[]);return r.createElement("iframe",{...a,style:{border:"none",...t},onLoad:l,srcDoc:"<html><body></body></html>","data-grammarly-part":i},s&&(0,n.createPortal)(e,s))};var s=i(1208),o=i(70632),l=i.n(o),d=i(6986),c=i(4798);const h=({placeholder:e,ariaLabel:t,onChange:i})=>{const[n,a]=r.useState("");return r.useEffect((()=>{i(n)}),[n]),r.createElement(r.Fragment,null,r.createElement(s.b,null,l().__css),r.createElement("div",{role:"textbox",className:l().textBox,contentEditable:!0,onInput:e=>{a(e.target.innerText)},"data-placeholder":e,"aria-placeholder":e,"aria-label":t}))},g=({placeholder:e,onChange:t,ariaLabel:i,iframeTitle:n,className:s})=>(0,d.OB)().experimentClient.isGateEnabled(c.K.CentralizeStopEventPropagation)?r.createElement("div",{className:s,style:{width:"100%",height:"128px",maxHeight:"inherit"}},r.createElement(h,{onChange:t,ariaLabel:i,placeholder:e})):r.createElement(a,{dataGrammarlyPart:"ui-kit-textbox",className:s,style:{width:"100%",height:"100%"},title:n},r.createElement(h,{onChange:t,ariaLabel:i,placeholder:e}))},78225:(e,t,i)=>{i.d(t,{V:()=>s});var r=i(49231),n=i(63039),a=i(29357);const s=e=>e.isEnabled?r.createElement(a.T,{type:"mini",size:26,className:n.feedbackFormLogoLine}):null},80882:(e,t,i)=>{i.d(t,{b:()=>k});var r=i(49231),n=i(99627),a=i(12990),s=i(63039);const o=({fixSubmitButtonOverflowBottomPadding:e,className:t,...i})=>r.createElement(r.Fragment,null,r.createElement(a.z,{...i,className:null!=t?t:s.feedbackFormSubmitButton},i.children),r.createElement(l,{isEnabled:e})),l=e=>e.isEnabled?r.createElement("div",{className:s.feedbackFormSubmitButtonFixOverflowBottomPadding},r.createElement("div",{className:s.feedbackFormSubmitButtonFixOverflowBottomPaddingChild})):null,d=e=>r.createElement("div",{"data-grammarly-part":"surveys-feedback-form-thank-you",...(0,n.Sh)(s.feedbackFormContainer,s.feedbackFormContainerAlignCenter)},r.createElement("div",{className:s.feedbackFormSuccessMessageTextContainer},r.createElement("div",{className:s.feedbackFormSuccessMessageIcon}),r.createElement("div",{className:s.feedbackFormSuccessMessageTitle},"Thank you!"),r.createElement("div",{className:s.feedbackFormSuccessMessageSubtitle},"Your feedback helps us improve.")),r.createElement(o,{type:"button",kind:"success",onClick:e.onClose},"Done"));var c=i(21136),h=i(44637);const g=e=>e.domain?r.createElement(r.Fragment,null,e.withHelpText&&r.createElement("div",{className:s.feedbackFormShareDomainTitle},"Help improve Grammarly by sharing the domain you’re on:"),r.createElement(h.J,{checked:e.checked,labelId:"feedback-form-share-domain-checkbox",onChange:e.onChange,className:s.feedbackFormShareDomainCheckbox},"Include the domain ",r.createElement("b",null,e.domain)," with my feedback")):null;var u=i(78225);const m=e=>{var t;if(!e.isEnabled)return null;const i=null!==(t=e.title)&&void 0!==t?t:r.createElement("span",null,"How do you like ",r.createElement("br",null)," Grammarly?");return r.createElement("h3",{...(0,n.Sh)(s.feedbackFormTitle,e.isCompact&&s.compact)},i)};var p=i(79992),v=i(96130),f=i(29221),w=i(45321);const S=e=>{const t=[f.B.bad,f.B.ok,f.B.good];return e.isEnabled?r.createElement(r.Fragment,null,r.createElement(v.E,{ariaLabel:"Feedback Score",options:t.map((e=>({value:e,render:()=>r.createElement("div",{className:w.feedbackFormOption},r.createElement("div",{...(0,n.Sh)(w.feedbackFormOptionIcon,_(e))}),r.createElement("div",null,function(e){switch(e){case f.B.bad:return"I dislike it";case f.B.ok:return"It’s OK";case f.B.good:return"I like it";default:(0,p.vE)(e)}}(e)))}))),onChange:e.onChange,...(0,n.Sh)(s.feedbackFormScore,e.compactDisplay&&s.compact)}),!e.hideTextBoxTitle&&r.createElement("div",{className:s.feedbackFormTextBoxTitle},"Anything we can improve?")):null};function _(e){switch(e){case f.B.bad:return w.feedbackFormOptionIconDisheartening;case f.B.ok:return w.feedbackFormOptionIconNeutral;case f.B.good:return w.feedbackFormOptionIconSmiling;default:(0,p.vE)(e)}}const b=e=>{var t,i,a,l;const[d,h]=r.useState(null),[p,v]=r.useState(""),[f,w]=r.useState(null!==(t=e.domainSharedByDefault)&&void 0!==t&&t);return r.createElement("form",{"data-grammarly-part":"surveys-feedback-form-fields",...(0,n.Sh)(s.feedbackFormContainer,"center"===e.align&&s.feedbackFormContainerAlignCenter)},r.createElement("div",{className:s.feedbackFormFields},r.createElement(u.V,{isEnabled:!e.hideLogo}),r.createElement(m,{isEnabled:!e.hideTitle,title:e.title,isCompact:null!==(i=e.compactDisplay)&&void 0!==i&&i}),r.createElement(S,{isEnabled:e.withScore,compactDisplay:e.compactDisplay,hideTextBoxTitle:e.hideTextBoxTitle,onChange:h}),r.createElement(c.z,{onChange:v,placeholder:null!==(a=e.placeholderText)&&void 0!==a?a:"Your thoughts here",ariaLabel:"Feedback Text",iframeTitle:"Feedback text field",...(0,n.Sh)(s.feedbackFormTextBox,e.compactDisplay&&s.compact)}),r.createElement(g,{domain:e.domain,checked:e.domainSharedByDefault,withHelpText:!e.hideDomainHelpText,onChange:w})),r.createElement(o,{type:"submit",kind:null!==(l=e.submitButtonKind)&&void 0!==l?l:"success",disabled:e.withScore?!d:!p,fixSubmitButtonOverflowBottomPadding:e.fixSubmitButtonOverflowBottomPadding,onClick:t=>{t.preventDefault();const i=f?e.domain:void 0;e.withScore&&d?e.onSubmit({score:d,text:p,domain:i}):!e.withScore&&p&&e.onSubmit({text:p,domain:i})}},"Submit"))};var y=i(84602);const k=({hideLogo:e=!1,align:t="center",fixSubmitButtonOverflowBottomPadding:i=!1,showPostSubmitScreen:n=!0,...a})=>{const[s,o]=r.useState(!1),l=s&&n;return r.createElement("div",{style:a.style,"data-grammarly-part":"surveys-feedback-form",role:"region","aria-label":"Provide feedback","aria-live":"polite"},l?r.createElement(d,{fixSubmitButtonOverflowBottomPadding:i,onClose:a.onClose}):r.createElement(b,{...a,hideLogo:e,align:t,fixSubmitButtonOverflowBottomPadding:i,onSubmit:e=>{a.withScore?((0,y.n8)(e),a.onSubmit(e)):((0,y.TY)(e),a.onSubmit(e)),o(!0)}}))}},29221:(e,t,i)=>{var r;i.d(t,{B:()=>r}),function(e){e.bad="bad",e.ok="ok",e.good="good"}(r||(r={}))},84602:(e,t,i)=>{function r(e){return"score"in e}function n(e){if(!r(e))throw new Error("Received unexpected feedback form data without score")}function a(e){if(r(e))throw new Error("Received unexpected feedback form data with score")}i.d(t,{TY:()=>a,dK:()=>r,n8:()=>n})},40596:(e,t,i)=>{i.d(t,{JB:()=>a,MY:()=>n,z6:()=>r});class r extends Map{constructor(e){super(),this.maxSize=e}set(e,t){if(this.has(e))this.delete(e);else if(this.size>=this.maxSize){const e=this.keys().next().value;this.delete(e)}return super.set(e,t),this}get(e){const t=super.get(e);return void 0!==t&&(this.delete(e),this.set(e,t)),t}}function n(e){let t=2166136261;for(let i=0;i<e.length;i++)t^=e.charCodeAt(i),t+=(t<<1)+(t<<4)+(t<<7)+(t<<8)+(t<<24);return(t>>>0).toString(16)}function a(e){try{return n(JSON.stringify(e))}catch(e){return console.error("Error occurred while hashing object:",e),""}}},94996:(e,t,i)=>{i.d(t,{Sz:()=>a,vQ:()=>n});var r=i(12518);async function n(e,t=self){if(function(e=self){var t,i;return!!(null===(i=null===(t=e.navigator)||void 0===t?void 0:t.clipboard)||void 0===i?void 0:i.writeText)}(t))return t.navigator.clipboard.writeText(e);throw new Error("Clipboard API not supported")}function a(e,t=self){return n(e,t).then((()=>r.right(void 0))).catch((e=>r.left(e instanceof Error?e:new Error(String(e)))))}},10393:(e,t,i)=>{function r(e,t=0){return(t<<5)-t+(0|e)|0}function n(e,t=0){let i=t;for(const t of e)i=r(t.charCodeAt(0),i);return i}i.d(t,{Wu:()=>n,k3:()=>r})},98544:(e,t,i)=>{var r=i(42663),n=i(2963)(r);n.push([e.id,"._z3YOv-textBox{font-family:Inter,sans-serif;font-style:normal;font-weight:normal;color:#0e101a;font-size:14px;line-height:21px;font-feature-settings:'ss03' on;background:#f9faff;border:1px solid #e7e9f5;box-sizing:border-box;border-radius:4px;padding:10px 8px;overflow-y:auto;cursor:text;width:100%;height:100%;}._z3YOv-textBox:empty:before{font-feature-settings:'ss03' on;font-family:Inter,sans-serif;font-style:normal;font-weight:normal;color:#6d758d;font-size:14px;line-height:21px;content:attr(data-placeholder)}",""]),n.locals={textBox:"_z3YOv-textBox"},e.exports=n},22610:e=>{e.exports={monetizationWrapper:"XLKBt",premiumIcon:"Mrvu1",monetizationTitle:"vLnAx",monetizationDividerDot:"_owGm"}},47252:e=>{e.exports={onboardingBanner:"M7dj3"}},97211:e=>{e.exports={sideline:"G2vdT",sidelineEmphasized:"tw3gA",sidelineWithSelectionSignal:"ikZS7",sidelineSignalBar:"Pdlcn",pulsingSideline:"SHHbX",pulsingSignalingSideline:"YQDXi","pulse-signaling":"mdD96",pulsingIdleSideline:"w6AcK","pulse-idle":"caBIF",pulsingSelectionSideline:"ETZAk","pulse-selection":"HP0j5",sidelineWithSignalBar:"gtUhG",sidelineSignalBarLoading:"ZhtAx",pulse:"PEPt4",sidelineSignalBarAttention:"xQocX",sidelineSignalBarAttentionUphook:"mjKDg",sidelineSignalBarEmphasized:"_mi1U",sidelineSignalBarHidden:"BNKg6",sidelineSignalBarSubdued:"n9hN9",sidelineArrow:"Ihuz1",sidelineArrowVisible:"gtlTF",sidelineArrowBottom:"PPzfY"}},26396:e=>{e.exports={sidelineParagraphHighlighter:"xCgoK",sidelineParagraphHighlighterActive:"Jjjhn",sidelinePositioner:"UPQQM",sidelineSelectionHighlight:"ra9fc"}},57116:e=>{e.exports={sidelineCard:"KetZV",sidelineCardHorizontalDivider:"d96oB",sidelineCardCustomPromptEntryPoint:"USGAc"}},7750:e=>{e.exports={sidelineCardButton:"qFbmx"}},62481:e=>{e.exports={sidelineCardCustomPrompt:"LfX1e",sidelineCardCustomPromptInput:"RoTP_",sidelineCardCustomPromptInputForm:"B0peX",sidelineCardCustomPromptInputField:"SLnHC",sidelineCardCustomPromptSuggestedResults:"o_ldN",sidelineCardCustomPromptSuggestedResultsSubtitle:"eezEJ",sidelineCardCustomPromptSuggestedResultsOption:"FmvTD"}},55804:e=>{e.exports={sidelineCardGrammarlyLogo:"e99eq"}},86255:e=>{e.exports={sidelineCardPopper:"m2vlI"}},23071:e=>{e.exports={revertibleRewriteDiff:"t8Lqn",revertibleRewriteDiffLabel:"sJCmZ",revertibleRewriteDiffButton:"XEa8T",revertibleRewriteDiffOutlineOnboarding:"ZDo7f",alternateStroke:"p2gID"}},47639:e=>{e.exports={svg:"n2czM",path:"jGWBV"}},84737:e=>{e.exports={sidelineCardRewrite:"SbBwe"}},96846:e=>{e.exports={sidelineCardRewriteDiff:"HQ1NZ",sidelineCardRewriteDiffBlurred:"etBs4",sidelineCardRewriteDiffRevertButton:"ss_Es",sidelineCardRewriteDiffPopoverWrapper:"b8bPK"}},69057:e=>{e.exports={scrollTopLimit:"PA1jn",scrollBottomLimit:"vhiR2",fadeInAnimation:"o53qS","left-to-right-fade-in":"OpP5u"}},64598:e=>{e.exports={moreButton:"rosQY"}},91100:e=>{e.exports={sidelineCardRewriteReadySignalBar:"zv_Ws",sidelineCardRewriteReadySignalBarAttention:"oimfv",sidelineCardRewriteReadySignalBarDefault:"GGpaV",sidelineCardRewriteReadyContent:"ANoVu",sidelineCardRewriteReadyContentWithTopScrollLimit:"M7jcz",sidelineCardRewriteReadyContentWithBottomScrollLimit:"SDH6l",sidelineCardRewriteReadyContentTitle:"JruGr",sidelineCardRewriteReadyContentTitleAttention:"ncGgB",sidelineCardRewriteReadyContentTitleDefault:"FKJEV",sidelineCardRewriteRegenerateButton:"As2d2","5rem":"DP1UN",sidelineCardRewriteCopyButtonCopyConfirmation:"oM9oh",fadeInOut:"uUL1Y"}},19337:e=>{e.exports={sidelineCardRewriteSuccess:"qCfRi",sidelineCardRewriteSuccessMainContentTitle:"KYYEg",sidelineCardRewriteSuccessGrammarlyLogo:"PWfBY"}},14482:e=>{e.exports={checkboxContainer:"Te37e",checkbox:"mFHkX",checkboxDS:"DdH2q",checkboxChecked:"JhHnz",checkboxCheckmark:"zShXt",spin:"tww6q"}},17345:e=>{e.exports={radioGroup:"KAzfW",radioGroupOption:"WkjDU",radioGroupOptionSelected:"onilo"}},63039:e=>{e.exports={feedbackFormContainer:"kjElf",feedbackFormContainerAlignCenter:"hkEx2",feedbackFormFields:"Ua5wJ",feedbackFormTitle:"GnQ_a",feedbackFormTextBoxTitle:"kWEW0",feedbackFormLogoLine:"osGQI",compact:"b7yYp",feedbackFormScore:"ZOSRK",feedbackFormTextBox:"l8New",feedbackFormShareDomainTitle:"Qbnj_",feedbackFormShareDomainCheckbox:"VBCx1",feedbackFormSubmitButton:"tYYGU",feedbackFormSubmitButtonFixOverflowBottomPadding:"Opd8X",feedbackFormSubmitButtonFixOverflowBottomPaddingChild:"QKLT7",feedbackFormSuccessMessageTextContainer:"ARBzt",feedbackFormSuccessMessageIcon:"kJIzg",feedbackFormSuccessMessageTitle:"iXQnf",feedbackFormSuccessMessageSubtitle:"Ydufo",spin:"Vv6WG"}},45321:e=>{e.exports={feedbackFormOption:"sp8vS",feedbackFormOptionIcon:"eH6DL",feedbackFormOptionIconDisheartening:"DhaWh",feedbackFormOptionIconNeutral:"BS_8d",feedbackFormOptionIconSmiling:"dUZNd",spin:"uouSO"}}}]);