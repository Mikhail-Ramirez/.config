(self.webpackChunk=self.webpackChunk||[]).push([[1824],{68290:(e,t,r)=>{r.r(t),r.d(t,{TouchTypistFeatureImpl:()=>vt,trackTooltipAppearingAndSkipping:()=>yt});var i=r(90023),s=r(82823),a=r(65647),n=r(70989),o=r(55446),c=r(34859),l=r(96030),p=r(58303),h=r(72106),u=r(49231),d=r(3728),g=r(90049),m=r(64965),_=r(60165),v=r(60841),y=r(20715),T=r(27628),b=r(16587),f=r(23729);const S=()=>u.createElement(b.k,{className:f.bubbleContainer},u.createElement("svg",{width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",className:f.bubble},u.createElement("path",{d:"M0 7.00023C0 3.13372 3.13344 0 7.00035 0C10.8673 0 14 3.13372 14 7.00023C14 10.3829 11.6017 13.2049 8.41204 13.8581C7.95631 13.9515 7.48418 14 7.00246 14H0V7.00023Z",fill:"#027E6F"}),u.createElement("path",{d:"M3.92422 7.57649L5.8528 9.50507L10.3528 5.00507",stroke:"white",strokeWidth:"1.25",className:f.checkmark})));var E=r(10859),k=r(68567),x=r(85215),w=r(33969),C=r(43818),R=r(99627),P=r(42743);const I=({label:e})=>u.createElement(b.k,{className:P.hotkeyHintTagContainer,bgColor:"background-base-default",borderColor:"base-default",borderRadius:1},u.createElement(w.x,{className:P.hotkeyHintTagLabel,as:"small",variant:"text-xsmall",weight:"semibold",color:"base-subdued"},u.createElement(C.F.div,null,e)));var A=r(69959),M=r(57935);const D=({show:e,children:t})=>{const[r,i]=u.useState(!1),[s,a]=u.useState(!1),n=(()=>{const e=u.useRef(!0);return u.useEffect((()=>{e.current=!1}),[]),e.current})();u.useEffect((()=>{if(n&&!e)return;let t;i(!0),e||(t=self.setTimeout((()=>i(!1)),300)),a(!e);const r=self.setTimeout((()=>a(e)),50);return()=>[t,r].forEach(clearTimeout)}),[e]);const o={opacity:s?1:0,transition:"opacity 250ms"};return r&&t?u.createElement("div",{style:o,"data-testid":"grammarly-touchtypist-fade-wrapper"},t):null};var L=r(16309),N=r(23861),O=r(73332),F=r(8775);const H=(0,r(49243).I)("color",(({title:e,titleId:t,desc:r,descId:i,...s})=>u.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none",viewBox:"0 0 16 16","aria-hidden":"true","data-icon":"InterfaceLogout",stroke:"transparent","aria-labelledby":t,"aria-describedby":i,...s},r?u.createElement("desc",{id:i},r):null,e?u.createElement("title",{id:t},e):null,u.createElement("path",{stroke:"#646B81",strokeLinecap:"round",d:"M8 2v6.316m2.139-5.239c1.975.863 3.361 2.884 3.361 5.239C13.5 11.456 11.038 14 8 14s-5.5-2.545-5.5-5.684c0-2.355 1.386-4.376 3.361-5.239"}))));var Q=r(48667),U=r(95660);const B=({keyName:e})=>u.createElement(w.x,{className:U.keyIcon,as:"span",variant:"text-xsmall",color:"base-subdued"},e),V=({className:e,quickFixKey:t,onQuickSettingsMenuUnmount:r,onQuickSettingsButtonClick:i,onQuickSettingsShown:s,onChangeQuickFixKeyTextboxFocus:a,onChangeQuickFixKeyTextboxBlur:n,onTurnOffQuickFixClick:o})=>{const[c,l]=u.useState(!1),p=u.useRef(null);u.useEffect((()=>r),[]);const h=u.useCallback((()=>{l(!c),i(c)}),[c,i]),d=u.useCallback((e=>{e&&s()}),[s]),g=u.useCallback((e=>{e&&e.addEventListener("focus",a,!0)}),[]);return u.createElement(b.k,{className:U.quickSettingsMenuWrapper},u.createElement(L.h,{...(0,R.Sh)(e,U.quickSettingsMenuButton),size:"small",variant:"tertiary",icon:N.D,accessibilityLabel:"Quick Settings",onClick:h}),c&&u.createElement(b.k,{ref:d,direction:"column",bgColor:"background-base-subdued",borderColor:"base-subdued",borderRadius:1,elevation:"low",className:U.quickSettingsMenu},u.createElement(b.k,{className:U.quickSettingsMenuChangeQuickFixKeySection,direction:"column",gap:2},u.createElement(w.x,{as:"p",variant:"text-xsmall",color:"base-subdued",onClick:()=>{var e;return null===(e=p.current)||void 0===e?void 0:e.focus()}},"Change quick fix key"),u.createElement(C.F.Fragment,null,t.view((e=>u.createElement(O.n,{ref:(0,Q.l)([p,g]),value:e,labelDisplay:"hidden",label:"Change quick fix key",placeholder:"Enter shortcut",onBlur:n})))),u.createElement(w.x,{as:"p",variant:"text-xsmall",color:"base-subdued"},"Try ",u.createElement(B,{keyName:"⌘"})," ",u.createElement(B,{keyName:"/"})," or ",u.createElement(B,{keyName:"->"}))),u.createElement(b.k,{className:U.quickSettingsMenuTurnOffQuickFixSection},u.createElement(F.z,{className:U.quickSettingsMenuTurnOffQuickFixButton,variant:"tertiary",iconStart:H,width:"full",text:"Turn off quick fix",onClick:o}))))},q=({label:e,errorsCount:t,softOnboardingState:r=A.kH.Off,caretPosition:i,quickFixKey:s,onQuickSettingsMenuUnmount:a,onQuickSettingsButtonClick:n,onQuickSettingsShown:o,onChangeQuickFixKeyTextboxFocus:c,onChangeQuickFixKeyTextboxBlur:l,onTurnOffQuickFixClick:p})=>{const h=u.useRef(null),[d,g]=u.useState(0),[m,_]=u.useState(!1),[v,y]=u.useState(!1);u.useEffect((()=>{const e=new ResizeObserver((e=>{for(const t of e)t.target===h.current&&g(t.contentRect.width)}));return h.current&&e.observe(h.current),()=>{e.disconnect()}}),[]),u.useEffect((()=>{r===A.kH.Transitional&&E.timer(M.m9(4)).subscribe((()=>y(!0)))}),[]);const T=u.createElement(b.k,{ref:h,className:U.hotkeyHintTagWrapper,onMouseEnter:()=>_(!0),onMouseLeave:()=>_(!1)},u.createElement(I,{label:e})),f=u.createElement(b.k,{className:U.hotkeyHintTagPlaceholder,style:{width:d}}),S=u.createElement(C.F.Fragment,null,t.view((e=>`${e} error${1===e?"":"s"}`))),P=u.createElement(b.k,{className:U.expandedHotkeyHint,bgColor:"background-base-subdued",borderRadius:2,align:"center",onMouseEnter:()=>_(!0),onMouseLeave:()=>_(!1),"data-testid":"expanded-hotkey-hint"},u.createElement(k.J,{className:U.grammarlyLogo,size:"small",icon:x.p,accessibilityLabel:"Grammarly logo"}),u.createElement(w.x,{className:U.expandedHotkeyHintText,as:"p",variant:"text-xsmall",color:"base-subdued"},"To fix ",S,", press"),f,u.createElement(V,{className:U.quickSettingsButton,quickFixKey:s,onQuickSettingsMenuUnmount:a,onQuickSettingsButtonClick:n,onQuickSettingsShown:o,onChangeQuickFixKeyTextboxFocus:c,onChangeQuickFixKeyTextboxBlur:l,onTurnOffQuickFixClick:p})),L=u.createElement(b.k,{...(0,R.Sh)(U.expandedHotkeyHint,U.leftAligned),bgColor:"background-base-subdued",borderRadius:2,align:"center",onMouseEnter:()=>_(!0),onMouseLeave:()=>_(!1),"data-testid":"expanded-hotkey-hint"},u.createElement(k.J,{className:U.grammarlyLogo,size:"small",icon:x.p,accessibilityLabel:"Grammarly logo"}),u.createElement(w.x,{className:U.expandedHotkeyHintText,as:"p",variant:"text-xsmall",color:"base-subdued"},"Press"),f,u.createElement(w.x,{className:U.expandedHotkeyHintText,as:"p",variant:"text-xsmall",color:"base-subdued"},"to fix ",S),u.createElement(V,{className:U.quickSettingsButton,quickFixKey:s,onQuickSettingsMenuUnmount:a,onQuickSettingsButtonClick:n,onQuickSettingsShown:o,onChangeQuickFixKeyTextboxFocus:c,onChangeQuickFixKeyTextboxBlur:l,onTurnOffQuickFixClick:p})),{bottom:N,right:O}=i,F=N+6,H=O-d/2,Q=H<160?L:P,B=r===A.kH.Initial||r===A.kH.Transitional&&!v;return u.createElement(b.k,{className:U.hotkeyHintWrapper,style:{top:F,left:H}},T,u.createElement(D,{show:B||m},Q))};var G=r(82675);const Y=()=>u.createElement(b.k,{className:G.dotsContainer,"data-testid":"loading-dots"},u.createElement("div",{className:G.dot}),u.createElement("div",{className:G.dot}),u.createElement("div",{className:G.dot}));var K,W,z,$=r(21768),j=r(19360),Z=r(8748),X=r(78488),J=r(68259),ee=r(25770),te=r(88359);!function(e){function t(e,t){const r=e.ops[0];return r&&te.s.isRetain(r)?{...e,ops:[{retain:t+r.retain},...e.ops.slice(1)]}:e}e.offsetDelta=t,e.rebaseByAppliedPreview=function(e){const r=function(e){const t=e.end-e.begin;return e.replacement.length-t}(e);return 0===r?i.yR:i=>i.begin>=e.end?{...i,delta:t(i.delta,r),previewDelta:t(i.previewDelta,r)}:i},e.normalize=function(e){return r=>({...r,begin:e+r.begin,end:e+r.end,delta:t(r.delta,e),previewDelta:t(r.previewDelta,e),highlight:{s:e+r.highlight.s,e:e+r.highlight.e},reverseDelta:t(r.reverseDelta,e)})}}(K||(K={})),function(e){function t(e){return(0,i.ls)((t=>e.find((e=>e.revertId===t.revertId))),p.ij)}e.normalize=function(e){return t=>({...t,highlightBegin:e+t.highlightBegin,highlightEnd:e+t.highlightEnd})},e.findCorrespondingPreview=t,e.hasCorrespondingPreview=function(e){return(0,i.ls)(t(e),p.pC)}}(W||(W={})),function(e){e.getRevertsRange=function(e){return 0===e.length?null:(e.sort(((e,t)=>e.highlightBegin-t.highlightBegin)),{start:e[0].highlightBegin,end:e[e.length-1].highlightEnd})}}(z||(z={}));var re,ie=r(90805),se=r(38508),ae=r(70932),ne=r(32066),oe=r(28710);!function(e){e.IDLE="idle",e.LOADING="loading",e.REPLACING="replacing",e.READY="ready",e.SUCCESS="success"}(re||(re={}));const ce="no_output",le={type:ce},pe={current:{previews:[],reverts:[],replacementInfo:p.YP},applied:{reverts:[]}},he={state:re.IDLE,context:pe};class ue{constructor(e={state:he,touchTypistTelemetryService:ne.w}){this._params=e,this._subs=new s.w,this._state=ee.h.create(this._params.state),this._newParagraphsSinceRevert=new WeakMap,this._logger=ae.Y.create("TouchTypistStateManagerImpl"),this.state=this._state.view(),this._interrupted=e=>t=>{const{state:r,context:i}=t,s=le;return r!==re.IDLE?(this._logger.debug(`TouchTypistStateManager state reset to idle from ${r}, reason:`,e),[{type:oe._.INTERRUPTED},{state:re.IDLE,context:{current:{previews:[],reverts:[],replacementInfo:p.YP},applied:{reverts:i.applied.reverts}}}]):[s,t]},this._loading=e=>{const{state:t,context:r}=e,i=le;return t===re.IDLE?(this._logger.debug("TouchTypistStateManager state changed to loading"),[{type:oe._.LOADING},{state:re.LOADING,context:{current:{previews:[],reverts:[],replacementInfo:p.YP},applied:{reverts:r.applied.reverts}}}]):[i,e]},this._responseReceived=({response:e,currentText:t})=>r=>{var i;const{state:s,context:a}=r;if(s===re.LOADING){if(this._logger.debug("TouchTypistStateManager state changed to ready"),!(null===(i=e.previews)||void 0===i?void 0:i.length))return this._logger.debug("Response has no previews.",{response:e}),this._params.touchTypistTelemetryService.info({message:"Response has no previews.",data:e}),this._interrupted("response_no_previews")(r);const s=K.normalize(e.textScope.begin),n=e.previews.map((r=>{const i=s(r);return{...i,touchTypistId:e.touchTypistId,original:t.slice(i.begin,i.end),highlight:{...i.highlight,text:t.slice(i.highlight.s,i.highlight.e)},relativeReverseDelta:r.reverseDelta}})),o=W.findCorrespondingPreview(n),c=W.normalize(e.textScope.begin),l=e.reverts.reduce(((t,r)=>{const i=o(r);return p.pC(i)&&t.push({...c(r),touchTypistId:e.touchTypistId,highlightText:e.text.slice(r.highlightBegin,r.highlightEnd),isRecent:!0,correspondingPreview:i.value}),t}),[]);l.forEach((e=>{this._newParagraphsSinceRevert.set(e,0)}));const h={current:{...a.current,previews:n,reverts:l,replacementInfo:p.G({replacementText:e.text,replacementTextRange:{start:e.textScope.begin,end:e.textScope.end},delta:(0,ie.RZ)(K.offsetDelta(e.delta,e.textScope.begin))})},applied:{reverts:a.applied.reverts}};return[{type:oe._.RESPONSE_RECEIVED},{state:re.READY,context:h}]}return[le,r]},this._responseApplied=e=>{const{state:t,context:r}=e;return t===re.READY&&p.pC(r.current.replacementInfo)?(this._logger.debug("TouchTypistStateManager state changed to success"),[{type:oe._.RESPONSE_APPLIED},{state:re.SUCCESS,context:{...pe,applied:{reverts:[...r.applied.reverts,...r.current.reverts]}}}]):[le,e]},this._previewApplied=e=>t=>{const r=t.context.current.previews.find((t=>t.id===e));if(!r){const r=`Received a "${oe._.PREVIEW_APPLIED}" event, but the corresponding preview is missing from the state.`;return this._logger.warn(r,{previewIdInPayload:e,previewsInState:t.context.current.previews}),this._params.touchTypistTelemetryService.warn({message:r,data:{previewIdInPayload:e,previewsInState:t.context.current.previews}}),[{type:oe._.PREVIEW_APPLIED},t]}const s=t.context.current.previews.filter((t=>t.id!==e)),a=t.context.current.reverts.filter((t=>t.correspondingPreview.id!==e)),n=K.rebaseByAppliedPreview(r),o=s.map(n),c=(0,i.zG)(t.context.current.replacementInfo,p.UI((e=>{const t=r.end-r.begin,i=r.replacement.length-t;return{...e,replacementTextRange:{...e.replacementTextRange,end:e.replacementTextRange.end+i}}})));return[{type:oe._.PREVIEW_APPLIED},{state:s.length>0?re.READY:re.IDLE,context:{...t.context,current:{...t.context.current,previews:o,reverts:a,replacementInfo:c}}}]},this._previewDismissed=e=>t=>{if(t.state!==re.READY)return[le,t];const r=t.context.current.previews.find((t=>t.id===e));if(!r){const r=`Received a "${oe._.PREVIEW_DISMISSED}" event, but the corresponding preview is missing from the state.`;return this._logger.warn(r,{previewIdInPayload:e,previewsInState:t.context.current.previews}),this._params.touchTypistTelemetryService.warn({message:r,data:{previewIdInPayload:e,previewsInState:t.context.current.previews}}),[{type:oe._.PREVIEW_DISMISSED},t]}const s=t.context.current.previews.filter((e=>e!==r)),a=t.context.current.reverts.find((t=>t.correspondingPreview.id===e)),n=t.context.current.reverts.filter((e=>e!==a)),o=(0,i.zG)(t.context.current.replacementInfo,p.UI((e=>{const t=(0,se.l)(new $.i([...r.relativeReverseDelta.ops]),e.replacementText);return{...e,replacementText:t}})));return[{type:oe._.PREVIEW_DISMISSED},{state:0===s.length?re.IDLE:re.READY,context:{...t.context,current:{...t.context.current,previews:s,reverts:n,replacementInfo:o}}}]},this._individualRevertApply=e=>t=>{const r=t=>t.filter((t=>t.revertId!==e)),i=r(t.context.applied.reverts);return[{type:oe._.REVERT_APPLIED},{state:re.IDLE,context:{...t.context,current:{...t.context.current,reverts:r(t.context.current.reverts)},applied:{...t.context.applied,reverts:i}}}]},this._userAddedOrRemovedNewlines=e=>{const t=e=>e.filter((e=>{let t=this._newParagraphsSinceRevert.get(e);return void 0===t&&(this._logger.info("Revert has no newParagraphs count, setting to 0",{revert:e}),t=0),t+1!==2&&(this._newParagraphsSinceRevert.set(e,t+1),!0)})),r=t(e.context.current.reverts),i=t(e.context.applied.reverts);return this._logger.debug("_userAddedOrRemovedNewlines",{currentReverts:r,appliedReverts:i}),[{type:oe._.USER_ADDED_OR_REMOVED_NEWLINES},{...e,context:{...e.context,current:{...e.context.current,reverts:r},applied:{...e.context.applied,reverts:i}}}]},this._updateReverts=e=>{const t=e.context.applied.reverts.map((e=>({...e,isRecent:!1})));return[{type:oe._.UPDATE_REVERTS},{...e,context:{...e.context,applied:{...e.context.current,reverts:t}}}]},this._replacementStarted=e=>e.state!==re.READY?[le,e]:(this._logger.debug("TouchTypistStateManager state changed to replacing"),[{type:oe._.REPLACEMENT_STARTED},{...e,state:re.REPLACING}]),this._replacementFinished=e=>e.state!==re.REPLACING?[le,e]:(this._logger.debug("TouchTypistStateManager finished replacing, state changed to ready"),[{type:oe._.REPLACEMENT_FINISHED},{...e,state:re.READY}]),this._transition=e=>{const t=e.name;switch(t){case oe._.INTERRUPTED:return this._interrupted(e.payload.source);case oe._.RESPONSE_NOT_RECEIVED:return this._interrupted("response_not_received");case oe._.LOADING:return this._loading;case oe._.RESPONSE_RECEIVED:return this._responseReceived(e.payload);case oe._.RESPONSE_APPLIED:return this._responseApplied;case oe._.PREVIEW_APPLIED:return this._previewApplied(e.payload.previewId);case oe._.PREVIEW_DISMISSED:return this._previewDismissed(e.payload.previewId);case oe._.REVERT_APPLIED:return this._individualRevertApply(e.payload.revertId);case oe._.USER_ADDED_OR_REMOVED_NEWLINES:return this._userAddedOrRemovedNewlines;case oe._.UPDATE_REVERTS:return this._updateReverts;case oe._.REPLACEMENT_STARTED:return this._replacementStarted;case oe._.REPLACEMENT_FINISHED:return this._replacementFinished;default:(0,J.L0)(t)}},this.handleEvent=e=>{const[t,r]=this._transition(e)(this.state.get());return t.type===ce&&this._logger.debug(`Transition [${e.name}] wasn't made because TouchTypistStateManager wasn't in the correct state, current state: [${this.state.get().state}]`),this._state.set(r),t},this.getTouchTypistId=()=>{const e=this.state.get().context.current.previews;return 0===e.length?(this._logger.info("No previews in the state"),null):Number(e[0].touchTypistId)},this._logger.debug("TouchTypistStateManager initialized."),this._subs.add(this._state.pipe(j.g("state"),v.w((e=>e.state===re.LOADING?E.timer(5e3):Z.E)),X.b((()=>{this._logger.warn("Request timed out."),this._params.touchTypistTelemetryService.error({message:"Request timed out."}),this.handleEvent({name:oe._.INTERRUPTED,payload:{source:"response-timout"}})}))).subscribe())}dispose(){this._subs.unsubscribe()}}const de=({children:e,caretPosition:t})=>u.createElement("div",{style:{position:"fixed",top:d.ux.px(t.bottom+6),left:t.right,transform:"translateX(calc(-50% + 1px))"}},e);var ge=r(14765),me=r(21147),_e=r(59833),ve=r(24348),ye=r(8923),Te=r(11456),be=r(74983);class fe{constructor(e){var t;this._params=e,this._subs=new s.w,this._previewEq=me.f7(((e,t)=>e.id===t.id)),this._revertEq=me.f7(((e,t)=>e.revertId===t.revertId)),this.alertFilter=(t=this._params.alertProcessor,t.alerts.state.view((e=>Object.values(e).filter(Boolean).filter(ve.u.is))).pipe(a.U((e=>t=>{if(0===e.length||Te.S.isTouchTypistAlert(t))return!0;const r=e.filter((e=>e.kind===ve.y.Preview)).flatMap((e=>e.highlightRanges));return!t.highlightRanges.some((e=>r.some((t=>be.SV.intersects(e,t)))))})))),[this._createTouchTypistStatePreviewsSubscription(),this._createTouchTypistStateRevertsSubscription()].forEach((e=>this._subs.add(e)))}_createTouchTypistStatePreviewsSubscription(){return this._params.touchTypistState.pipe(a.U((({context:e})=>e.current.previews)),_.x()).pipe(ge.O([]),l.G(),o.h((([e,t])=>_e.Od(e)||_e.Od(t))),a.U((([e,t])=>({previewsToRemove:_e.e5(this._previewEq)(t)(e),previewsToAdd:_e.e5(this._previewEq)(e)(t)})))).subscribe((({previewsToRemove:e,previewsToAdd:t})=>{e.forEach((e=>this._params.alertProcessor.removeAlert(String(e.id),{_tag:ye.i.alertUpdate}))),t.forEach((e=>this._params.alertProcessor.addAlert(ve.u.fromPreview()(e))))}))}_createTouchTypistStateRevertsSubscription(){return this._params.touchTypistState.pipe(a.U((({context:e})=>e.applied.reverts)),_.x()).pipe(ge.O([]),l.G(),o.h((([e,t])=>_e.Od(e)||_e.Od(t))),a.U((([e,t])=>({revertsToRemove:_e.e5(this._revertEq)(t)(e),revertsToUpdate:_e.jV(this._revertEq)(e.filter((e=>e.isRecent)))(t.filter((e=>!e.isRecent))),revertsToAdd:_e.e5(this._revertEq)(e)(t)})))).subscribe((({revertsToRemove:e,revertsToUpdate:t,revertsToAdd:r})=>{e.forEach((e=>this._params.alertProcessor.removeAlert(String(e.revertId),{_tag:ye.i.alertUpdate}))),t.forEach((e=>{const t={id:String(e.revertId),kind:ve.y.Revert};this._params.alertProcessor.changeAlert(t)})),r.forEach((e=>this._params.alertProcessor.addAlert(ve.u.fromRevert()(e))))}))}_removeAllTouchTypistAlerts(){this._params.alertProcessor.removeAllAlertsBy(ve.u.is,{_tag:ye.i.reset})}dispose(){this._subs.unsubscribe(),this._removeAllTouchTypistAlerts()}}var Se=r(52256),Ee=r(86399),ke=r(92135),xe=r(30033);var we=r(10712),Ce=r(74857);function Re(e,t,r){return g.T(t.obs.pipe(c.h(null)),e).pipe(ge.O(null),l.G(),n.M(r.state.pipe(a.U((e=>e.state)))),o.h((([[e,t],r])=>[e,t].every((e=>null!==e))&&r!==re.REPLACING)),a.U((([[,e]])=>e)))}var Pe,Ie,Ae,Me=r(65384);!function(e){e.is=function(e){return 1===e.changes.length&&Me.q.isDel(e.changes[0])}}(Pe||(Pe={})),function(e){e.is=function(e){return 1===e.changes.length&&Me.q.isIns(e.changes[0])}}(Ie||(Ie={})),function(e){e.is=function(e){return[Ie.is,Pe.is].some((t=>t(e)))}}(Ae||(Ae={}));var De=r(68485);var Le=r(12518);const Ne=e=>{if(Me.q.isIns(e)){return e.pos+e.text.length}if(Me.q.isDel(e)){return e.pos}(0,J.L0)(e)};function Oe(e,t,r=!1){const s=ae.Y.create(`TouchTypist.${Oe.name}`),a=Ne(e.changes[0]),n=e.newText,o=(0,i.zG)(((e,t)=>{if(t<0||t>e.length)return Le.left(new Error("Caret outside of the text boundaries."));let r=t,i=t;for(;r>0&&"\n"!==e.charAt(r-1);)r--;for(;i<e.length&&"\n"!==e.charAt(i);)i++;return Le.right({start:r,end:i})})(n,a),Le.fold((e=>(s.error("Failed to get paragraph range containing position.",e,{text:n,position:a}),t.error({message:"Failed to get paragraph range containing position.",error:e,data:{text:n,position:a}}),null)),i.yR));if(!o||o.start===o.end)return s.debug("Paragraph containing text change is empty."),p.YP;return o.end===a||r?p.G(o):(s.debug(`Text change end is not at the end of its containing paragraph. Paragraph end: ${o.end}. Text change position: ${a}`),p.YP)}function Fe(e,t=!1){return r=>r.pipe(a.U((r=>Oe(r,e,t))))}class He{constructor(e){this._params=e,this._subs=new s.w,this._activeParagraphRange=ee.h.create(p.YP),this._logger=ae.Y.create("TouchTypistParagraphServiceImpl"),this.activeParagraphRange=this._activeParagraphRange.view();const t=(r=this._params.textChangesAsync,i=this._params.replacementListener,l=this._params.stateManager,Re(r,i,l).pipe(X.b((()=>{const e=l.state.get().context.applied.reverts;l.handleEvent({name:oe._.INTERRUPTED,payload:{source:"create_eligible_text_changes"}}),e.length>0&&l.handleEvent({name:oe._.UPDATE_REVERTS})})),o.h((e=>Ae.is(e))),Ce.b(1e3))).pipe(Fe(this._params.touchTypistTelemetryService));var r,i,l;const h=function(e,t){return e.pipe(n.M(t.state.pipe(a.U((e=>e.state)))),o.h((([,e])=>e===re.READY||e===re.REPLACING)),a.U((([e])=>e)))}(this._params.textChangesAsync,this._params.stateManager).pipe(Fe(this._params.touchTypistTelemetryService,!0)),u=function(e,t){return e.obs.pipe(n.M(t.state.pipe(a.U((e=>e.state)))),o.h((([e])=>e.source!==De.P.touchTypist)),X.b((([,e])=>{e===re.READY&&t.handleEvent({name:oe._.INTERRUPTED,payload:{source:"create_ineligible_replacement_changes"}})})),c.h(p.YP))}(this._params.replacementListener,this._params.stateManager);this._subs.add(g.T(t,h,u).pipe(E.skipBy(p.Eh(be.SV.eq))).subscribe((e=>{this._activeParagraphRange.set(e)})))}getTextRangeLastLineClientRectangle(e){this._logger.debug("TouchTypistParagraphServiceImpl.getTextRangeLastLineClientRectangle invoked");const t=(0,i.zG)(e,p.UI((r=()=>this._params.textObserver.getCurrentTextMap(),s=this._params.geometryProvider,a=this._params.geometryLayout,e=>(0,i.zG)(p.ij(s.create(e,r(),!0)),p.tS((e=>p.ij(s.getClientRects(e,!0)))),p.tS(ke.nI),p.g_((()=>[]),Ee.UI((e=>xe.UL.setPosition(a.getCurrentConversionContext().clientToRelative(e),e))))))),p.VS(_e.Z$),p.WG);var r,s,a;if(!t)return this._params.touchTypistTelemetryService.info({message:"Failed to get the position of text range's last line.",data:{textRange:e}}),this._logger.debug("Failed to get the position of text range's last line.",{textRange:Se.QP(e)}),p.YP;const n=(0,we.Z)(t,this._params.textFieldLayout.rect.getCurrent().client,this._params.textFieldLayout.scroll.getCurrent());return p.G({...n})}dispose(){this._subs.unsubscribe()}}var Qe=r(26326),Ue=r(63770),Be=r(45818),Ve=r(1124);class qe{constructor(e){this._params=e,this._logger=ae.Y.create("TouchTypistGDocsIntegration"),this._logger.info("TouchTypist integration for GDocs")}get eventsTargetElement(){const e=(0,Ve.CI)(document);return e||(this._params.telemetry.error({message:"Could not find the target element for text events in GDocs"}),this._logger.error("Could not find the target element for text events"),document.body)}getTextRangeLastLineClientRectangle(e){return this._params.paragraphService.getTextRangeLastLineClientRectangle(e)}}class Ge{constructor(e){this._params=e,this._logger=ae.Y.create("TouchTypistGenericIntegration"),this._logger.info("TouchTypist integration for non-GDocs")}get eventsTargetElement(){return document.body}getTextRangeLastLineClientRectangle(e){return this._params.paragraphService.getTextRangeLastLineClientRectangle(e)}}var Ye=r(79264),Ke=r(84823),We=r(73863),ze=r(10595),$e=r(44424),je=r(17071),Ze=r(29919);class Xe{constructor(e){this._params=e,this._logger=ae.Y.create("TouchTypistCapiServiceImpl"),this._correlationId=""}triggerTouchTypist(e){const t=this._params.getCheckingService();if(!t)return this._logger.error("Checking service is not available in TouchTypist"),Promise.reject(new Error("Checking service is not available in TouchTypist"));const r=(0,Ze.M8)(),s={action:"trigger_touch_typist",mode:"GEC_PROGRESSIVE_RECHECK",features:[Ye.zV.individualPreviewReverts],textScope:e,correlationId:r,id:1};return this._params.textChangeBuffer.flush(),(0,i.zG)(t.checkingRevisionInfo,Ce.b(100),We.q(1),ze.L(1e3,$e._((()=>{throw this._logger.error(`TouchTypist request couldn't be sent because latest revision wasn't emitted, correlation id: ${r}`),this._params.touchTypistTelemetryService.error({message:"TouchTypist request couldn't be sent because latest revision wasn't emitted",data:{textScope:e,correlationId:r}}),new Error(`TouchTypist request couldn't be sent because latest revision wasn't emitted, correlation id: ${r}`)}))),X.b((()=>{t.sendTouchTypistCommand(s),this._correlationId=r})),c.h(void 0)).toPromise()}onTouchTypistTriggerResponse(e){if(this._logger.debug("TouchTypist TriggerResponse received.",e),this._correlationId===e.correlationId){const t=this._params.textObserver.getTextSource().getPlainText();this._params.stateManager.handleEvent({name:oe._.RESPONSE_RECEIVED,payload:{response:e,currentText:t}})}else this._params.touchTypistTelemetryService.warn({message:"The correlation id in the response does not match the correlation id in the request."}),this._logger.warn("The correlation id in the response does not match the correlation id in the request."),this._params.stateManager.handleEvent({name:oe._.INTERRUPTED,payload:{source:"wront-correlation-id"}})}_sendCommand(e,t=!0){const r=this._params.getCheckingService();if(!r)throw this._logger.error("Checking service is not available in TouchTypist"),new Error("Checking service is not available in TouchTypist");return t?r.sendTouchTypistCommand(e):(0,je.Q1)()}sendTouchTypistPreviewAction(e,t,r){try{this._sendCommand({actionType:e,previewId:r,touchTypistId:t,action:"touch_typist_action",id:1})}catch(t){this._logger.error(`Failed to send touch typist preview action: ${e} for preview id: ${r} with error: ${t}`)}}sendTouchTypistRevertAction(e,t){try{this._sendCommand({touchTypistId:e,action:"touch_typist_action",id:1,actionType:Ke.XN.Revert,revertId:t,location:"REVERT_CARD"})}catch(e){this._logger.error(`Failed to send touch typist revert action for revert id: ${t} with an error ${e}`)}}sendTouchTypistApplyAction(e){try{this._sendCommand({touchTypistId:e,action:"touch_typist_action",id:1,actionType:Ke.XN.Apply,location:"HOTKEY",hotkey:"TAB"})}catch(t){this._logger.error(`Failed to send touch typist apply action for touch typist id: ${e} with an error ${t}`)}}sendTouchTypistRevertLookAction(e,t){try{this._sendCommand({action:"touch_typist_action",id:1,actionType:Ke.XN.RevertLook,touchTypistId:e,revertId:t})}catch(e){this._logger.error(`Failed to send touch typist revert look action for revert id: ${t} with an error ${e}`)}}sendTouchTypistAppearAction(e){try{this._sendCommand({action:"touch_typist_action",id:1,actionType:Ke.XN.Appeared,touchTypistId:e})}catch(t){this._logger.error(`Failed to send touch typist appear action for touch typist id: ${e} with an error ${t}`)}}sendTouchTypistSkipAction(e){try{this._sendCommand({touchTypistId:e,action:"touch_typist_action",id:1,actionType:Ke.XN.Skipped})}catch(t){this._logger.error(`Failed to send touch typist skip action for touch typist id: ${e} with an error ${t}`)}}}var Je=r(19486);class et{constructor(e){this._params=e,this._subs=new s.w}listeningToHotkeyApply(){this._subs.add(this._params.touchTypistStateValue.pipe(v.w((e=>e===re.READY?(0,Je._w)(this._params.targetElement,this._params.isMac,this._params.hotkey):Z.E)),o.h((({shortcut:e})=>e===this._params.hotkey.get())),X.b((({events:e})=>{e.forEach((e=>{e.preventDefault()}))}))).subscribe((()=>{this._params.applyChanges().then((()=>this._params.csActions.incrementTouchTypistUserAcceptedCount()))})))}dispose(){this._subs.unsubscribe()}}var tt=r(75352),rt=r(49144);class it{constructor(e){this._params=e,this._subs=new s.w,this._textChangesObs=new rt.X({changes:[],prevText:"",newText:"",deltaChange:tt.RI.delta(new $.i)}),this.textChangesAsyncObs=this._textChangesObs.asObservable(),this._subs.add(this._params.textObserver.contentChanges.async.subscribe((e=>{0!==e.changes.length&&this._textChangesObs.next(e)})))}dispose(){this._subs.unsubscribe()}}class st{constructor(e){this._params=e}async trackOpenQuickSettingsButtonClicked(){await this._params.gnarClient.touchTypistOpenQuickSettingsButtonClick()}async trackQuickSettingsShown(){await this._params.gnarClient.touchTypistQuickSettingsShow()}async trackQuickSettingsEditHotkeyButtonClicked(){await this._params.gnarClient.touchTypistQuickSettingsEditHotkeyButtonClick()}async trackQuickSettingsTurnOffButtonClicked(){await this._params.gnarClient.touchTypistQuickSettingsTurnOffButtonClick()}}var at=r(39620),nt=r(18551),ot=r(47338),ct=r(35947),lt=r(56412);const pt=(e,t,r,i)=>be.SV.translate(be.SV.rebase(be.SV.translate(e,-i.start),Me.k.fromDiff(t,r)),i.start);class ht{constructor(e){this._params=e,this._logger=ae.Y.create("TouchTypistReplacementServiceImpl"),this._subs=new s.w,this._replacementInfo=ee.h.create(p.YP),this._selectionOrCaretPosition=ee.h.create(null),this._subs.add(this._params.stateManager.state.pipe(a.U((e=>e.context.current.replacementInfo)),_.x()).subscribe(at.wW(this._replacementInfo))),this._subs.add(this._params.selectionOrCaretPosition.pipe(o.h(p.pC),a.U(Se.MH)).subscribe(at.wW(this._selectionOrCaretPosition)))}canPerformReplacement(e,t){return this._params.replacementService.canPerformReplacement(e,t)}_getApplyType(e,t){return e?"hotkey":t?"individualRevert":"individualPreview"}performReplacement(e,t,r=!0,i=!1){const s=this._getApplyType(r,i),a=ee.h.create(null),{pos:n,value:o}=e,c=this._selectionOrCaretPosition.get();if(this.canPerformReplacement({pos:n,oldValue:t,value:o})&&c)return this._params.stateManager.handleEvent({name:oe._.REPLACEMENT_STARTED}),this._logger.debug("Perform replacement",{range:n,newText:o,prevText:t,caretPosition:c}),h.Y3((async()=>{const i=pt(c,t,o,n),l=this._params.textChangesAsync.pipe(nt.T(1));this._subs.add(l.subscribe((e=>a.set(e))));const p=await this._params.replacementService.performReplacement(e,{preserveFormatting:!0,touchTypistApplyType:s});if(await a.pipe(ot.n((e=>null===e)),We.q(1),ze.L(500,y.of(null))).toPromise()&&!r&&"gDocsCanvas"===this._params.integrationInfo.integrationName&&await this._params.selectionOrCaretPosition.pipe(Ce.b(200),We.q(1)).toPromise(),(0,lt.TW)(p)&&this._params.selectionService.setSelection({start:i.start,end:i.end}),this._params.stateManager.handleEvent({name:oe._.REPLACEMENT_FINISHED}),!a.get())throw this._params.touchTypistTelemetryService.error({message:"Text changes emission timed out",data:{replacement:e,prevText:t}}),new Error("Text changes emission timed out");return p}),(r=>(this._logger.error("Failed to perform a replacement",r),this._params.touchTypistTelemetryService.error({message:"Failed to perform a replacement",data:{replacement:e,prevText:t,error:String(r)}}),new Error(`Failed to perform a single replacement. ${String(r)}`))));throw this._params.touchTypistTelemetryService.error({message:"Can't perform replacement at this range",data:{replacement:e,prevText:t}}),new Error("Can't perform replacement at this range")}performBatchReplacements(e,t,r){const i=ee.h.create(null),{pos:s,value:a}=t,n=this._selectionOrCaretPosition.get();if(this._logger.debug("Perform batch replacements",{newText:a,prevText:r,caretPosition:n}),this._params.stateManager.handleEvent({name:oe._.REPLACEMENT_STARTED}),n)return h.Y3((async()=>{const o=pt(n,r,a,s),c=this._params.textChangesAsync.pipe(nt.T(1));this._subs.add(c.subscribe((e=>i.set(e))));const l=await this._params.replacementService.performBatchReplacements(e,{preserveFormatting:!0,touchTypistApplyType:"hotkey"});if(await i.pipe(ot.n((e=>null===e)),We.q(1),ze.L(500,y.of(null))).toPromise(),await this._params.selectionOrCaretPosition.pipe(Ce.b(200),We.q(1)).toPromise(),this._params.selectionService.setSelection({start:o.start,end:o.end}),this._params.stateManager.handleEvent({name:oe._.REPLACEMENT_FINISHED}),!i.get())throw this._params.touchTypistTelemetryService.error({message:"Text changes emission timed out",data:{replacements:e,singleReplacement:t,prevText:r}}),new Error("Text changes emission timed out");return l}),(i=>(this._logger.error("Failed to perform a batch replacement",i),this._params.touchTypistTelemetryService.error({message:"Failed to perform a batch replacement",data:{replacements:e,singleReplacement:t,prevText:r,error:String(i)}}),new Error(`Failed to perform a batch replacement. ${String(i)}`))));throw this._params.touchTypistTelemetryService.error({message:"Can't perform batch replacement. Selection is null"}),new Error("Can't perform batch replacement at this range. Selection is null")}async applyChanges(){this._logger.info("Apply TouchTypist suggestions");const e=(0,i.zG)(this._replacementInfo.get(),p.g_(i.gn,i.yR));if(e){const t=this._params.textObserver.getCurrentTextMap().getFormatHelper(),r=null==t?void 0:t.getInfo(e.replacementTextRange.start,e.replacementTextRange.end),i=r&&r.footnoteCount,s=r&&r.hyperlinksCount,a=r&&r.smartChipsCount,n=this._params.textObserver.getCurrentTextMap().getPlainText().slice(e.replacementTextRange.start,e.replacementTextRange.end);let o;if(i||s||a){const t=(0,ct.g)(e.delta);o=await this.performBatchReplacements(t,{pos:e.replacementTextRange,value:e.replacementText},n)()}else o=await this.performReplacement({pos:e.replacementTextRange,value:e.replacementText},n,!0,!1)();return o&&Le.isRight(o)?this._params.stateManager.handleEvent({name:oe._.RESPONSE_APPLIED}):(this._params.touchTypistTelemetryService.info({message:"Failed to apply changes",data:{replacementInfo:e}}),this._params.stateManager.handleEvent({name:oe._.INTERRUPTED,payload:{source:"perform_replacement_failed"}}))}return this._params.touchTypistTelemetryService.info({message:"No replacement info to apply changes"}),this._params.stateManager.handleEvent({name:oe._.INTERRUPTED,payload:{source:"perform_replacement_no_replacement_info"}})}dispose(){this._subs.unsubscribe()}}var ut=r(36072),dt=r(65882),gt=r(58638),mt=r(83135);class _t{constructor(e){this._params=e,this._subs=new s.w,this._hotkeyChangeManager=ee.h.create(null),this._lastKnownSelectionOrCaretPosition=ee.h.create(p.YP),this._restoreSelectionSubject=new ut.xQ,this._listenToHotkeyChangeSubscription=null,this.hotkey=this._params.csPageState.view((e=>{var t;return(null!==(t=e.touchTypistSettings)&&void 0!==t?t:Qe.Y).hotkey})),this.numberOfErrors=this._params.stateManager.state.view((e=>e.context.current.previews.length)),this.softOnboardingState=this._params.csPageState.view((e=>{var t;const r=null!==(t=e.touchTypistState)&&void 0!==t?t:Qe.c;return A.kH.get(r.userAcceptedCount)})),this.displayedQuickFixKey=ee.h.create(""),[this.createDisplayedQuickFixKeySubscription(),this.createLastKnownSelectionOrCaretPositionSubscription(),this.createRestoreSelectionSubscription()].forEach((e=>this._subs.add(e)))}initiateQuickFixKeyChange(){if(this.isQuickFixKeyChangeInitiated(this._hotkeyChangeManager.get()))return;const e=new mt.c("",ee.h.create(!0));this._hotkeyChangeManager.set(e),this._listenToHotkeyChangeSubscription=e.listenToHotkeyChange(this._params.isEnvMac),e.onIsActiveHotkeyChange()}confirmQuickFixKeyChange(){var e;const t=this._hotkeyChangeManager.get();if(!this.isQuickFixKeyChangeInitiated(t))return;t.tmpHotkey.get()?t.onApplyHotkeyChange(this._params.csActions):t.onDismissHotkeyChange(),null===(e=this._listenToHotkeyChangeSubscription)||void 0===e||e.unsubscribe(),this._listenToHotkeyChangeSubscription=null,this._hotkeyChangeManager.set(null)}restoreSelection(){this._restoreSelectionSubject.next()}turnOffQuickFix(){this._params.csActions.setTouchTypistEnabled(!1)}trackOpenQuickSettingsButtonClicked(){this._params.gnarTrackingService.trackOpenQuickSettingsButtonClicked()}trackQuickSettingsShown(){this._params.gnarTrackingService.trackQuickSettingsShown()}trackQuickSettingsEditHotkeyButtonClicked(){this._params.gnarTrackingService.trackQuickSettingsEditHotkeyButtonClicked()}trackQuickSettingsTurnOffButtonClicked(){this._params.gnarTrackingService.trackQuickSettingsTurnOffButtonClicked()}dispose(){this.confirmQuickFixKeyChange(),this._subs.unsubscribe()}createDisplayedQuickFixKeySubscription(){const e=this._hotkeyChangeManager.pipe(v.w((e=>{var t;return null!==(t=null==e?void 0:e.tmpHotkey)&&void 0!==t?t:y.of(null)})));return dt.aj([this.hotkey,e]).subscribe((([e,t])=>{this.displayedQuickFixKey.set(null===t?e:t)}))}isQuickFixKeyChangeInitiated(e){return null!==e&&null!==this._listenToHotkeyChangeSubscription&&!this._listenToHotkeyChangeSubscription.closed}createLastKnownSelectionOrCaretPositionSubscription(){return this._params.selectionOrCaretPosition.subscribe(at.wW(this._lastKnownSelectionOrCaretPosition))}createRestoreSelectionSubscription(){return this._restoreSelectionSubject.pipe(gt.p(250)).subscribe((()=>{const e=this._lastKnownSelectionOrCaretPosition.get();p.pC(e)&&this._params.selectionService.setSelection(e.value)}))}}class vt{constructor(e){var t,r;this._params=e,this._subs=new s.w,this._disposables=[],this._stateManager=new ue({state:he,touchTypistTelemetryService:this._params.touchTypistTelemetryService}),this._textChangesService=new it({geometryLayout:this._params.geometryLayout,geometryProvider:this._params.geometryProvider,textFieldLayout:this._params.textFieldLayout,textObserver:this._params.textObserver,selectionOrCaretPosition:this._params.selectionOrCaretPosition}),this._paragraphService=new He({textChangesAsync:this._textChangesService.textChangesAsyncObs,selectionOrCaretPosition:this._params.selectionOrCaretPosition,replacementListener:this._params.replacementListener,stateManager:this._stateManager,geometryLayout:this._params.geometryLayout,geometryProvider:this._params.geometryProvider,textFieldLayout:this._params.textFieldLayout,textObserver:this._params.textObserver,touchTypistTelemetryService:this._params.touchTypistTelemetryService}),this._integration="gDocsCanvas"===this._params.integrationInfo.integrationName?new qe({paragraphService:this._paragraphService,telemetry:this._params.touchTypistTelemetryService}):new Ge({paragraphService:this._paragraphService,telemetry:this._params.touchTypistTelemetryService}),this._logger=ae.Y.create("TouchTypistFeatureImpl"),this._touchTypistState=this._stateManager.state,this._touchTypistCapiService=new Xe({getCheckingService:this._params.getCheckingService,textChangeBuffer:this._params.textChangeBuffer,touchTypistTelemetryService:this._params.touchTypistTelemetryService,stateManager:this._stateManager,textObserver:this._params.textObserver}),this._replacementService=new ht({replacementService:this._params.replacementService,textObserver:this._params.textObserver,textChangesAsync:this._textChangesService.textChangesAsyncObs,selectionService:this._params.selectionService,activeParagraphRange:this._paragraphService.activeParagraphRange,selectionOrCaretPosition:this._params.selectionOrCaretPosition,stateManager:this._stateManager,integrationInfo:this._params.integrationInfo,touchTypistTelemetryService:this._params.touchTypistTelemetryService}),this._touchTypistHotkey=this._params.csPageState.view((e=>{var t;const r=e.touchTypistSettings;return null!==(t=null==r?void 0:r.hotkey)&&void 0!==t?t:Qe.Y.hotkey})),this._touchTypistHotkeyManager=new et({csActions:this._params.csActions,hotkey:this._touchTypistHotkey,touchTypistStateValue:this._stateManager.state.pipe(a.U((e=>e.state))),targetElement:this._integration.eventsTargetElement,applyChanges:async()=>{const e=this._stateManager.getTouchTypistId();await this._replacementService.applyChanges(),e&&this._touchTypistCapiService.sendTouchTypistApplyAction(e)},isMac:this._params.isMac}),this._touchTypistAlertService=new fe({alertProcessor:this._params.alertProcessor,touchTypistState:this._touchTypistState}),this._touchTypistGnarTrackingService=new st({gnarClient:this._params.gnarClient}),this._hotkeyHintViewModel=new _t({csPageState:this._params.csPageState,csActions:this._params.csActions,stateManager:this._stateManager,isEnvMac:this._params.isMac,selectionService:this._params.selectionService,selectionOrCaretPosition:this._params.selectionOrCaretPosition,gnarTrackingService:this._touchTypistGnarTrackingService}),this.alertFilter=this._touchTypistAlertService.alertFilter,this._logger.info("Touch Typist feature is initialized",this._params.integrationInfo),this._disposables.push(this._paragraphService,this._replacementService,this._touchTypistAlertService),this._touchTypistHotkeyManager.listeningToHotkeyApply(),this._disposables.push(this._touchTypistHotkeyManager),this._subs.add(this._paragraphService.activeParagraphRange.pipe(n.M(this._stateManager.state)).pipe(a.U((([e,t])=>{const r=(0,i.zG)(e,p.g_(i.gn,i.yR));r&&t.state===re.IDLE&&(this._logger.info("Send touch typist trigger event",r),this._stateManager.handleEvent({name:oe._.LOADING}),h.Y3((async()=>await this._touchTypistCapiService.triggerTouchTypist({begin:r.start,end:r.end})),(()=>this._stateManager.handleEvent({name:oe._.INTERRUPTED,payload:{source:"trigger_touch_typist"}})))())}))).subscribe()),this._subs.add(this._createUserAddedOrRemovedNewlinesSubscription()),this._subs.add(yt(this._touchTypistState,(()=>this._stateManager.getTouchTypistId()),(e=>this._touchTypistCapiService.sendTouchTypistAppearAction(e)),(e=>this._touchTypistCapiService.sendTouchTypistSkipAction(e)))),this._subs.add((t=this._params.selectionOrCaretPosition,r=this._stateManager,t.pipe(n.M(r.state.pipe(a.U((e=>e.state)))),o.h((([,e])=>e!==re.REPLACING)),X.b((([,e])=>{e===re.READY&&r.handleEvent({name:oe._.INTERRUPTED,payload:{source:"create_ineligible_selection_changes"}})})),c.h(p.YP))).subscribe())}dispose(){this._disposables.forEach((e=>e.dispose()))}get touchTypistUI(){return function(e,t,r,i,s){const n=g.T(t.scroll.changes,m.R(self,"scroll",{capture:!0})).pipe(c.h(void 0)),o=[re.LOADING,re.READY,re.REPLACING,re.SUCCESS];return i.pipe(a.U((e=>e.state)),_.x(),v.w((t=>{if(!o.includes(t))return y.of(p.YP);const i=e.activeParagraphRange.pipe(a.U((e=>r.getTextRangeLastLineClientRectangle(e))),a.U(p.WG),a.U((e=>e?t===re.LOADING?p.G(u.createElement(de,{caretPosition:e},u.createElement(Y,null))):t===re.READY||t===re.REPLACING?p.G(u.createElement(q,{caretPosition:e,label:s.hotkey,errorsCount:s.numberOfErrors,softOnboardingState:s.softOnboardingState.get(),quickFixKey:s.displayedQuickFixKey,onQuickSettingsMenuUnmount:()=>{s.confirmQuickFixKeyChange()},onQuickSettingsButtonClick:e=>{s.restoreSelection(),e||s.trackOpenQuickSettingsButtonClicked()},onQuickSettingsShown:()=>{s.trackQuickSettingsShown()},onChangeQuickFixKeyTextboxFocus:()=>{s.initiateQuickFixKeyChange(),s.trackQuickSettingsEditHotkeyButtonClicked()},onChangeQuickFixKeyTextboxBlur:()=>{s.confirmQuickFixKeyChange(),s.restoreSelection()},onTurnOffQuickFixClick:()=>{s.turnOffQuickFix(),s.trackQuickSettingsTurnOffButtonClicked()}})):t===re.SUCCESS?p.G(u.createElement(de,{caretPosition:e},u.createElement(S,null))):p.YP:p.YP)));return g.T(n.pipe(T.c(i)),i)})))}(this._paragraphService,this._params.textFieldLayout,this._integration,this._touchTypistState,this._hotkeyHintViewModel)}onTouchTypistTriggerResponse(e){this._touchTypistCapiService.onTouchTypistTriggerResponse(e)}createPreviewInlineCardModel(e){return new Ue.p(e,this._replacementService,this._stateManager,this._touchTypistCapiService,this._params.alertProcessor,this._params.touchTypistTelemetryService)}createRevertInlineCardModel(e){return new Be.I(e,this._replacementService,this._stateManager,this._touchTypistCapiService)}_createUserAddedOrRemovedNewlinesSubscription(){return Re(this._textChangesService.textChangesAsyncObs,this._params.replacementListener,this._stateManager).pipe(o.h((e=>e.changes.some((e=>e.text.includes("\n"))))),c.h(void 0)).subscribe((()=>{this._stateManager.handleEvent({name:oe._.USER_ADDED_OR_REMOVED_NEWLINES})}))}}function yt(e,t,r,i){let s=null;return e.pipe(l.G()).subscribe((([e,a])=>{const n=t();(n||s)&&(n&&e.state===re.LOADING&&a.state===re.READY&&(s=n,r(n)),s&&e.state===re.READY&&a.state===re.IDLE&&i(s))}))}},83135:(e,t,r)=>{r.d(t,{c:()=>p});var i=r(65882),s=r(65647),a=r(60841),n=r(8748),o=r(78488),c=r(25770),l=r(19486);class p{constructor(e,t){this._lastSubmittedShortcutValue=e,this._isInputFocused=t,this._isActiveHotkeyChange=c.h.create(!1),this.onApplyHotkeyChange=e=>{e.setTouchTypistHotkey(this._tmpHotkey.get()),this._isActiveHotkeyChange.set(!1)},this.onDismissHotkeyChange=()=>{this._tmpHotkey.set(this._lastSubmittedShortcutValue),this._isActiveHotkeyChange.set(!1)},this.onIsActiveHotkeyChange=()=>{this._isActiveHotkeyChange.set(!0)},this._tmpHotkey=c.h.create(this._lastSubmittedShortcutValue)}listenToHotkeyChange(e){return i.aj(this._isActiveHotkeyChange,this._isInputFocused).pipe(s.U((([e,t])=>e&&t)),a.w((t=>t?(0,l.A8)(self,e):n.E)),o.b((({shortcut:e})=>{this._tmpHotkey.set(e)}))).subscribe()}get isActiveHotkeyChange(){return this._isActiveHotkeyChange}get tmpHotkey(){return this._tmpHotkey}}},19486:(e,t,r)=>{r.d(t,{A8:()=>y,_w:()=>T});var i=r(64965),s=r(19360),a=r(74857),n=r(78488),o=r(93899),c=r(65647),l=r(55446),p=r(36880),h=r(25770);function u(e){const t=new Set;return e.filter((e=>{const r=e.code.toLowerCase();return!t.has(r)&&(t.add(r),!0)}))}function d(e,t){return"ControlLeft"===e.code||"ControlRight"===e.code?t?"⌃":"Ctrl":"ShiftLeft"===e.code||"ShiftRight"===e.code?"⇧":"AltLeft"===e.code||"AltRight"===e.code?t?"⌥":"Alt":"MetaLeft"===e.code||"MetaRight"===e.code?t?"⌘":"Win":"ArrowUp"===e.code?"↑":"ArrowDown"===e.code?"↓":"ArrowLeft"===e.code?"←":"ArrowRight"===e.code?"→":"Home"===e.code?"Home":"End"===e.code?"End":"PageUp"===e.code?"PageUp":"PageDown"===e.code?"PageDown":"Backspace"===e.code?"Backspace":"Delete"===e.code?"Delete":"Enter"===e.code?"Enter":"Tab"===e.code?"Tab":"Space"===e.code?"Space":e.code.startsWith("F")&&!isNaN(parseInt(e.code.substring(1),10))?e.code:"Escape"===e.code?"ESC":"CapsLock"===e.code?"CapsLock":"NumLock"===e.code?"NumLock":"ScrollLock"===e.code?"ScrollLock":"PrintScreen"===e.code?"PrintScreen":"Pause"===e.code?"Pause":"MediaPlayPause"===e.code?"MediaPlayPause":"VolumeUp"===e.code?"VolumeUp":"VolumeDown"===e.code?"VolumeDown":"AudioVolumeMute"===e.code?"Mute":e.code.startsWith("Digit")?e.code.slice(5):e.code.startsWith("Numpad")?e.code.slice(6):"Equal"===e.code?e.shiftKey?"plus":"=":"Minus"===e.code?"-":"NumpadAdd"===e.code?"plus":"NumpadSubtract"===e.code?"-":"NumpadEqual"===e.code?"=":null}function g(e){return function(t){return{shortcut:t.map((t=>{const r=d(t,e);return r||(t.code.toLowerCase().startsWith("key")?t.code.slice(3):t.code)})).join("")}}}function m(e,t,r){return i=>{const s=t.get(),a=function(e,t,r){return["Tab","Enter","Backspace","ArrowUp","ArrowDown","ArrowRight","ArrowLeft"].some((i=>e===i&&t===d({code:e},r)))}(i.code,s,r);a&&(i.preventDefault(),i.stopImmediatePropagation()),e.set([...e.get(),i])}}function _(e){e.preventDefault(),e.stopImmediatePropagation()}function v(e){return e.sort(((e,t)=>t.code.length-e.code.length))}function y(e,t){const r=i.R(e,"keydown",{capture:!0}).pipe(s.g("code")),p=i.R(e,"keyup",{capture:!0}).pipe(a.b(50));return r.pipe(n.b(_),o.f(p),c.U(u),l.h((e=>e.length>0)),c.U(v),c.U(g(t)))}function T(e,t,r){const o=i.R(e,"keydown",{capture:!0}).pipe(s.g("code")),d=i.R(e,"keyup",{capture:!0}).pipe(a.b(50)),_=h.h.create([]);return o.pipe(n.b(m(_,r,t)),p.R(d),c.U((()=>_.get())),c.U(u),l.h((e=>e.length>0)),c.U(v),c.U((e=>{const{shortcut:r}=g(t)(e);return{shortcut:r,events:e}})))}},56412:(e,t,r)=>{function i(e){return Boolean(e&&"function"==typeof(null==e?void 0:e[Symbol.iterator]))}function*s(e,t){for(const r of e)t(r)&&(yield r)}function*a(e,t){let r=0;for(const i of e)for(const e of t(i,r++))yield e}function n(e,t,r){let i=0;for(const r of e)if(t(r,i++))return r;return r}function o(e){for(const t of e)return t}function c(e,t){const r=e[Symbol.iterator]();let i=0;const s=t[Symbol.iterator]();let a=0,n=r.next(),o=s.next();return[function*(){for(;!n.done||!o.done;)yield[n.done?null:n.value,o.done?null:o.value,i,a]}(),function(){n=r.next(),i++},function(){o=s.next(),a++}]}function*l(e){let t=e.length;for(;t--;)yield e[t]}r.d(t,{Em:()=>l,TW:()=>i,VS:()=>a,Xh:()=>o,fV:()=>c,hX:()=>s,sE:()=>n})},95660:e=>{e.exports={hotkeyHintWrapper:"iZ6ee",hotkeyHintTagWrapper:"IyPpR",expandedHotkeyHint:"X6JaN",leftAligned:"UuEaR",grammarlyLogo:"Z5RhC",expandedHotkeyHintText:"kckmf",hotkeyHintTagPlaceholder:"SMZN2",quickSettingsButton:"TkNlC",keyIcon:"VZ8FW",quickSettingsMenuWrapper:"zt9FP",quickSettingsMenuButton:"DSGTg",quickSettingsMenu:"B1fVo",quickSettingsMenuChangeQuickFixKeySection:"i0o98",quickSettingsMenuTurnOffQuickFixSection:"NZvVY",quickSettingsMenuTurnOffQuickFixButton:"LDmKa"}},42743:e=>{e.exports={hotkeyHintTagContainer:"N3QjQ",hotkeyHintTagLabel:"t_VtO"}},82675:e=>{e.exports={dotsContainer:"mNIVY",dot:"KcZm9","dot-blink":"LxClj"}},23729:e=>{e.exports={bubbleContainer:"C29Ys",bubble:"Z2bAs","bubble-scale":"L_Apf",checkmark:"cRf3w","draw-checkmark":"xcjpV"}},81402:(e,t,r)=>{r.d(t,{f:()=>h});var i=r(49231),s=r(80013),a=r(16587),n=r(17607),o=r(68567),c=r(33969);const l=(e,t)=>{let r;return r="VerificationCode"===t?{small:"medium",medium:"large",large:"large"}:{medium:"small",large:"medium",xlarge:"large"},r[e||"medium"]},p=(e,t)=>{let r;return r="VerificationCode"===t?{small:"text-small",medium:"text-medium",large:"text-medium"}:{medium:"text-xsmall",large:"text-small",xlarge:"text-medium"},r[e||"medium"]},h=({errorMessage:e,className:t,component:r,size:h="medium",color:u,...d})=>null==e||0==e.trim().length?null:i.createElement(a.k,{gap:1,align:"center",className:(0,s.W)("gds-input-error",t),...d},i.createElement(o.J,{icon:n.E,accessibilityLabel:"Error",variant:"critical",size:l(h,r)}),i.createElement(c.x,{variant:p(h,r),className:"gds-input-error-message",color:"critical-default",as:"p"},e))},73332:(e,t,r)=>{r.d(t,{n:()=>d});var i=r(49231),s=r(80013),a=r(68322),n=r(21906),o=r(80955),c=r(36821),l=r(33041),p=r(28028),h=r(68567),u=r(81402);const d=i.forwardRef((function(e,t){var r;const{accessibilityLabelHidePassword:d="Hide password",accessibilityLabelShowPassword:g="Show password",accessibilityLivePasswordIsShowing:m="Your password is now showing",accessibilityLivePasswordIsHidden:_="Your password is now hidden",className:v,label:y,helperMessage:T,errorMessage:b,isRequired:f,isOptional:S,iconStart:E,placeholder:k,labelDisplay:x="visible",labelIndicatorForOptional:w,labelIndicatorForRequired:C,type:R="text",min:P,max:I,step:A,pattern:M,spellCheck:D,size:L="medium",style:N}=e,[O,F]=i.useState(R),H=i.useRef(null);i.useImperativeHandle(t,(()=>H.current));const{labelProps:Q,inputProps:U}=(0,n.h)({...e,validationState:null!=b?"invalid":"valid",type:O},H);(0,a.j)(U,e);const B={min:P,max:I,step:A,pattern:M,spellCheck:D,style:N};"number"===R&&(B.inputMode=null!=(r=B.inputMode)?r:"numeric"),i.useEffect((()=>{F("number"===R?"text":R)}),[R]);const V="password"===O,q=V?_:m;return i.createElement("div",{className:(0,s.W)("gds-text-field",`gds-text-field-${L}`)},i.createElement(p.A,{label:y,labelDisplay:x,helperMessage:T,isRequired:f,isOptional:S,labelIndicatorForRequired:C,labelIndicatorForOptional:w,errorMessage:b,size:L,...Q}),"password"===R&&i.createElement(o.T,{"aria-live":"polite"},q),i.createElement("div",{className:"gds-text-field-container "+("password"===R?"gds-text-field-container-password":"")},null!=E&&i.createElement("div",{className:"gds-text-field-icon-start"},i.createElement(h.J,{icon:E,accessibilityLabel:"",size:"medium"})),i.createElement("input",{className:(0,s.W)("gds-text-field-input",v),...U,...B,placeholder:k,ref:H}),"password"===R&&i.createElement("button",{"aria-label":V?g:d,"aria-controls":null==U?void 0:U.id,onClick:()=>{F(V?"text":"password")},type:"button"},i.createElement(h.J,{icon:V?c.X:l.l,accessibilityLabel:"",size:"large"}))),i.createElement(u.f,{size:L,errorMessage:b}))}))},68322:(e,t,r)=>{function i(e,t){["aria-hidden","aria-controls"].forEach((r=>{const i=t[r];null!=i&&null==e[r]&&(e[r]=i)}))}r.d(t,{j:()=>i})},33041:(e,t,r)=>{r.d(t,{l:()=>s});var i=r(49231);const s=(0,r(49243).I)("color",(({title:e,titleId:t,desc:r,descId:s,...a})=>i.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none",viewBox:"0 0 16 16","aria-hidden":"true","data-icon":"InterfaceHide",stroke:"transparent","aria-labelledby":t,"aria-describedby":s,...a},r?i.createElement("desc",{id:s},r):null,e?i.createElement("title",{id:t},e):null,i.createElement("path",{fill:"#646B81",fillRule:"evenodd",d:"M1.646 1.646a.5.5 0 0 1 .708 0l12.02 12.021a.5.5 0 0 1-.707.707L1.647 2.354a.5.5 0 0 1 0-.708M3.41 5.532A6.8 6.8 0 0 0 1.557 7.77a.5.5 0 0 0 0 .46c1.588 3.07 5.073 4.265 8.138 3.585l-.866-.865c-2.398.292-4.96-.691-6.259-2.95a5.8 5.8 0 0 1 1.557-1.753zm8.464 4.221A5.8 5.8 0 0 0 13.43 8c-1.298-2.259-3.86-3.242-6.258-2.95l-.866-.865c3.065-.68 6.55.515 8.138 3.585a.5.5 0 0 1 0 .46 6.8 6.8 0 0 1-1.855 2.238z",clipRule:"evenodd"}))))},23861:(e,t,r)=>{r.d(t,{D:()=>s});var i=r(49231);const s=(0,r(49243).I)("color",(({title:e,titleId:t,desc:r,descId:s,...a})=>i.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none",viewBox:"0 0 16 16","aria-hidden":"true","data-icon":"InterfaceMoreVertical",stroke:"transparent","aria-labelledby":t,"aria-describedby":s,...a},r?i.createElement("desc",{id:s},r):null,e?i.createElement("title",{id:t},e):null,i.createElement("path",{fill:"#646B81",d:"M9.2 8a1.2 1.2 0 1 1-2.4 0 1.2 1.2 0 0 1 2.4 0M9.2 12.8a1.2 1.2 0 1 1-2.4 0 1.2 1.2 0 0 1 2.4 0M9.2 3.2a1.2 1.2 0 1 1-2.4 0 1.2 1.2 0 0 1 2.4 0"}))))},36821:(e,t,r)=>{r.d(t,{X:()=>s});var i=r(49231);const s=(0,r(49243).I)("color",(({title:e,titleId:t,desc:r,descId:s,...a})=>i.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none",viewBox:"0 0 16 16","aria-hidden":"true","data-icon":"InterfaceShow",stroke:"transparent","aria-labelledby":t,"aria-describedby":s,...a},r?i.createElement("desc",{id:s},r):null,e?i.createElement("title",{id:t},e):null,i.createElement("path",{fill:"#646B81",d:"M9 8c0 .5-.5 1-1 1s-1-.5-1-1 .5-1 1-1 1 .5 1 1"}),i.createElement("path",{stroke:"#646B81",d:"M13.43 8c-2.299 4-8.561 4-10.86 0 2.299-4 8.561-4 10.86 0ZM8.5 8a.5.5 0 0 1-.166.334A.5.5 0 0 1 8 8.5a.5.5 0 0 1-.334-.166A.5.5 0 0 1 7.5 8a.5.5 0 0 1 .166-.334A.5.5 0 0 1 8 7.5a.5.5 0 0 1 .334.166A.5.5 0 0 1 8.5 8ZM8 9.5c.413 0 .783-.201 1.041-.459s.459-.628.459-1.04-.201-.784-.459-1.042S8.413 6.5 8 6.5s-.783.201-1.041.459S6.5 7.587 6.5 8s.201.783.459 1.041S7.587 9.5 8 9.5Z"}))))},85215:(e,t,r)=>{r.d(t,{p:()=>s});var i=r(49231);const s=(0,r(49243).I)("nocolor",(({title:e,titleId:t,desc:r,descId:s,...a})=>i.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:32,height:32,fill:"none",viewBox:"0 0 32 32","aria-hidden":"true","data-icon":"LogoLogomarkMonochromeDefault",stroke:"transparent","aria-labelledby":t,"aria-describedby":s,...a},r?i.createElement("desc",{id:s},r):null,e?i.createElement("title",{id:t},e):null,i.createElement("path",{fill:"var(--color-background-base-inverse)",d:"M0 16C0 7.163 7.162 0 16.001 0s16 7.163 16 16c0 7.732-5.482 14.183-12.773 15.676-1.042.213-2.121.324-3.222.324H0z"}),i.createElement("path",{fill:"var(--color-background-base-default)",d:"m19.876 14.484-1.788 2.94h6.02c-.93 5.116-6.62 8.599-12.304 5.653a6.7 6.7 0 0 1-2.861-2.834c-3.27-6.226 1.197-12.49 7.093-12.49a8.19 8.19 0 0 1 6.2 2.839l1.58-2.6a11.08 11.08 0 0 0-8.566-3.148c-5.562.384-10.071 4.994-10.342 10.56-.309 6.393 4.8 11.688 11.124 11.688s11.14-4.999 11.14-11.14c0-.5-.038-.989-.1-1.468z"}))))},83241:(e,t,r)=>{r.d(t,{U:()=>s});var i=r(84958);function s(e){let{description:t,errorMessage:r,validationState:s}=e,{labelProps:a,fieldProps:n}=function(e){let{id:t,label:r,"aria-labelledby":s,"aria-label":a,labelElementType:n="label"}=e;t=(0,i.Me)(t);let o=(0,i.Me)(),c={};return r?(s=s?`${o} ${s}`:o,c={id:o,htmlFor:"label"===n?t:void 0}):s||a||console.warn("If you do not provide a visible label, you must specify an aria-label or aria-labelledby attribute for accessibility"),{labelProps:c,fieldProps:(0,i.bE)({id:t,"aria-label":a,"aria-labelledby":s})}}(e),o=(0,i.mp)([Boolean(t),Boolean(r),s]),c=(0,i.mp)([Boolean(t),Boolean(r),s]);return n=(0,i.dG)(n,{"aria-describedby":[o,c,e["aria-describedby"]].filter(Boolean).join(" ")||void 0}),{labelProps:a,fieldProps:n,descriptionProps:{id:o},errorMessageProps:{id:c}}}},21906:(e,t,r)=>{r.d(t,{h:()=>n});var i=r(84958),s=r(83241),a=r(46306);r(49231);function n(e,t){let{inputElementType:r="input",isDisabled:n=!1,isRequired:o=!1,isReadOnly:c=!1,validationState:l,type:p="text",value:h,defaultValue:u,onChange:d=(()=>{})}=e,{focusableProps:g}=(0,a.kc)(e,t),{labelProps:m,fieldProps:_,descriptionProps:v,errorMessageProps:y}=(0,s.U)(e),T=(0,i.zL)(e,{labelable:!0});const b={type:p,pattern:e.pattern};var f;return(0,i.y$)(t,null!==(f=null!=h?h:u)&&void 0!==f?f:"",d),{labelProps:m,inputProps:(0,i.dG)(T,"input"===r&&b,Object.assign(Object.assign({disabled:n,readOnly:c,"aria-required":o||void 0,"aria-invalid":"invalid"===l||void 0,"aria-errormessage":e["aria-errormessage"],"aria-activedescendant":e["aria-activedescendant"],"aria-autocomplete":e["aria-autocomplete"],"aria-haspopup":e["aria-haspopup"],value:e.value,defaultValue:e.value?void 0:e.defaultValue,onChange:e=>d(e.target.value),autoComplete:e.autoComplete,maxLength:e.maxLength,minLength:e.minLength,name:e.name,placeholder:e.placeholder,inputMode:e.inputMode,onCopy:e.onCopy,onCut:e.onCut,onPaste:e.onPaste,onCompositionEnd:e.onCompositionEnd,onCompositionStart:e.onCompositionStart,onCompositionUpdate:e.onCompositionUpdate,onSelect:e.onSelect,onBeforeInput:e.onBeforeInput,onInput:e.onInput},g),_)),descriptionProps:v,errorMessageProps:y}}}}]);